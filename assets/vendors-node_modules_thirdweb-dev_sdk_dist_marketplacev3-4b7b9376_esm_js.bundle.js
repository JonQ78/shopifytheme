"use strict";
(self["webpackChunkshopify_thirdweb_theme"] = self["webpackChunkshopify_thirdweb_theme"] || []).push([["vendors-node_modules_thirdweb-dev_sdk_dist_marketplacev3-4b7b9376_esm_js"],{

/***/ "./node_modules/@thirdweb-dev/sdk/dist/marketplacev3-4b7b9376.esm.js":
/*!***************************************************************************!*\
  !*** ./node_modules/@thirdweb-dev/sdk/dist/marketplacev3-4b7b9376.esm.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "MarketplaceV3": () => (/* binding */ MarketplaceV3)
/* harmony export */ });
/* harmony import */ var _QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__ = __webpack_require__(/*! ./QueryParams-da88d27c.esm.js */ "./node_modules/@thirdweb-dev/sdk/dist/QueryParams-da88d27c.esm.js");
/* harmony import */ var _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__ = __webpack_require__(/*! ./thirdweb-checkout-33f13955.esm.js */ "./node_modules/@thirdweb-dev/sdk/dist/thirdweb-checkout-33f13955.esm.js");
/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(/*! zod */ "./node_modules/zod/lib/index.mjs");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC165_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC165.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC165.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC721_json__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC721.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC1155_json__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC1155.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155.json");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_69__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_70__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/contracts/lib.esm/index.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_71__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/constants/lib.esm/addresses.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_72__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/units/lib.esm/index.js");
/* harmony import */ var tiny_invariant__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! tiny-invariant */ "./node_modules/tiny-invariant/dist/esm/tiny-invariant.js");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC20_json__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC20.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC20.json");
/* harmony import */ var bn_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! bn.js */ "./node_modules/bn.js/lib/bn.js");
/* harmony import */ var bn_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(bn_js__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IBurnableERC20_json__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IBurnableERC20.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IBurnableERC20.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDrop_json__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDrop.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDrop.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDropERC20_V2_json__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDropERC20_V2.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDropERC20_V2.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDropSinglePhase_json__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDropSinglePhase_V1_json__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase_V1.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase_V1.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IMintableERC20_json__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IMintableERC20.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IMintableERC20.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IMulticall_json__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IMulticall.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IMulticall.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_ISignatureMintERC20_json__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC20.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC20.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IBurnableERC721_json__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IBurnableERC721.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IBurnableERC721.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IClaimableERC721_json__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IClaimableERC721.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IClaimableERC721.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDelayedReveal_json__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDelayedReveal.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDelayedReveal.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDropERC721_V3_json__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDropERC721_V3.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDropERC721_V3.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC721Enumerable_json__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC721Enumerable.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721Enumerable.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC721Supply_json__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC721Supply.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721Supply.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_ILazyMint_json__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/ILazyMint.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/ILazyMint.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IMintableERC721_json__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IMintableERC721.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IMintableERC721.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_ISignatureMintERC721_json__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC721.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC721.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_ISignatureMintERC721_V1_json__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC721_V1.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC721_V1.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_LazyMintWithTier_json__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/LazyMintWithTier.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/LazyMintWithTier.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IBurnableERC1155_json__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IBurnableERC1155.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IBurnableERC1155.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IClaimableERC1155_json__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IClaimableERC1155.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IClaimableERC1155.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDrop1155_json__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDrop1155.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDrop1155.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDropERC1155_V2_json__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDropERC1155_V2.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDropERC1155_V2.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDropSinglePhase1155_json__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase1155.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase1155.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDropSinglePhase1155_V1_json__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase1155_V1.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase1155_V1.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC1155Enumerable_json__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC1155Enumerable.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155Enumerable.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IMintableERC1155_json__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IMintableERC1155.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IMintableERC1155.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_ISignatureMintERC1155_json__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC1155.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC1155.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_ERC2771Context_json__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/ERC2771Context.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/ERC2771Context.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IAppURI_json__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IAppURI.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IAppURI.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IContractMetadata_json__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IContractMetadata.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IContractMetadata.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDirectListings_json__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDirectListings.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDirectListings.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IEnglishAuctions_json__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IEnglishAuctions.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IEnglishAuctions.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IOffers_json__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IOffers.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IOffers.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IPackVRFDirect_json__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IPackVRFDirect.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IPackVRFDirect.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IPermissions_json__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IPermissions.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IPermissions.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IPermissionsEnumerable_json__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IPermissionsEnumerable.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IPermissionsEnumerable.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IPlatformFee_json__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IPlatformFee.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IPlatformFee.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IPrimarySale_json__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IPrimarySale.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IPrimarySale.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IRouter_json__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IRouter.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IRouter.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IRoyalty_json__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IRoyalty.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IRoyalty.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_Ownable_json__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/Ownable.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/Ownable.json");
/* harmony import */ var cross_fetch__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! cross-fetch */ "./node_modules/cross-fetch/dist/browser-ponyfill.js");
/* harmony import */ var cross_fetch__WEBPACK_IMPORTED_MODULE_48___default = /*#__PURE__*/__webpack_require__.n(cross_fetch__WEBPACK_IMPORTED_MODULE_48__);
/* harmony import */ var eventemitter3__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/index.mjs");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_Forwarder_json__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/Forwarder.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/Forwarder.json");
/* harmony import */ var _thirdweb_dev_storage__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! @thirdweb-dev/storage */ "./node_modules/@thirdweb-dev/storage/dist/thirdweb-dev-storage.esm.js");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC20Metadata_json__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC20Metadata.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC20Metadata.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_Router_json__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/Router.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/Router.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IThirdwebContract_json__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IThirdwebContract.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IThirdwebContract.json");
/* harmony import */ var merkletreejs__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! merkletreejs */ "./node_modules/merkletreejs/dist/index.js");
/* harmony import */ var merkletreejs__WEBPACK_IMPORTED_MODULE_55___default = /*#__PURE__*/__webpack_require__.n(merkletreejs__WEBPACK_IMPORTED_MODULE_55__);
/* harmony import */ var fast_deep_equal__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! fast-deep-equal */ "./node_modules/fast-deep-equal/index.js");
/* harmony import */ var fast_deep_equal__WEBPACK_IMPORTED_MODULE_56___default = /*#__PURE__*/__webpack_require__.n(fast_deep_equal__WEBPACK_IMPORTED_MODULE_56__);
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC721Metadata_json__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC721Metadata.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721Metadata.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC1155Metadata_json__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC1155Metadata.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155Metadata.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IDelayedRevealDeprecated_json__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IDelayedRevealDeprecated.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDelayedRevealDeprecated.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_TWFactory_json__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/TWFactory.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/TWFactory.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_TWRegistry_json__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/TWRegistry.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/TWRegistry.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_ContractPublisher_json__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/ContractPublisher.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/ContractPublisher.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_TWMultichainRegistryLogic_json__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/TWMultichainRegistryLogic.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/TWMultichainRegistryLogic.json");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_TWMultichainRegistryRouter_json__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/TWMultichainRegistryRouter.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/TWMultichainRegistryRouter.json");
/* harmony import */ var bs58__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(/*! bs58 */ "./node_modules/bs58/index.js");
/* harmony import */ var bs58__WEBPACK_IMPORTED_MODULE_65___default = /*#__PURE__*/__webpack_require__.n(bs58__WEBPACK_IMPORTED_MODULE_65__);
/* provided dependency */ var console = __webpack_require__(/*! ./node_modules/console-browserify/index.js */ "./node_modules/console-browserify/index.js");









































































/**
 * @internal
 */
const DirectListingInputParamsSchema = zod__WEBPACK_IMPORTED_MODULE_66__.z.object({
  /**
   * The address of the asset being listed.
   */
  assetContractAddress: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ad,
  /**
   * The ID of the token to list.
   */
  tokenId: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ab,
  /**
   * The quantity of tokens to include in the listing.
   *
   * For ERC721s, this value should always be 1 (and will be forced internally regardless of what is passed here).
   */
  quantity: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ab["default"](1),
  /**
   * The address of the currency to accept for the listing.
   */
  currencyContractAddress: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ad["default"](_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cc),
  /**
   * The price to pay per unit of NFTs listed.
   */
  pricePerToken: _QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__.A,
  /**
   * The start time of the listing.
   */
  startTimestamp: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ae["default"](new Date()),
  /**
   * The end time of the listing.
   */
  endTimestamp: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ag,
  /**
   * Whether the listing is reserved to be bought from a specific set of buyers.
   */
  isReservedListing: zod__WEBPACK_IMPORTED_MODULE_66__.z.boolean().default(false)
});

/**
 * @public
 */

/**
 * Handles direct listings
 * @public
 */
class MarketplaceV3DirectListings {
  // utilities

  constructor(contractWrapper, storage) {
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "featureName", _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cQ.name);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "contractWrapper", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "storage", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "events", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "interceptor", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "encoder", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "estimator", void 0);
    this.contractWrapper = contractWrapper;
    this.storage = storage;
    this.events = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aV(this.contractWrapper);
    this.encoder = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aj(this.contractWrapper);
    this.interceptor = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aW(this.contractWrapper);
    this.estimator = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aU(this.contractWrapper);
  }
  getAddress() {
    return this.contractWrapper.readContract.address;
  }

  /** ******************************
   * READ FUNCTIONS
   *******************************/

  /**
   * Get the total number of direct listings.
   * @returns Returns the total number of direct listings created.
   * @public
   *
   * @example
   * ```javascript
   * const totalListings = await contract.directListings.getTotalCount();
   * ```
   */
  async getTotalCount() {
    return await this.contractWrapper.readContract.totalListings();
  }

  /**
   * Get all direct listings.
   *
   * @example
   * ```javascript
   * const listings = await contract.directListings.getAll();
   * const priceOfFirstListing = listings[0].price;
   * ```
   *
   * @param filter - optional filter parameters
   * @returns the Direct listing object array
   */
  async getAll(filter) {
    const totalListings = await this.getTotalCount();
    let start = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(filter?.start || 0).toNumber();
    let end = totalListings.toNumber();
    if (end === 0) {
      throw new Error(`No listings exist on the contract.`);
    }
    let rawListings = [];
    let batches = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cR)(start, end, this.contractWrapper.readContract.getAllListings);
    rawListings = batches.flat();
    const filteredListings = this.applyFilter(rawListings, filter);
    return await Promise.all(filteredListings.map(listing => this.mapListing(listing)));
  }

  /**
   * Get all valid direct listings.
   *
   * A valid listing is where the listing is active,
   * and the creator still owns & has approved Marketplace to transfer the listed NFTs.
   *
   * @example
   * ```javascript
   * const listings = await contract.directListings.getAllValid();
   * const priceOfFirstListing = listings[0].price;
   * ```
   *
   * @param filter - optional filter parameters
   * @returns the Direct listing object array
   */
  async getAllValid(filter) {
    const totalListings = await this.getTotalCount();
    let start = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(filter?.start || 0).toNumber();
    let end = totalListings.toNumber();
    if (end === 0) {
      throw new Error(`No listings exist on the contract.`);
    }
    let rawListings = [];
    let batches = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cR)(start, end, this.contractWrapper.readContract.getAllValidListings);
    rawListings = batches.flat();
    const filteredListings = this.applyFilter(rawListings, filter);
    return await Promise.all(filteredListings.map(listing => this.mapListing(listing)));
  }

  /**
   * Get a direct listing by id.
   *
   * @param listingId - the listing id
   * @returns the Direct listing object
   *
   * @example
   * ```javascript
   * const listingId = 0;
   * const listing = await contract.directListings.getListing(listingId);
   * ```
   */
  async getListing(listingId) {
    const listing = await this.contractWrapper.readContract.getListing(listingId);
    return await this.mapListing(listing);
  }

  /**
   * Check whether a buyer is approved for a reserved listing.
   *
   * @param listingId - the listing id
   * @param buyer - buyer address
   */
  async isBuyerApprovedForListing(listingId, buyer) {
    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listingId));
    if (!listing.isReservedListing) {
      throw new Error(`Listing ${listingId} is not a reserved listing.`);
    }
    return await this.contractWrapper.readContract.isBuyerApprovedForListing(listingId, buyer);
  }

  /**
   * Check whether a currency is approved for a listing.
   *
   * @param listingId - the listing id
   * @param currency - currency address
   */
  async isCurrencyApprovedForListing(listingId, currency) {
    await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listingId));
    return await this.contractWrapper.readContract.isCurrencyApprovedForListing(listingId, currency);
  }

  /**
   * Check price per token for an approved currency.
   *
   * @param listingId - the listing id
   * @param currencyContractAddress - currency contract address
   */
  async currencyPriceForListing(listingId, currencyContractAddress) {
    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listingId));
    if (currencyContractAddress === listing.currencyContractAddress) {
      return listing.pricePerToken;
    }
    const isApprovedCurrency = await this.isCurrencyApprovedForListing(listingId, currencyContractAddress);
    if (!isApprovedCurrency) {
      throw new Error(`Currency ${currencyContractAddress} is not approved for Listing ${listingId}.`);
    }
    return await this.contractWrapper.readContract.currencyPriceForListing(listingId, currencyContractAddress);
  }

  /** ******************************
   * WRITE FUNCTIONS
   *******************************/

  /**
   * Create Direct Listing
   *
   * @remarks Create a new listing on the marketplace where people can buy an asset directly.
   *
   * @example
   * ```javascript
   * // Data of the listing you want to create
   * const listing = {
   *   // address of the contract the asset you want to list is on
   *   assetContractAddress: "0x...",
   *   // token ID of the asset you want to list
   *   tokenId: "0",
   *   // how many of the asset you want to list
   *   quantity: 1,
   *   // address of the currency contract that will be used to pay for the listing
   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,
   *   // The price to pay per unit of NFTs listed.
   *   pricePerToken: 1.5,
   *   // when should the listing open up for offers
   *   startTimestamp: new Date(Date.now()),
   *   // how long the listing will be open for
   *   endTimestamp: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000),
   *   // Whether the listing is reserved for a specific set of buyers.
   *   isReservedListing: false
   * }
   *
   * const tx = await contract.directListings.createListing(listing);
   * const receipt = tx.receipt; // the transaction receipt
   * const id = tx.id; // the id of the newly created listing
   * ```
   */
  async createListing(listing) {
    const parsedListing = DirectListingInputParamsSchema.parse(listing);
    await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cS)(this.contractWrapper, this.getAddress(), parsedListing.assetContractAddress, parsedListing.tokenId, await this.contractWrapper.getSignerAddress());
    const normalizedPricePerToken = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b8)(this.contractWrapper.getProvider(), parsedListing.pricePerToken, parsedListing.currencyContractAddress);
    const block = await this.contractWrapper.getProvider().getBlock("latest");
    const blockTime = block.timestamp;
    if (parsedListing.startTimestamp.lt(blockTime)) {
      parsedListing.startTimestamp = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(blockTime);
    }
    const receipt = await this.contractWrapper.sendTransaction("createListing", [{
      assetContract: parsedListing.assetContractAddress,
      tokenId: parsedListing.tokenId,
      quantity: parsedListing.quantity,
      currency: (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cT)(parsedListing.currencyContractAddress),
      pricePerToken: normalizedPricePerToken,
      startTimestamp: parsedListing.startTimestamp,
      endTimestamp: parsedListing.endTimestamp,
      reserved: parsedListing.isReservedListing
    }], {
      // Higher gas limit for create listing
      gasLimit: 500000
    });
    const event = this.contractWrapper.parseLogs("NewListing", receipt?.logs);
    return {
      id: event[0].args.listingId,
      receipt
    };
  }

  /**
   * Update a Direct listing with new metadata.
   *
   * Note: cannot update a listing with a new quantity of 0. Use `cancelDirectListing` to remove a listing instead.
   *
   * @param listing - the new listing information
   *
   * @example
   * ```javascript
   * // Data of the listing you want to update
   *
   * const listingId = 0; // ID of the listing you want to update
   *
   * const listing = {
   *   // address of the contract the asset you want to list is on
   *   assetContractAddress: "0x...", // should be same as original listing
   *   // token ID of the asset you want to list
   *   tokenId: "0", // should be same as original listing
   *   // how many of the asset you want to list
   *   quantity: 1,
   *   // address of the currency contract that will be used to pay for the listing
   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,
   *   // The price to pay per unit of NFTs listed.
   *   pricePerToken: 1.5,
   *   // when should the listing open up for offers
   *   startTimestamp: new Date(Date.now()), // can't change this if listing already active
   *   // how long the listing will be open for
   *   endTimestamp: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000),
   *   // Whether the listing is reserved for a specific set of buyers.
   *   isReservedListing: false
   * }
   *
   * const tx = await contract.directListings.updateListing(listingId, listing);
   * const receipt = tx.receipt; // the transaction receipt
   * const id = tx.id; // the id of the newly created listing
   * ```
   */
  async updateListing(listingId, listing) {
    const parsedListing = DirectListingInputParamsSchema.parse(listing);
    await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cS)(this.contractWrapper, this.getAddress(), parsedListing.assetContractAddress, parsedListing.tokenId, await this.contractWrapper.getSignerAddress());
    const normalizedPricePerToken = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b8)(this.contractWrapper.getProvider(), parsedListing.pricePerToken, parsedListing.currencyContractAddress);
    const receipt = await this.contractWrapper.sendTransaction("updateListing", [listingId, {
      assetContract: parsedListing.assetContractAddress,
      tokenId: parsedListing.tokenId,
      quantity: parsedListing.quantity,
      currency: (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cT)(parsedListing.currencyContractAddress),
      pricePerToken: normalizedPricePerToken,
      startTimestamp: parsedListing.startTimestamp,
      endTimestamp: parsedListing.endTimestamp,
      reserved: parsedListing.isReservedListing
    }], {
      // Higher gas limit for create listing
      gasLimit: 500000
    });
    const event = this.contractWrapper.parseLogs("UpdatedListing", receipt?.logs);
    return {
      id: event[0].args.listingId,
      receipt
    };
  }

  /**
   * Cancel Direct Listing
   *
   * @remarks Cancel a direct listing on the marketplace
   *
   * @example
   * ```javascript
   * // The listing ID of the direct listing you want to cancel
   * const listingId = 0;
   *
   * await contract.directListings.cancelListing(listingId);
   * ```
   */
  async cancelListing(listingId) {
    return {
      receipt: await this.contractWrapper.sendTransaction("cancelListing", [listingId])
    };
  }

  /**
   * Buy from a Listing
   *
   * @remarks Buy from a specific direct listing from the marketplace.
   *
   * @example
   * ```javascript
   * // The ID of the listing you want to buy from
   * const listingId = 0;
   * // Quantity of the asset you want to buy
   * const quantityDesired = 1;
   *
   * await contract.directListings.buyFromListing(listingId, quantityDesired);
   * ```
   *
   * @param listingId - The listing id to buy
   * @param quantityDesired - the quantity to buy
   * @param receiver - optional receiver of the bought listing if different from the connected wallet
   */
  async buyFromListing(listingId, quantityDesired, receiver) {
    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listingId));
    const {
      valid,
      error
    } = await this.isStillValidListing(listing, quantityDesired);
    if (!valid) {
      throw new Error(`Listing ${listingId} is no longer valid. ${error}`);
    }
    const buyFor = receiver ? receiver : await this.contractWrapper.getSignerAddress();
    const quantity = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(quantityDesired);
    const value = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listing.pricePerToken).mul(quantity);
    const overrides = (await this.contractWrapper.getCallOverrides()) || {};
    await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cU)(this.contractWrapper, value, listing.currencyContractAddress, overrides);
    return {
      receipt: await this.contractWrapper.sendTransaction("buyFromListing", [listingId, buyFor, quantity, listing.currencyContractAddress, value], overrides)
    };
  }

  /**
   * Approve buyer for reserved listing.
   *
   * @remarks Approve a buyer to buy from a reserved listing.
   *
   * @example
   * ```javascript
   * // The listing ID of the direct listing you want approve buyer for
   * const listingId = "0";
   *
   * await contract.directListings.approveBuyerForReservedListing(listingId, buyer);
   * ```
   *
   * @param listingId - The listing id to buy
   * @param buyer - Address of buyer being approved
   */
  async approveBuyerForReservedListing(listingId, buyer) {
    const isApproved = await this.isBuyerApprovedForListing(listingId, buyer);
    if (!isApproved) {
      return {
        receipt: await this.contractWrapper.sendTransaction("approveBuyerForListing", [listingId, buyer, true])
      };
    } else {
      throw new Error(`Buyer ${buyer} already approved for listing ${listingId}.`);
    }
  }

  /**
   * Revoke approval of a buyer for reserved listing.
   *
   * @example
   * ```javascript
   * // The listing ID of the direct listing you want approve buyer for
   * const listingId = "0";
   *
   * await contract.directListings.revokeBuyerApprovalForReservedListing(listingId, buyer);
   * ```
   *
   * @param listingId - The listing id to buy
   * @param buyer - Address of buyer being approved
   */
  async revokeBuyerApprovalForReservedListing(listingId, buyer) {
    const isApproved = await this.isBuyerApprovedForListing(listingId, buyer);
    if (isApproved) {
      return {
        receipt: await this.contractWrapper.sendTransaction("approveBuyerForListing", [listingId, buyer, false])
      };
    } else {
      throw new Error(`Buyer ${buyer} not approved for listing ${listingId}.`);
    }
  }

  /**
   * Approve a currency for a listing.
   *
   *
   * @example
   * ```javascript
   * // The listing ID of the direct listing you want approve currency for
   * const listingId = "0";
   *
   * await contract.directListings.approveCurrencyForListing(listingId, currencyContractAddress, pricePerTokenInCurrency);
   * ```
   *
   * @param listingId - The listing id to buy
   * @param currencyContractAddress - Address of currency being approved
   * @param pricePerTokenInCurrency - Price per token in the currency
   */
  async approveCurrencyForListing(listingId, currencyContractAddress, pricePerTokenInCurrency) {
    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listingId));
    if (currencyContractAddress === listing.currencyContractAddress) {
      (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__["default"])(pricePerTokenInCurrency === listing.pricePerToken, "Approving listing currency with a different price.");
    }
    const currencyPrice = await this.contractWrapper.readContract.currencyPriceForListing(listingId, currencyContractAddress);
    (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__["default"])(pricePerTokenInCurrency === currencyPrice, "Currency already approved with this price.");
    return {
      receipt: await this.contractWrapper.sendTransaction("approveCurrencyForListing", [listingId, currencyContractAddress, pricePerTokenInCurrency])
    };
  }

  /**
   * Revoke approval of a currency from a listing.
   *
   *
   * @example
   * ```javascript
   * // The listing ID of the direct listing you want to revoke currency for
   * const listingId = "0";
   *
   * await contract.directListings.revokeCurrencyApprovalForListing(listingId, currencyContractAddress);
   * ```
   *
   * @param listingId - The listing id to buy
   * @param currencyContractAddress - Address of currency
   */
  async revokeCurrencyApprovalForListing(listingId, currencyContractAddress) {
    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listingId));
    if (currencyContractAddress === listing.currencyContractAddress) {
      throw new Error(`Can't revoke approval for main listing currency.`);
    }
    const currencyPrice = await this.contractWrapper.readContract.currencyPriceForListing(listingId, currencyContractAddress);
    (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__["default"])(!currencyPrice.isZero(), "Currency not approved.");
    return {
      receipt: await this.contractWrapper.sendTransaction("approveCurrencyForListing", [listingId, currencyContractAddress, ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(0)])
    };
  }

  /** ******************************
   * PRIVATE FUNCTIONS
   *******************************/

  /**
   * Throws error if listing could not be found
   *
   * @param listingId - Listing to check for
   */
  async validateListing(listingId) {
    try {
      return await this.getListing(listingId);
    } catch (err) {
      console.error(`Error getting the listing with id ${listingId}`);
      throw err;
    }
  }

  /**
   * Helper method maps the auction listing to the direct listing interface.
   *
   * @internal
   * @param listing - The listing to map, as returned from the contract.
   * @returns - The mapped interface.
   */
  async mapListing(listing) {
    let status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.UNSET;
    const block = await this.contractWrapper.getProvider().getBlock("latest");
    const blockTime = block.timestamp;
    switch (listing.status) {
      case 1:
        status = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listing.startTimestamp).gt(blockTime) ? _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Created : ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listing.endTimestamp).lt(blockTime) ? _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Expired : _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Active;
        break;
      case 2:
        status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Completed;
        break;
      case 3:
        status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Cancelled;
        break;
    }
    return {
      assetContractAddress: listing.assetContract,
      currencyContractAddress: listing.currency,
      pricePerToken: listing.pricePerToken.toString(),
      currencyValuePerToken: await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b6)(this.contractWrapper.getProvider(), listing.currency, listing.pricePerToken),
      id: listing.listingId.toString(),
      tokenId: listing.tokenId.toString(),
      quantity: listing.quantity.toString(),
      startTimeInSeconds: ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listing.startTimestamp).toNumber(),
      asset: await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cV)(listing.assetContract, this.contractWrapper.getProvider(), listing.tokenId, this.storage),
      endTimeInSeconds: ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(listing.endTimestamp).toNumber(),
      creatorAddress: listing.listingCreator,
      isReservedListing: listing.reserved,
      status: status
    };
  }

  /**
   * Use this method to check if a direct listing is still valid.
   *
   * Ways a direct listing can become invalid:
   * 1. The asset holder transferred the asset to another wallet
   * 2. The asset holder burned the asset
   * 3. The asset holder removed the approval on the marketplace
   *
   * @internal
   * @param listing - The listing to check.
   * @returns - True if the listing is valid, false otherwise.
   */
  async isStillValidListing(listing, quantity) {
    const approved = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cW)(this.contractWrapper.getProvider(), this.getAddress(), listing.assetContractAddress, listing.tokenId, listing.creatorAddress);
    if (!approved) {
      return {
        valid: false,
        error: `Token '${listing.tokenId}' from contract '${listing.assetContractAddress}' is not approved for transfer`
      };
    }
    const provider = this.contractWrapper.getProvider();
    const erc165 = new ethers__WEBPACK_IMPORTED_MODULE_70__.Contract(listing.assetContractAddress, _thirdweb_dev_contracts_js_dist_abis_IERC165_json__WEBPACK_IMPORTED_MODULE_0__, provider);
    const isERC721 = await erc165.supportsInterface(_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ca);
    const isERC1155 = await erc165.supportsInterface(_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cb);
    if (isERC721) {
      const asset = new ethers__WEBPACK_IMPORTED_MODULE_70__.Contract(listing.assetContractAddress, _thirdweb_dev_contracts_js_dist_abis_IERC721_json__WEBPACK_IMPORTED_MODULE_1__, provider);
      const valid = (await asset.ownerOf(listing.tokenId)).toLowerCase() === listing.creatorAddress.toLowerCase();
      return {
        valid,
        error: valid ? undefined : `Seller is not the owner of Token '${listing.tokenId}' from contract '${listing.assetContractAddress} anymore'`
      };
    } else if (isERC1155) {
      const asset = new ethers__WEBPACK_IMPORTED_MODULE_70__.Contract(listing.assetContractAddress, _thirdweb_dev_contracts_js_dist_abis_IERC1155_json__WEBPACK_IMPORTED_MODULE_2__, provider);
      const balance = await asset.balanceOf(listing.creatorAddress, listing.tokenId);
      const valid = balance.gte(quantity || listing.quantity);
      return {
        valid,
        error: valid ? undefined : `Seller does not have enough balance of Token '${listing.tokenId}' from contract '${listing.assetContractAddress} to fulfill the listing`
      };
    } else {
      return {
        valid: false,
        error: "Contract does not implement ERC 1155 or ERC 721."
      };
    }
  }
  applyFilter(listings, filter) {
    let rawListings = [...listings];
    if (filter) {
      if (filter.seller) {
        rawListings = rawListings.filter(seller => seller.listingCreator.toString().toLowerCase() === filter?.seller?.toString().toLowerCase());
      }
      if (filter.tokenContract) {
        rawListings = rawListings.filter(tokenContract => tokenContract.assetContract.toString().toLowerCase() === filter?.tokenContract?.toString().toLowerCase());
      }
      if (filter.tokenId !== undefined) {
        rawListings = rawListings.filter(tokenContract => tokenContract.tokenId.toString() === filter?.tokenId?.toString());
      }
    }
    return filter?.count && filter.count < rawListings.length ? rawListings.slice(0, filter.count) : rawListings;
  }
}

/**
 * @internal
 */
const EnglishAuctionInputParamsSchema = zod__WEBPACK_IMPORTED_MODULE_66__.z.object({
  /**
   * The address of the asset being auctioned.
   */
  assetContractAddress: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ad,
  /**
   * The ID of the token to auction.
   */
  tokenId: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ab,
  /**
   * The quantity of tokens to include in the listing.
   *
   * For ERC721s, this value should always be 1 (and will be forced internally regardless of what is passed here).
   */
  quantity: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ab["default"](1),
  /**
   * The address of the currency to accept for the listing.
   */
  currencyContractAddress: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ad["default"](_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cc),
  /**
   * The minimum price that a bid must be in order to be accepted.
   */
  minimumBidAmount: _QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__.A,
  /**
   * The buyout price of the auction.
   */
  buyoutBidAmount: _QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__.A,
  /**
   * This is a buffer e.g. x seconds.
   *
   * If a new winning bid is made less than x seconds before expirationTimestamp, the
   * expirationTimestamp is increased by x seconds.
   */
  timeBufferInSeconds: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ab["default"](900),
  // 15 minutes by default

  /**
   * This is a buffer in basis points e.g. x%.
   *
   * To be considered as a new winning bid, a bid must be at least x% greater than
   * the current winning bid.
   */
  bidBufferBps: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ab["default"](500),
  // 5% by default

  /**
   * The start time of the auction.
   */
  startTimestamp: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ae["default"](new Date()),
  /**
   * The end time of the auction.
   */
  endTimestamp: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ag
});

/**
 * @public
 */

/**
 * Handles auctions
 * @public
 */
class MarketplaceV3EnglishAuctions {
  // utilities

  constructor(contractWrapper, storage) {
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "featureName", _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cX.name);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "contractWrapper", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "storage", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "events", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "interceptor", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "encoder", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "estimator", void 0);
    this.contractWrapper = contractWrapper;
    this.storage = storage;
    this.events = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aV(this.contractWrapper);
    this.encoder = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aj(this.contractWrapper);
    this.interceptor = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aW(this.contractWrapper);
    this.estimator = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aU(this.contractWrapper);
  }
  getAddress() {
    return this.contractWrapper.readContract.address;
  }

  /** ******************************
   * READ FUNCTIONS
   *******************************/

  /**
   * Get the total number of english auctions.
   * @returns Returns the total number of auctions created.
   * @public
   *
   * @example
   * ```javascript
   * const totalAuctions = await contract.englishAuctions.getTotalCount();
   * ```
   */
  async getTotalCount() {
    return await this.contractWrapper.readContract.totalAuctions();
  }

  /**
   * Get all auctions.
   *
   * @example
   * ```javascript
   * const auctions = await contract.englishAuctions.getAll();
   * ```
   *
   * @param filter - optional filter parameters
   * @returns the Auction object array
   */
  async getAll(filter) {
    const totalAuctions = await this.getTotalCount();
    let start = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(filter?.start || 0).toNumber();
    let end = totalAuctions.toNumber();
    if (end === 0) {
      throw new Error(`No auctions exist on the contract.`);
    }
    let rawAuctions = [];
    let batches = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cR)(start, end, this.contractWrapper.readContract.getAllAuctions);
    rawAuctions = batches.flat();
    const filteredAuctions = this.applyFilter(rawAuctions, filter);
    return await Promise.all(filteredAuctions.map(auction => this.mapAuction(auction)));
  }

  /**
   * Get all valid auctions.
   *
   * @example
   * ```javascript
   * const auctions = await contract.englishAuctions.getAllValid();
   * ```
   *
   * @param filter - optional filter parameters
   * @returns the Auction object array
   */
  async getAllValid(filter) {
    const totalAuctions = await this.getTotalCount();
    let start = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(filter?.start || 0).toNumber();
    let end = totalAuctions.toNumber();
    if (end === 0) {
      throw new Error(`No auctions exist on the contract.`);
    }
    let rawAuctions = [];
    let batches = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cR)(start, end, this.contractWrapper.readContract.getAllValidAuctions);
    rawAuctions = batches.flat();
    const filteredAuctions = this.applyFilter(rawAuctions, filter);
    return await Promise.all(filteredAuctions.map(auction => this.mapAuction(auction)));
  }

  /**
   * Get an Auction by id.
   *
   * @example
   * ```javascript
   * const auctionId = 0;
   * const auction = await contract.englishAuctions.getAuction(auctionId);
   * ```
   *
   * @param auctionId - the auction Id
   * @returns the Auction object
   */
  async getAuction(auctionId) {
    const auction = await this.contractWrapper.readContract.getAuction(auctionId);
    return await this.mapAuction(auction);
  }

  /**
   * Get Highest Bid
   *
   * @remarks Get the current highest bid of an active auction.
   *
   * @example
   * ```javascript
   * // The ID of the auction
   * const auctionId = 0;
   *
   * contract.englishAuctions.
   *   .getWinningBid(auctionId)
   *   .then((bid) => console.log(bid))
   *   .catch((err) => console.error(err));
   * ```
   */
  async getWinningBid(auctionId) {
    await this.validateAuction(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId));
    const bid = await this.contractWrapper.readContract.getWinningBid(auctionId);
    if (bid._bidder === ethers__WEBPACK_IMPORTED_MODULE_71__.AddressZero) {
      return undefined;
    }
    return await this.mapBid(auctionId.toString(), bid._bidder, bid._currency, bid._bidAmount.toString());
  }

  /**
   * Check if a bid-amount is/will be a winning bid.
   *
   * @param auctionId - Auction Id
   * @param bidAmount - Amount to bid
   * @returns the Auction object
   */
  async isWinningBid(auctionId, bidAmount) {
    return await this.contractWrapper.readContract.isNewWinningBid(auctionId, bidAmount);
  }

  /**
   * Get Auction Winner
   *
   * @remarks Get the winner of the auction after an auction ends.
   *
   * @example
   * ```javascript
   * // The auction ID of the auction that closed
   * const auctionId = 0;
   *
   * contract.englishAuctions.
   *   .getWinner(auctionId)
   *   .then((auctionWinner) => console.log(auctionWinner))
   *   .catch((err) => console.error(err));
   * ```
   */
  async getWinner(auctionId) {
    const auction = await this.validateAuction(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId));
    const bid = await this.contractWrapper.readContract.getWinningBid(auctionId);
    const now = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(Math.floor(Date.now() / 1000));
    const endTime = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.endTimeInSeconds);

    // if we have a winner in the map and the current time is past the endtime of the auction return the address of the winner
    if (now.gt(endTime) && bid._bidder !== ethers__WEBPACK_IMPORTED_MODULE_71__.AddressZero) {
      return bid._bidder;
    }
    // otherwise fall back to query filter things

    // TODO this should be via indexer or direct contract call
    const closedAuctions = await this.contractWrapper.readContract.queryFilter(this.contractWrapper.readContract.filters.AuctionClosed());
    const closed = closedAuctions.find(a => a.args.auctionId.eq(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId)));
    if (!closed) {
      throw new Error(`Could not find auction with ID ${auctionId} in closed auctions`);
    }
    return closed.args.winningBidder;
  }

  /** ******************************
   * WRITE FUNCTIONS
   *******************************/

  /**
   * Create Auction
   *
   * @remarks Create a new auction where people can bid on an asset.
   *
   * @example
   * ```javascript
   * // Data of the auction you want to create
   * const auction = {
   *   // address of the contract of the asset you want to auction
   *   assetContractAddress: "0x...",
   *   // token ID of the asset you want to auction
   *   tokenId: "0",
   *   // how many of the asset you want to auction
   *   quantity: 1,
   *   // address of the currency contract that will be used to pay for the auctioned tokens
   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,
   *   // the minimum bid that will be accepted for the token
   *   minimumBidAmount: "1.5",
   *   // how much people would have to bid to instantly buy the asset
   *   buyoutBidAmount: "10",
   *   // If a bid is made less than these many seconds before expiration, the expiration time is increased by this.
   *   timeBufferInSeconds: "900", // 15 minutes by default
   *   // A bid must be at least this much bps greater than the current winning bid
   *   bidBufferBps: "500", // 5% by default
   *   // when should the auction open up for bidding
   *   startTimestamp: new Date(Date.now()),
   *   // end time of auction
   *   endTimestamp: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000),
   * }
   *
   * const tx = await contract.englishAuctions.createAuction(auction);
   * const receipt = tx.receipt; // the transaction receipt
   * const id = tx.id; // the id of the newly created auction
   * ```
   */
  async createAuction(auction) {
    const parsedAuction = EnglishAuctionInputParamsSchema.parse(auction);
    await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cS)(this.contractWrapper, this.getAddress(), parsedAuction.assetContractAddress, parsedAuction.tokenId, await this.contractWrapper.getSignerAddress());
    const normalizedBuyoutAmount = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b8)(this.contractWrapper.getProvider(), parsedAuction.buyoutBidAmount, parsedAuction.currencyContractAddress);
    const normalizedMinBidAmount = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b8)(this.contractWrapper.getProvider(), parsedAuction.minimumBidAmount, parsedAuction.currencyContractAddress);
    const block = await this.contractWrapper.getProvider().getBlock("latest");
    const blockTime = block.timestamp;
    if (parsedAuction.startTimestamp.lt(blockTime)) {
      parsedAuction.startTimestamp = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(blockTime);
    }
    const receipt = await this.contractWrapper.sendTransaction("createAuction", [{
      assetContract: parsedAuction.assetContractAddress,
      tokenId: parsedAuction.tokenId,
      quantity: parsedAuction.quantity,
      currency: (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cT)(parsedAuction.currencyContractAddress),
      minimumBidAmount: normalizedMinBidAmount,
      buyoutBidAmount: normalizedBuyoutAmount,
      timeBufferInSeconds: parsedAuction.timeBufferInSeconds,
      bidBufferBps: parsedAuction.bidBufferBps,
      startTimestamp: parsedAuction.startTimestamp,
      endTimestamp: parsedAuction.endTimestamp
    }], {
      // Higher gas limit for create auction
      gasLimit: 500000
    });
    const event = this.contractWrapper.parseLogs("NewAuction", receipt?.logs);
    return {
      id: event[0].args.auctionId,
      receipt
    };
  }

  /**
   * Buyout Auction
   *
   * @remarks Buy a specific auction from the marketplace.
   *
   * @example
   * ```javascript
   * // The auction ID of the asset you want to buy
   * const auctionId = 0;
   *
   * await contract.englishAuctions.buyoutAuction(auctionId);
   * ```
   */
  async buyoutAuction(auctionId) {
    const auction = await this.validateAuction(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId));
    const currencyMetadata = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b7)(this.contractWrapper.getProvider(), auction.currencyContractAddress);
    return this.makeBid(auctionId, ethers__WEBPACK_IMPORTED_MODULE_72__.formatUnits(auction.buyoutBidAmount, currencyMetadata.decimals));
  }

  /**
   * Bid On Auction
   *
   * @remarks Make a bid on an auction
   *
   * @example
   * ```javascript
   * // The auction ID of the asset you want to bid on
   * const auctionId = 0;
   * // The total amount you are willing to bid for auctioned tokens
   * const bidAmount = 1;
   *
   * await contract.englishAuctions.makeBid(auctionId, bidAmount);
   * ```
   */
  async makeBid(auctionId, bidAmount) {
    const auction = await this.validateAuction(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId));
    const normalizedBidAmount = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b8)(this.contractWrapper.getProvider(), bidAmount, auction.currencyContractAddress);
    if (normalizedBidAmount.eq(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(0))) {
      throw new Error("Cannot make a bid with 0 value");
    }
    if (ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.buyoutBidAmount).gt(0) && normalizedBidAmount.gt(auction.buyoutBidAmount)) {
      throw new Error("Bid amount must be less than or equal to buyoutBidAmount");
    }
    const winningBid = await this.getWinningBid(auctionId);
    if (winningBid) {
      const isWinnner = await this.isWinningBid(auctionId, normalizedBidAmount);
      (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__["default"])(isWinnner, "Bid price is too low based on the current winning bid and the bid buffer");
    } else {
      const tokenPrice = normalizedBidAmount;
      const minimumBidAmount = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.minimumBidAmount);
      (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__["default"])(tokenPrice.gte(minimumBidAmount), "Bid price is too low based on minimum bid amount");
    }
    const overrides = (await this.contractWrapper.getCallOverrides()) || {};
    await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cU)(this.contractWrapper, normalizedBidAmount, auction.currencyContractAddress, overrides);
    return {
      receipt: await this.contractWrapper.sendTransaction("bidInAuction", [auctionId, normalizedBidAmount], overrides)
    };
  }

  /**
   * Cancel Auction
   *
   * @remarks Cancel an auction on the marketplace
   *
   * @example
   * ```javascript
   * // The ID of the auction you want to cancel
   * const auctionId = "0";
   *
   * await contract.englishAuctions.cancelAuction(auctionId);
   * ```
   */
  async cancelAuction(auctionId) {
    const winningBid = await this.getWinningBid(auctionId);
    if (winningBid) {
      throw new Error(`Bids already made.`);
    }
    return {
      receipt: await this.contractWrapper.sendTransaction("cancelAuction", [auctionId])
    };
  }

  /**
   * Close the Auction for the buyer
   *
   * @remarks Closes the Auction and executes the sale for the buyer.
   *
   * @example
   * ```javascript
   * // The ID of the auction you want to close
   * const auction = "0";
   * await contract.englishAuctions.closeAuctionForBidder(auctionId);
   * ```
   *
   * @param auctionId - the auction id to close
   * @param closeFor - optionally pass the winning bid offeror address to close the auction on their behalf
   */
  async closeAuctionForBidder(auctionId, closeFor) {
    if (!closeFor) {
      closeFor = await this.contractWrapper.getSignerAddress();
    }
    const auction = await this.validateAuction(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId));
    try {
      return {
        receipt: await this.contractWrapper.sendTransaction("collectAuctionTokens", [ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId)])
      };
    } catch (err) {
      if (err.message.includes("Marketplace: auction still active.")) {
        throw new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bt(auctionId.toString(), auction.endTimeInSeconds.toString());
      } else {
        throw err;
      }
    }
  }

  /**
   * Close the Auction for the seller, i.e. the auction creator
   *
   * @remarks Closes the Auction and executes the sale for the seller.
   *
   * @example
   * ```javascript
   * // The ID of the auction you want to close
   * const auctionId = "0";
   * await contract.englishAuctions.closeAuctionForSeller(auctionId);
   * ```
   *
   * @param auctionId - the auction id to close
   */
  async closeAuctionForSeller(auctionId) {
    const auction = await this.validateAuction(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId));
    try {
      return {
        receipt: await this.contractWrapper.sendTransaction("collectAuctionPayout", [ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId)])
      };
    } catch (err) {
      if (err.message.includes("Marketplace: auction still active.")) {
        throw new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bt(auctionId.toString(), auction.endTimeInSeconds.toString());
      } else {
        throw err;
      }
    }
  }

  /**
   * Execute the Auction Sale
   *
   * @remarks Closes the Auction and executes the sale for both parties.
   *
   * @example
   * ```javascript
   * // The ID of the auction you want to close
   * const auction = "0";
   * await contract.englishAuctions.executeSale(auctionId);
   * ```
   *
   * @param auctionId - the auction to close
   */
  async executeSale(auctionId) {
    const auction = await this.validateAuction(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId));
    try {
      const winningBid = await this.getWinningBid(auctionId);
      (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__["default"])(winningBid, "No winning bid found");
      const closeForSeller = this.encoder.encode("collectAuctionPayout", [auctionId]);
      const closeForBuyer = this.encoder.encode("collectAuctionTokens", [auctionId]);
      return await this.contractWrapper.multiCall([closeForSeller, closeForBuyer]);
    } catch (err) {
      if (err.message.includes("Marketplace: auction still active.")) {
        throw new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bt(auctionId.toString(), auction.endTimeInSeconds.toString());
      } else {
        throw err;
      }
    }
  }

  /**
   * Get the buffer in basis points between bids for an auction.
   *
   * @param auctionId - id of the auction
   */
  async getBidBufferBps(auctionId) {
    return (await this.getAuction(auctionId)).bidBufferBps;
  }

  /**
   * returns the minimum bid a user can place to outbid the previous highest bid
   * @param auctionId - id of the auction
   */
  async getMinimumNextBid(auctionId) {
    // we can fetch all of these at the same time using promise.all
    const [currentBidBufferBps, winningBid, auction] = await Promise.all([this.getBidBufferBps(auctionId), this.getWinningBid(auctionId), await this.validateAuction(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auctionId))]);
    const currentBidOrReservePrice = winningBid ?
    // if there is a winning bid use the value of it
    ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(winningBid.bidAmount) :
    // if there is no winning bid use the reserve price
    ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.minimumBidAmount);
    const minimumNextBid = currentBidOrReservePrice.add(
    // the addition of the current bid and the buffer
    // (have to divide by 10000 to get the fraction of the buffer (since it's in basis points))
    currentBidOrReservePrice.mul(currentBidBufferBps).div(10000));

    // it's more useful to return a currency value here
    return (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b6)(this.contractWrapper.getProvider(), auction.currencyContractAddress, minimumNextBid);
  }

  /** ******************************
   * PRIVATE FUNCTIONS
   *******************************/

  /**
   * Throws error if auction could not be found
   *
   * @param auctionId - Auction to check for
   */
  async validateAuction(auctionId) {
    try {
      return await this.getAuction(auctionId);
    } catch (err) {
      console.error(`Error getting the auction with id ${auctionId}`);
      throw err;
    }
  }

  /**
   * Helper method maps the auction to the auction interface.
   *
   * @internal
   * @param auction - The auction to map, as returned from the contract.
   * @returns - The mapped interface.
   */
  async mapAuction(auction) {
    let status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.UNSET;
    const block = await this.contractWrapper.getProvider().getBlock("latest");
    const blockTime = block.timestamp;
    switch (auction.status) {
      case 1:
        status = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.startTimestamp).gt(blockTime) ? _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Created : ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.endTimestamp).lt(blockTime) ? _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Expired : _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Active;
        break;
      case 2:
        status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Completed;
        break;
      case 3:
        status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Cancelled;
        break;
    }
    return {
      id: auction.auctionId.toString(),
      creatorAddress: auction.auctionCreator,
      assetContractAddress: auction.assetContract,
      tokenId: auction.tokenId.toString(),
      quantity: auction.quantity.toString(),
      currencyContractAddress: auction.currency,
      minimumBidAmount: auction.minimumBidAmount.toString(),
      minimumBidCurrencyValue: await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b6)(this.contractWrapper.getProvider(), auction.currency, auction.minimumBidAmount),
      buyoutBidAmount: auction.buyoutBidAmount.toString(),
      buyoutCurrencyValue: await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b6)(this.contractWrapper.getProvider(), auction.currency, auction.buyoutBidAmount),
      timeBufferInSeconds: ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.timeBufferInSeconds).toNumber(),
      bidBufferBps: ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.bidBufferBps).toNumber(),
      startTimeInSeconds: ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.startTimestamp).toNumber(),
      endTimeInSeconds: ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(auction.endTimestamp).toNumber(),
      asset: await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cV)(auction.assetContract, this.contractWrapper.getProvider(), auction.tokenId, this.storage),
      status: status
    };
  }

  /**
   * Maps an auction-bid to the strict interface
   *
   * @internal
   * @param bid
   * @returns - A `Bid` object
   */
  async mapBid(auctionId, bidderAddress, currencyContractAddress, bidAmount) {
    return {
      auctionId,
      bidderAddress,
      currencyContractAddress,
      bidAmount,
      bidAmountCurrencyValue: await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b6)(this.contractWrapper.getProvider(), currencyContractAddress, bidAmount)
    };
  }
  applyFilter(auctions, filter) {
    let rawAuctions = [...auctions];
    if (filter) {
      if (filter.seller) {
        rawAuctions = rawAuctions.filter(seller => seller.auctionCreator.toString().toLowerCase() === filter?.seller?.toString().toLowerCase());
      }
      if (filter.tokenContract) {
        rawAuctions = rawAuctions.filter(tokenContract => tokenContract.assetContract.toString().toLowerCase() === filter?.tokenContract?.toString().toLowerCase());
      }
      if (filter.tokenId !== undefined) {
        rawAuctions = rawAuctions.filter(tokenContract => tokenContract.tokenId.toString() === filter?.tokenId?.toString());
      }
    }
    return filter?.count && filter.count < rawAuctions.length ? rawAuctions.slice(0, filter.count) : rawAuctions;
  }
}

/**
 * @internal
 */
const OfferInputParamsSchema = zod__WEBPACK_IMPORTED_MODULE_66__.z.object({
  /**
   * The address of the asset being sought.
   */
  assetContractAddress: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ad,
  /**
   * The ID of the token.
   */
  tokenId: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ab,
  /**
   * The quantity of tokens to buy.
   *
   * For ERC721s, this value should always be 1 (and will be forced internally regardless of what is passed here).
   */
  quantity: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ab["default"](1),
  /**
   * The address of the currency offered for the NFTs.
   */
  currencyContractAddress: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ad["default"](_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cc),
  /**
   * The total offer amount for the NFTs.
   */
  totalPrice: _QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__.A,
  /**
   * The end time of the offer.
   */
  endTimestamp: _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ag
});

/**
 * @public
 */

/**
 * Handles marketplace offers
 * @public
 */
class MarketplaceV3Offers {
  // utilities

  constructor(contractWrapper, storage) {
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "featureName", _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cY.name);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "contractWrapper", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "storage", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "events", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "interceptor", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "encoder", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "estimator", void 0);
    this.contractWrapper = contractWrapper;
    this.storage = storage;
    this.events = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aV(this.contractWrapper);
    this.encoder = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aj(this.contractWrapper);
    this.interceptor = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aW(this.contractWrapper);
    this.estimator = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aU(this.contractWrapper);
  }
  getAddress() {
    return this.contractWrapper.readContract.address;
  }

  /** ******************************
   * READ FUNCTIONS
   *******************************/

  /**
   * Get the total number of offers
   * @returns Returns the total number of offers created.
   * @public
   *
   * @example
   * ```javascript
   * const totalOffers = await contract.offers.getTotalCount();
   * ```
   */
  async getTotalCount() {
    return await this.contractWrapper.readContract.totalOffers();
  }

  /**
   * Get all offers.
   *
   * @example
   * ```javascript
   * const offers = await contract.offers.getAll();
   * ```
   *
   * @param filter - optional filter parameters
   * @returns the Offer object array
   */
  async getAll(filter) {
    const totalOffers = await this.getTotalCount();
    let start = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(filter?.start || 0).toNumber();
    let end = totalOffers.toNumber();
    if (end === 0) {
      throw new Error(`No offers exist on the contract.`);
    }
    let rawOffers = [];
    let batches = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cR)(start, end, this.contractWrapper.readContract.getAllOffers);
    rawOffers = batches.flat();
    const filteredOffers = this.applyFilter(rawOffers, filter);
    return await Promise.all(filteredOffers.map(offer => this.mapOffer(offer)));
  }

  /**
   * Get all valid offers.
   *
   * @example
   * ```javascript
   * const offers = await contract.offers.getAllValid();
   * ```
   *
   * @param filter - optional filter parameters
   * @returns the Offer object array
   */
  async getAllValid(filter) {
    const totalOffers = await this.getTotalCount();
    let start = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(filter?.start || 0).toNumber();
    let end = totalOffers.toNumber();
    if (end === 0) {
      throw new Error(`No offers exist on the contract.`);
    }
    let rawOffers = [];
    let batches = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cR)(start, end, this.contractWrapper.readContract.getAllValidOffers);
    rawOffers = batches.flat();
    const filteredOffers = this.applyFilter(rawOffers, filter);
    return await Promise.all(filteredOffers.map(offer => this.mapOffer(offer)));
  }

  /**
   * Get a offer by id
   *
   * @example
   * ```javascript
   * const offerId = 0;
   * const offer = await contract.offers.getOffer(offerId);
   * ```
   *
   * @param offerId - the listing id
   * @returns the Direct listing object
   */
  async getOffer(offerId) {
    const offer = await this.contractWrapper.readContract.getOffer(offerId);
    return await this.mapOffer(offer);
  }

  /** ******************************
   * WRITE FUNCTIONS
   *******************************/

  /**
   * Make Offer
   *
   * @remarks Make an offer on the marketplace for an asset.
   *
   * @example
   * ```javascript
   * // Data of the offer you want to make
   * const offer = {
   *   // address of the contract the asset you want to make an offer for
   *   assetContractAddress: "0x...",
   *   // token ID of the asset you want to buy
   *   tokenId: "0",
   *   // how many of the asset you want to buy
   *   quantity: 1,
   *   // address of the currency contract that you offer to pay in
   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,
   *   // Total price you offer to pay for the mentioned token(s)
   *   totalPrice: "1.5",
   *   // Offer valid until
   *   endTimestamp: new Date(),
   * }
   *
   * const tx = await contract.offers.makeOffer(offer);
   * const receipt = tx.receipt; // the transaction receipt
   * const id = tx.id; // the id of the newly created offer
   * ```
   */
  async makeOffer(offer) {
    const parsedOffer = OfferInputParamsSchema.parse(offer);
    const chainId = await this.contractWrapper.getChainID();
    const currency = (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cP)(parsedOffer.currencyContractAddress) ? _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cd[chainId].wrapped.address : parsedOffer.currencyContractAddress;
    const normalizedTotalPrice = await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b8)(this.contractWrapper.getProvider(), parsedOffer.totalPrice, currency);
    const overrides = await this.contractWrapper.getCallOverrides();
    await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cU)(this.contractWrapper, normalizedTotalPrice, currency, overrides);
    const receipt = await this.contractWrapper.sendTransaction("makeOffer", [{
      assetContract: parsedOffer.assetContractAddress,
      tokenId: parsedOffer.tokenId,
      quantity: parsedOffer.quantity,
      currency: currency,
      totalPrice: normalizedTotalPrice,
      expirationTimestamp: parsedOffer.endTimestamp
    }], {
      // Higher gas limit for create listing
      gasLimit: 500000
    });
    const event = this.contractWrapper.parseLogs("NewOffer", receipt?.logs);
    return {
      id: event[0].args.offerId,
      receipt
    };
  }

  /**
   * Cancel Offer
   *
   * @remarks Cancel an offer on the marketplace
   *
   * @example
   * ```javascript
   * // The ID of the offer you want to cancel
   * const offerId = "0";
   *
   * await contract.offers.cancelOffer(offerId);
   * ```
   */
  async cancelOffer(offerId) {
    return {
      receipt: await this.contractWrapper.sendTransaction("cancelOffer", [offerId])
    };
  }

  /**
   * Accept an offer
   *
   * @example
   * ```javascript
   * // The ID of the offer you want to accept
   * const offerId = 0;
   *
   * await contract.offers.acceptOffer(offerId);
   * ```
   *
   * @param offerId - The offer id
   */
  async acceptOffer(offerId) {
    const offer = await this.validateOffer(ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(offerId));
    const {
      valid,
      error
    } = await this.isStillValidOffer(offer);
    if (!valid) {
      throw new Error(`Offer ${offerId} is no longer valid. ${error}`);
    }
    const overrides = (await this.contractWrapper.getCallOverrides()) || {};
    await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cS)(this.contractWrapper, this.getAddress(), offer.assetContractAddress, offer.tokenId, await this.contractWrapper.getSignerAddress());
    return {
      receipt: await this.contractWrapper.sendTransaction("acceptOffer", [offerId], overrides)
    };
  }

  /** ******************************
   * PRIVATE FUNCTIONS
   *******************************/

  /**
   * Throws error if offer could not be found
   *
   * @param offerId - offer to check for
   */
  async validateOffer(offerId) {
    try {
      return await this.getOffer(offerId);
    } catch (err) {
      console.error(`Error getting the offer with id ${offerId}`);
      throw err;
    }
  }

  /**
   * Helper method maps the offer to the offer interface.
   *
   * @internal
   * @param offer - The offer to map, as returned from the contract.
   * @returns - The mapped interface.
   */
  async mapOffer(offer) {
    let status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.UNSET;
    const block = await this.contractWrapper.getProvider().getBlock("latest");
    const blockTime = block.timestamp;
    switch (offer.status) {
      case 1:
        status = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(offer.expirationTimestamp).lt(blockTime) ? _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Expired : _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Active;
        break;
      case 2:
        status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Completed;
        break;
      case 3:
        status = _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b2.Cancelled;
        break;
    }
    return {
      id: offer.offerId.toString(),
      offerorAddress: offer.offeror,
      assetContractAddress: offer.assetContract,
      currencyContractAddress: offer.currency,
      tokenId: offer.tokenId.toString(),
      quantity: offer.quantity.toString(),
      totalPrice: offer.totalPrice.toString(),
      currencyValue: await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.b6)(this.contractWrapper.getProvider(), offer.currency, offer.totalPrice),
      asset: await (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cV)(offer.assetContract, this.contractWrapper.getProvider(), offer.tokenId, this.storage),
      endTimeInSeconds: ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(offer.expirationTimestamp).toNumber(),
      status: status
    };
  }

  /**
   * Use this method to check if an offer is still valid.
   *
   * Ways an offer can become invalid:
   * 1. The offer has expired
   * 2. The offeror doesn't have enough balance of currency tokens
   * 3. The offeror removed the approval of currency tokens on the marketplace
   *
   * @internal
   * @param offer - The offer to check.
   * @returns - True if the offer is valid, false otherwise.
   */
  async isStillValidOffer(offer) {
    const now = ethers__WEBPACK_IMPORTED_MODULE_69__.BigNumber.from(Math.floor(Date.now() / 1000));
    if (now.gt(offer.endTimeInSeconds)) {
      return {
        valid: false,
        error: `Offer with ID ${offer.id} has expired`
      };
    }
    const chainId = await this.contractWrapper.getChainID();
    const currency = (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cP)(offer.currencyContractAddress) ? _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cd[chainId].wrapped.address : offer.currencyContractAddress;
    const provider = this.contractWrapper.getProvider();
    const erc20 = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cK(provider, currency, _thirdweb_dev_contracts_js_dist_abis_IERC20_json__WEBPACK_IMPORTED_MODULE_4__, {});
    const offerorBalance = await erc20.readContract.balanceOf(offer.offerorAddress);
    if (offerorBalance.lt(offer.totalPrice)) {
      return {
        valid: false,
        error: `Offeror ${offer.offerorAddress} doesn't have enough balance of token ${currency}`
      };
    }
    const offerorAllowance = await erc20.readContract.allowance(offer.offerorAddress, this.getAddress());
    if (offerorAllowance.lt(offer.totalPrice)) {
      return {
        valid: false,
        error: `Offeror ${offer.offerorAddress} hasn't approved enough amount of token ${currency}`
      };
    }
    return {
      valid: true,
      error: ""
    };
  }
  applyFilter(offers, filter) {
    let rawOffers = [...offers];
    if (filter) {
      if (filter.offeror) {
        rawOffers = rawOffers.filter(offeror => offeror.offeror.toString().toLowerCase() === filter?.offeror?.toString().toLowerCase());
      }
      if (filter.tokenContract) {
        rawOffers = rawOffers.filter(tokenContract => tokenContract.assetContract.toString().toLowerCase() === filter?.tokenContract?.toString().toLowerCase());
      }
      if (filter.tokenId !== undefined) {
        rawOffers = rawOffers.filter(tokenContract => tokenContract.tokenId.toString() === filter?.tokenId?.toString());
      }
    }
    return filter?.count && filter.count < rawOffers.length ? rawOffers.slice(0, filter.count) : rawOffers;
  }
}

/**
 * Create your own whitelabel marketplace that enables users to buy and sell any digital assets.
 *
 * @example
 *
 * ```javascript
 * import { ThirdwebSDK } from "@thirdweb-dev/sdk";
 *
 * const sdk = new ThirdwebSDK("{{chainName}}");
 * const contract = await sdk.getContract("{{contract_address}}", "marketplace");
 * ```
 *
 * @public
 */
class MarketplaceV3 {
  /**
   * @internal
   */

  /**
   * Direct listings
   * @remarks Create and manage direct listings in your marketplace.
   * ```javascript
   * // Data of the listing you want to create
   * const listing = {
   *   // address of the contract the asset you want to list is on
   *   assetContractAddress: "0x...",
   *   // token ID of the asset you want to list
   *   tokenId: "0",
   *   // how many of the asset you want to list
   *   quantity: 1,
   *   // address of the currency contract that will be used to pay for the listing
   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,
   *   // The price to pay per unit of NFTs listed.
   *   pricePerToken: 1.5,
   *   // when should the listing open up for offers
   *   startTimestamp: new Date(Date.now()),
   *   // how long the listing will be open for
   *   endTimestamp: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000),
   *   // Whether the listing is reserved for a specific set of buyers.
   *   isReservedListing: false
   * }
   *
   * const tx = await contract.directListings.createListing(listing);
   * const receipt = tx.receipt; // the transaction receipt
   * const id = tx.id; // the id of the newly created listing
   *
   * // And on the buyers side:
   * // The ID of the listing you want to buy from
   * const listingId = 0;
   * // Quantity of the asset you want to buy
   * const quantityDesired = 1;
   *
   * await contract.directListings.buyFromListing(listingId, quantityDesired);
   * ```
   */
  get directListings() {
    return (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bX)(this.detectDirectListings(), _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cQ);
  }
  /**
   * Auctions
   * @remarks Create and manage auctions in your marketplace.
   * @example
   * ```javascript
   * // Data of the auction you want to create
   * const auction = {
   *   // address of the contract of the asset you want to auction
   *   assetContractAddress: "0x...",
   *   // token ID of the asset you want to auction
   *   tokenId: "0",
   *   // how many of the asset you want to auction
   *   quantity: 1,
   *   // address of the currency contract that will be used to pay for the auctioned tokens
   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,
   *   // the minimum bid that will be accepted for the token
   *   minimumBidAmount: "1.5",
   *   // how much people would have to bid to instantly buy the asset
   *   buyoutBidAmount: "10",
   *   // If a bid is made less than these many seconds before expiration, the expiration time is increased by this.
   *   timeBufferInSeconds: "1000",
   *   // A bid must be at least this much bps greater than the current winning bid
   *   bidBufferBps: "100", // 100 bps stands for 1%
   *   // when should the auction open up for bidding
   *   startTimestamp: new Date(Date.now()),
   *   // end time of auction
   *   endTimestamp: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000),
   * }
   *
   * const tx = await contract.englishAuctions.createAuction(auction);
   * const receipt = tx.receipt; // the transaction receipt
   * const id = tx.id; // the id of the newly created auction
   *
   * // And on the buyers side:
   * // The auction ID of the asset you want to bid on
   * const auctionId = 0;
   * // The total amount you are willing to bid for auctioned tokens
   * const bidAmount = 1;
   *
   * await contract.englishAuctions.makeBid(auctionId, bidAmount);
   * ```
   */
  get englishAuctions() {
    return (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bX)(this.detectEnglishAuctions(), _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cX);
  }

  /**
   * Offers
   * @remarks Make and manage offers.
   * @example
   * ```javascript
   * // Data of the offer you want to make
   * const offer = {
   *   // address of the contract the asset you want to make an offer for
   *   assetContractAddress: "0x...",
   *   // token ID of the asset you want to buy
   *   tokenId: "0",
   *   // how many of the asset you want to buy
   *   quantity: 1,
   *   // address of the currency contract that you offer to pay in
   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,
   *   // Total price you offer to pay for the mentioned token(s)
   *   totalPrice: "1.5",
   *   // Offer valid until
   *   endTimestamp: new Date(),
   * }
   *
   * const tx = await contract.offers.makeOffer(offer);
   * const receipt = tx.receipt; // the transaction receipt
   * const id = tx.id; // the id of the newly created offer
   *
   * // And on the seller's side:
   * // The ID of the offer you want to accept
   * const offerId = 0;
   * await contract.offers.acceptOffer(offerId);
   * ```
   */
  get offers() {
    return (0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bX)(this.detectOffers(), _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cY);
  }
  get chainId() {
    return this._chainId;
  }
  constructor(network, address, storage) {
    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
    let abi = arguments.length > 4 ? arguments[4] : undefined;
    let chainId = arguments.length > 5 ? arguments[5] : undefined;
    let contractWrapper = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cK(network, address, abi, options);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "abi", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "contractWrapper", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "storage", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "encoder", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "events", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "estimator", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "platformFees", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "metadata", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "roles", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "interceptor", void 0);
    (0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(this, "_chainId", void 0);
    this._chainId = chainId;
    this.abi = abi;
    this.contractWrapper = contractWrapper;
    this.storage = storage;
    this.metadata = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.ak(this.contractWrapper, _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.cN, this.storage);
    this.roles = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.al(this.contractWrapper, MarketplaceV3.contractRoles);
    this.encoder = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aj(this.contractWrapper);
    this.estimator = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aU(this.contractWrapper);
    this.events = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aV(this.contractWrapper);
    this.platformFees = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aX(this.contractWrapper);
    this.interceptor = new _thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.aW(this.contractWrapper);
  }
  onNetworkUpdated(network) {
    this.contractWrapper.updateSignerOrProvider(network);
  }
  getAddress() {
    return this.contractWrapper.readContract.address;
  }

  /**
   * @internal
   */
  async call(functionName) {
    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      args[_key - 1] = arguments[_key];
    }
    return this.contractWrapper.call(functionName, ...args);
  }

  /** ********************
   * FEATURE DETECTION
   * ********************/

  detectDirectListings() {
    if ((0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bY)(this.contractWrapper, "DirectListings")) {
      return new MarketplaceV3DirectListings(this.contractWrapper, this.storage);
    }
    return undefined;
  }
  detectEnglishAuctions() {
    if ((0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bY)(this.contractWrapper, "EnglishAuctions")) {
      return new MarketplaceV3EnglishAuctions(this.contractWrapper, this.storage);
    }
    return undefined;
  }
  detectOffers() {
    if ((0,_thirdweb_checkout_33f13955_esm_js__WEBPACK_IMPORTED_MODULE_67__.bY)(this.contractWrapper, "Offers")) {
      return new MarketplaceV3Offers(this.contractWrapper, this.storage);
    }
    return undefined;
  }
}
(0,_QueryParams_da88d27c_esm_js__WEBPACK_IMPORTED_MODULE_68__._)(MarketplaceV3, "contractRoles", ["admin", "lister", "asset"]);




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGhpcmR3ZWItZGV2X3Nka19kaXN0X21hcmtldHBsYWNldjMtNGI3YjkzNzZfZXNtX2pzLmJ1bmRsZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF3RjtBQUN1MEI7QUFDdjRCO0FBQ2tEO0FBQ0E7QUFDRTtBQUNaO0FBQ3pCO0FBQ2lDO0FBQ3pEO0FBQ21EO0FBQ1Q7QUFDUTtBQUNHO0FBQ0c7QUFDTDtBQUNKO0FBQ1M7QUFDSjtBQUNDO0FBQ0Y7QUFDQTtBQUNHO0FBQ0o7QUFDSjtBQUNNO0FBQ0s7QUFDRztBQUNQO0FBQ0E7QUFDQztBQUNSO0FBQ007QUFDSztBQUNHO0FBQ0w7QUFDRjtBQUNLO0FBQ1A7QUFDUDtBQUNVO0FBQ0Y7QUFDQztBQUNUO0FBQ087QUFDRjtBQUNVO0FBQ1Y7QUFDQTtBQUNMO0FBQ0M7QUFDRDtBQUN0QztBQUNTO0FBQ1A7QUFDc0M7QUFDOUI7QUFDbUM7QUFDUjtBQUNXO0FBQy9DO0FBQ0c7QUFDWDtBQUNxRDtBQUNDO0FBQ1E7QUFDZjtBQUNDO0FBQ087QUFDUTtBQUNDO0FBQ2hFOztBQUVkO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QywwQ0FBUTtBQUMvQztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsbUVBQWE7QUFDckM7QUFDQTtBQUNBO0FBQ0EsV0FBVyxtRUFBa0I7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksOEVBQTBCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw4RUFBcUIsQ0FBQyxtRUFBb0I7QUFDckU7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLDREQUFZO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiw4RUFBcUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1FQUFhO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQiwyQ0FBUztBQUM5QixDQUFDOztBQUVEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJLGdFQUFlLHNCQUFzQix3RUFBNEI7QUFDckUsSUFBSSxnRUFBZTtBQUNuQixJQUFJLGdFQUFlO0FBQ25CLElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQixJQUFJLGdFQUFlO0FBQ25CLElBQUksZ0VBQWU7QUFDbkI7QUFDQTtBQUNBLHNCQUFzQixtRUFBYztBQUNwQyx1QkFBdUIsbUVBQWU7QUFDdEMsMkJBQTJCLG1FQUFtQjtBQUM5Qyx5QkFBeUIsbUVBQWdCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1EQUFjO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUVBQWU7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixtREFBYztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHVFQUFlO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLG1EQUFjO0FBQzdEO0FBQ0EsaUNBQWlDLFdBQVc7QUFDNUM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG1EQUFjO0FBQzdDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsbURBQWM7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyx5QkFBeUIsOEJBQThCLFVBQVU7QUFDbkc7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQyx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHVFQUFtQjtBQUM3QiwwQ0FBMEMsdUVBQW1CO0FBQzdEO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxtREFBYztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHVFQUFvQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQyx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHVFQUFtQjtBQUM3QiwwQ0FBMEMsdUVBQW1CO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHVFQUFvQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxtREFBYztBQUM3RDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxpQ0FBaUMsV0FBVyxzQkFBc0IsTUFBTTtBQUN4RTtBQUNBO0FBQ0EscUJBQXFCLG1EQUFjO0FBQ25DLGtCQUFrQixtREFBYztBQUNoQztBQUNBLFVBQVUsdUVBQWlCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLCtCQUErQixPQUFPLCtCQUErQixVQUFVO0FBQy9FO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTiwrQkFBK0IsT0FBTywyQkFBMkIsVUFBVTtBQUMzRTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsbURBQWM7QUFDN0Q7QUFDQSxNQUFNLDBEQUFTO0FBQ2Y7QUFDQTtBQUNBLElBQUksMERBQVM7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxtREFBYztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksMERBQVM7QUFDYjtBQUNBLDRIQUE0SCxtREFBYztBQUMxSTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLE1BQU0sT0FBTyw0Q0FBNEMsVUFBVTtBQUNuRTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQix5RUFBWTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixtREFBYyx5Q0FBeUMsMkVBQWMsR0FBRyxtREFBYyx1Q0FBdUMsMkVBQWMsR0FBRywwRUFBYTtBQUM1SztBQUNBO0FBQ0EsaUJBQWlCLDZFQUFnQjtBQUNqQztBQUNBO0FBQ0EsaUJBQWlCLDZFQUFnQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsdUVBQWtCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixtREFBYztBQUN4QyxtQkFBbUIsdUVBQTZCO0FBQ2hELHdCQUF3QixtREFBYztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHVFQUEwQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsZ0JBQWdCLG1CQUFtQiw2QkFBNkI7QUFDekY7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLDZDQUFRLCtCQUErQiw4RUFBUztBQUN2RSxvREFBb0QsbUVBQW1CO0FBQ3ZFLHFEQUFxRCxtRUFBb0I7QUFDekU7QUFDQSx3QkFBd0IsNkNBQVEsK0JBQStCLDhFQUFTO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBLHdFQUF3RSxnQkFBZ0IsbUJBQW1CLDhCQUE4QjtBQUN6STtBQUNBLE1BQU07QUFDTix3QkFBd0IsNkNBQVEsK0JBQStCLCtFQUFVO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0ZBQW9GLGdCQUFnQixtQkFBbUIsOEJBQThCO0FBQ3JKO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QywwQ0FBUTtBQUNoRDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsbUVBQWE7QUFDckM7QUFDQTtBQUNBO0FBQ0EsV0FBVyxtRUFBa0I7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksOEVBQTBCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw4RUFBcUIsQ0FBQyxtRUFBb0I7QUFDckU7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDREQUFZO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiw0REFBWTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsOEVBQTBCO0FBQ2pEOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiw4RUFBMEI7QUFDMUM7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDhFQUFxQjtBQUN2QztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsbUVBQWE7QUFDN0IsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSSxnRUFBZSxzQkFBc0Isd0VBQTZCO0FBQ3RFLElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQixJQUFJLGdFQUFlO0FBQ25CLElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQixJQUFJLGdFQUFlO0FBQ25CO0FBQ0E7QUFDQSxzQkFBc0IsbUVBQWM7QUFDcEMsdUJBQXVCLG1FQUFlO0FBQ3RDLDJCQUEyQixtRUFBbUI7QUFDOUMseUJBQXlCLG1FQUFnQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsbURBQWM7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix1RUFBZTtBQUN2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixtREFBYztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHVFQUFlO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbURBQWM7QUFDN0M7QUFDQSx3QkFBd0IsZ0RBQXFCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsbURBQWM7QUFDN0Q7QUFDQSxnQkFBZ0IsbURBQWM7QUFDOUIsb0JBQW9CLG1EQUFjOztBQUVsQztBQUNBLDJDQUEyQyxnREFBcUI7QUFDaEU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxnRUFBZ0UsbURBQWM7QUFDOUU7QUFDQSx3REFBd0QsV0FBVztBQUNuRTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakMsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSx1RUFBbUI7QUFDN0IseUNBQXlDLHVFQUFtQjtBQUM1RCx5Q0FBeUMsdUVBQW1CO0FBQzVEO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxtREFBYztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHVFQUFvQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxtREFBYztBQUM3RCxtQ0FBbUMsdUVBQXFCO0FBQ3hELG1DQUFtQyxnREFBd0I7QUFDM0Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsbURBQWM7QUFDN0Qsc0NBQXNDLHVFQUFtQjtBQUN6RCwrQkFBK0IsbURBQWM7QUFDN0M7QUFDQTtBQUNBLFFBQVEsbURBQWM7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sMERBQVM7QUFDZixNQUFNO0FBQ047QUFDQSwrQkFBK0IsbURBQWM7QUFDN0MsTUFBTSwwREFBUztBQUNmO0FBQ0E7QUFDQSxVQUFVLHVFQUFpQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxtREFBYztBQUM3RDtBQUNBO0FBQ0EscUZBQXFGLG1EQUFjO0FBQ25HO0FBQ0EsTUFBTTtBQUNOO0FBQ0Esa0JBQWtCLG1FQUF1QjtBQUN6QyxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLG1EQUFjO0FBQzdEO0FBQ0E7QUFDQSxxRkFBcUYsbURBQWM7QUFDbkc7QUFDQSxNQUFNO0FBQ047QUFDQSxrQkFBa0IsbUVBQXVCO0FBQ3pDLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsbURBQWM7QUFDN0Q7QUFDQTtBQUNBLE1BQU0sMERBQVM7QUFDZjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxrQkFBa0IsbUVBQXVCO0FBQ3pDLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFLQUFxSyxtREFBYztBQUNuTDtBQUNBO0FBQ0EsSUFBSSxtREFBYztBQUNsQjtBQUNBLElBQUksbURBQWM7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXLHVFQUFrQjtBQUM3Qjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixNQUFNLE9BQU8sNENBQTRDLFVBQVU7QUFDbkU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIseUVBQVk7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsbURBQWMseUNBQXlDLDJFQUFjLEdBQUcsbURBQWMsdUNBQXVDLDJFQUFjLEdBQUcsMEVBQWE7QUFDNUs7QUFDQTtBQUNBLGlCQUFpQiw2RUFBZ0I7QUFDakM7QUFDQTtBQUNBLGlCQUFpQiw2RUFBZ0I7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsdUVBQWtCO0FBQ3ZEO0FBQ0EsaUNBQWlDLHVFQUFrQjtBQUNuRCwyQkFBMkIsbURBQWM7QUFDekMsb0JBQW9CLG1EQUFjO0FBQ2xDLDBCQUEwQixtREFBYztBQUN4Qyx3QkFBd0IsbURBQWM7QUFDdEMsbUJBQW1CLHVFQUE2QjtBQUNoRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsdUVBQWtCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsMENBQVE7QUFDdkM7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG1FQUFhO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLFdBQVcsbUVBQWtCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDhFQUEwQjtBQUN0QztBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsOEVBQXFCLENBQUMsbUVBQW9CO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBLGNBQWMsNERBQVk7QUFDMUI7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1FQUFhO0FBQzdCLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUksZ0VBQWUsc0JBQXNCLHdFQUFtQjtBQUM1RCxJQUFJLGdFQUFlO0FBQ25CLElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQixJQUFJLGdFQUFlO0FBQ25CLElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQjtBQUNBO0FBQ0Esc0JBQXNCLG1FQUFjO0FBQ3BDLHVCQUF1QixtRUFBZTtBQUN0QywyQkFBMkIsbUVBQW1CO0FBQzlDLHlCQUF5QixtRUFBZ0I7QUFDekM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1EQUFjO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUVBQWU7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsbURBQWM7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix1RUFBZTtBQUN2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLHVFQUFhLHdDQUF3QyxtRUFBYTtBQUN2Rix1Q0FBdUMsdUVBQW1CO0FBQzFEO0FBQ0EsVUFBVSx1RUFBaUI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsbURBQWM7QUFDekQ7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsK0JBQStCLFNBQVMsc0JBQXNCLE1BQU07QUFDcEU7QUFDQTtBQUNBLFVBQVUsdUVBQW1CO0FBQzdCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLE1BQU0sT0FBTywwQ0FBMEMsUUFBUTtBQUMvRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQix5RUFBWTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixtREFBYyw0Q0FBNEMsMkVBQWMsR0FBRywwRUFBYTtBQUN6RztBQUNBO0FBQ0EsaUJBQWlCLDZFQUFnQjtBQUNqQztBQUNBO0FBQ0EsaUJBQWlCLDZFQUFnQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix1RUFBa0I7QUFDN0MsbUJBQW1CLHVFQUE2QjtBQUNoRCx3QkFBd0IsbURBQWM7QUFDdEM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1EQUFjO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxVQUFVO0FBQzFDO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQix1RUFBYSxrQ0FBa0MsbUVBQWE7QUFDakY7QUFDQSxzQkFBc0IsbUVBQWUscUJBQXFCLDZFQUFRLElBQUk7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsc0JBQXNCLHVDQUF1QyxTQUFTO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixzQkFBc0IseUNBQXlDLFNBQVM7QUFDbEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGNBQWM7QUFDMUI7QUFDQSxrQ0FBa0MsV0FBVztBQUM3Qyw2Q0FBNkMsa0JBQWtCO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakMsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLHVFQUFhLDhCQUE4QixtRUFBdUI7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakMsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLHVFQUFhLCtCQUErQixtRUFBd0I7QUFDL0U7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakMsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLHVFQUFhLHNCQUFzQixtRUFBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0dBQWtHLG1FQUFlO0FBQ2pILElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQixJQUFJLGdFQUFlO0FBQ25CLElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQixJQUFJLGdFQUFlO0FBQ25CLElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQixJQUFJLGdFQUFlO0FBQ25CLElBQUksZ0VBQWU7QUFDbkIsSUFBSSxnRUFBZTtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixtRUFBZ0IsdUJBQXVCLG1FQUF5QjtBQUN4RixxQkFBcUIsbUVBQWE7QUFDbEMsdUJBQXVCLG1FQUFlO0FBQ3RDLHlCQUF5QixtRUFBZ0I7QUFDekMsc0JBQXNCLG1FQUFjO0FBQ3BDLDRCQUE0QixtRUFBbUI7QUFDL0MsMkJBQTJCLG1FQUFtQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJGQUEyRixhQUFhO0FBQ3hHO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFFBQVEsdUVBQXFCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVFQUFxQjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1RUFBcUI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdFQUFlOztBQUVVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2hvcGlmeS10aGlyZHdlYi10aGVtZS8uL25vZGVfbW9kdWxlcy9AdGhpcmR3ZWItZGV2L3Nkay9kaXN0L21hcmtldHBsYWNldjMtNGI3YjkzNzYuZXNtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEEgYXMgQW1vdW50U2NoZW1hLCBfIGFzIF9kZWZpbmVQcm9wZXJ0eSB9IGZyb20gJy4vUXVlcnlQYXJhbXMtZGE4OGQyN2MuZXNtLmpzJztcbmltcG9ydCB7IGFkIGFzIEFkZHJlc3NTY2hlbWEsIGFiIGFzIEJpZ051bWJlcmlzaFNjaGVtYSwgY2MgYXMgTkFUSVZFX1RPS0VOX0FERFJFU1MsIGFlIGFzIFJhd0RhdGVTY2hlbWEsIGFnIGFzIEVuZERhdGVTY2hlbWEsIGNRIGFzIEZFQVRVUkVfRElSRUNUX0xJU1RJTkdTLCBhViBhcyBDb250cmFjdEV2ZW50cywgYWogYXMgQ29udHJhY3RFbmNvZGVyLCBhVyBhcyBDb250cmFjdEludGVyY2VwdG9yLCBhVSBhcyBHYXNDb3N0RXN0aW1hdG9yLCBjUiBhcyBnZXRBbGxJbkJhdGNoZXMsIGNTIGFzIGhhbmRsZVRva2VuQXBwcm92YWwsIGI4IGFzIG5vcm1hbGl6ZVByaWNlVmFsdWUsIGNUIGFzIGNsZWFuQ3VycmVuY3lBZGRyZXNzLCBjVSBhcyBzZXRFcmMyMEFsbG93YW5jZSwgYjIgYXMgU3RhdHVzLCBiNiBhcyBmZXRjaEN1cnJlbmN5VmFsdWUsIGNWIGFzIGZldGNoVG9rZW5NZXRhZGF0YUZvckNvbnRyYWN0LCBjVyBhcyBpc1Rva2VuQXBwcm92ZWRGb3JUcmFuc2ZlciwgY2EgYXMgSW50ZXJmYWNlSWRfSUVSQzcyMSwgY2IgYXMgSW50ZXJmYWNlSWRfSUVSQzExNTUsIGNYIGFzIEZFQVRVUkVfRU5HTElTSF9BVUNUSU9OUywgYjcgYXMgZmV0Y2hDdXJyZW5jeU1ldGFkYXRhLCBidCBhcyBBdWN0aW9uSGFzTm90RW5kZWRFcnJvciwgY1kgYXMgRkVBVFVSRV9PRkZFUlMsIGNQIGFzIGlzTmF0aXZlVG9rZW4sIGNkIGFzIE5BVElWRV9UT0tFTlMsIGNLIGFzIENvbnRyYWN0V3JhcHBlciwgYlggYXMgYXNzZXJ0RW5hYmxlZCwgYWsgYXMgQ29udHJhY3RNZXRhZGF0YSwgY04gYXMgTWFya2V0cGxhY2VDb250cmFjdFNjaGVtYSwgYWwgYXMgQ29udHJhY3RSb2xlcywgYVggYXMgQ29udHJhY3RQbGF0Zm9ybUZlZSwgYlkgYXMgZGV0ZWN0Q29udHJhY3RGZWF0dXJlIH0gZnJvbSAnLi90aGlyZHdlYi1jaGVja291dC0zM2YxMzk1NS5lc20uanMnO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgRVJDMTY1QWJpIGZyb20gJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMTY1Lmpzb24nO1xuaW1wb3J0IEVyYzcyMUFiaSBmcm9tICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzcyMS5qc29uJztcbmltcG9ydCBFcmMxMTU1QWJpIGZyb20gJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMTE1NS5qc29uJztcbmltcG9ydCB7IEJpZ051bWJlciwgQ29udHJhY3QsIGNvbnN0YW50cywgZXRoZXJzIH0gZnJvbSAnZXRoZXJzJztcbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAndGlueS1pbnZhcmlhbnQnO1xuaW1wb3J0IEVSQzIwQWJpIGZyb20gJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMjAuanNvbic7XG5pbXBvcnQgJ2JuLmpzJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lCdXJuYWJsZUVSQzIwLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3AuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcEVSQzIwX1YyLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3BTaW5nbGVQaGFzZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEcm9wU2luZ2xlUGhhc2VfVjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTWludGFibGVFUkMyMC5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lNdWx0aWNhbGwuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JU2lnbmF0dXJlTWludEVSQzIwLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUJ1cm5hYmxlRVJDNzIxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUNsYWltYWJsZUVSQzcyMS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEZWxheWVkUmV2ZWFsLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3BFUkM3MjFfVjMuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDNzIxRW51bWVyYWJsZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkM3MjFTdXBwbHkuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTGF6eU1pbnQuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTWludGFibGVFUkM3MjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JU2lnbmF0dXJlTWludEVSQzcyMS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lTaWduYXR1cmVNaW50RVJDNzIxX1YxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvTGF6eU1pbnRXaXRoVGllci5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lCdXJuYWJsZUVSQzExNTUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQ2xhaW1hYmxlRVJDMTE1NS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEcm9wMTE1NS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEcm9wRVJDMTE1NV9WMi5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEcm9wU2luZ2xlUGhhc2UxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3BTaW5nbGVQaGFzZTExNTVfVjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMTE1NUVudW1lcmFibGUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTWludGFibGVFUkMxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVNpZ25hdHVyZU1pbnRFUkMxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvRVJDMjc3MUNvbnRleHQuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQXBwVVJJLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUNvbnRyYWN0TWV0YWRhdGEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRGlyZWN0TGlzdGluZ3MuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRW5nbGlzaEF1Y3Rpb25zLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSU9mZmVycy5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lQYWNrVlJGRGlyZWN0Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVBlcm1pc3Npb25zLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVBlcm1pc3Npb25zRW51bWVyYWJsZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lQbGF0Zm9ybUZlZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lQcmltYXJ5U2FsZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lSb3V0ZXIuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JUm95YWx0eS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL093bmFibGUuanNvbic7XG5pbXBvcnQgJ2Nyb3NzLWZldGNoJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jaGFpbnMnO1xuaW1wb3J0ICdldmVudGVtaXR0ZXIzJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0ZvcndhcmRlci5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9zdG9yYWdlJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkMyME1ldGFkYXRhLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvUm91dGVyLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVRoaXJkd2ViQ29udHJhY3QuanNvbic7XG5pbXBvcnQgJ21lcmtsZXRyZWVqcyc7XG5pbXBvcnQgJ2Zhc3QtZGVlcC1lcXVhbCc7XG5pbXBvcnQgJ3V1aWQnO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzcyMU1ldGFkYXRhLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzExNTVNZXRhZGF0YS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEZWxheWVkUmV2ZWFsRGVwcmVjYXRlZC5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL1RXRmFjdG9yeS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL1RXUmVnaXN0cnkuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9Db250cmFjdFB1Ymxpc2hlci5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL1RXTXVsdGljaGFpblJlZ2lzdHJ5TG9naWMuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9UV011bHRpY2hhaW5SZWdpc3RyeVJvdXRlci5qc29uJztcbmltcG9ydCAnYnM1OCc7XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmNvbnN0IERpcmVjdExpc3RpbmdJbnB1dFBhcmFtc1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgLyoqXG4gICAqIFRoZSBhZGRyZXNzIG9mIHRoZSBhc3NldCBiZWluZyBsaXN0ZWQuXG4gICAqL1xuICBhc3NldENvbnRyYWN0QWRkcmVzczogQWRkcmVzc1NjaGVtYSxcbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgdG9rZW4gdG8gbGlzdC5cbiAgICovXG4gIHRva2VuSWQ6IEJpZ051bWJlcmlzaFNjaGVtYSxcbiAgLyoqXG4gICAqIFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gaW5jbHVkZSBpbiB0aGUgbGlzdGluZy5cbiAgICpcbiAgICogRm9yIEVSQzcyMXMsIHRoaXMgdmFsdWUgc2hvdWxkIGFsd2F5cyBiZSAxIChhbmQgd2lsbCBiZSBmb3JjZWQgaW50ZXJuYWxseSByZWdhcmRsZXNzIG9mIHdoYXQgaXMgcGFzc2VkIGhlcmUpLlxuICAgKi9cbiAgcXVhbnRpdHk6IEJpZ051bWJlcmlzaFNjaGVtYS5kZWZhdWx0KDEpLFxuICAvKipcbiAgICogVGhlIGFkZHJlc3Mgb2YgdGhlIGN1cnJlbmN5IHRvIGFjY2VwdCBmb3IgdGhlIGxpc3RpbmcuXG4gICAqL1xuICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzczogQWRkcmVzc1NjaGVtYS5kZWZhdWx0KE5BVElWRV9UT0tFTl9BRERSRVNTKSxcbiAgLyoqXG4gICAqIFRoZSBwcmljZSB0byBwYXkgcGVyIHVuaXQgb2YgTkZUcyBsaXN0ZWQuXG4gICAqL1xuICBwcmljZVBlclRva2VuOiBBbW91bnRTY2hlbWEsXG4gIC8qKlxuICAgKiBUaGUgc3RhcnQgdGltZSBvZiB0aGUgbGlzdGluZy5cbiAgICovXG4gIHN0YXJ0VGltZXN0YW1wOiBSYXdEYXRlU2NoZW1hLmRlZmF1bHQobmV3IERhdGUoKSksXG4gIC8qKlxuICAgKiBUaGUgZW5kIHRpbWUgb2YgdGhlIGxpc3RpbmcuXG4gICAqL1xuICBlbmRUaW1lc3RhbXA6IEVuZERhdGVTY2hlbWEsXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBsaXN0aW5nIGlzIHJlc2VydmVkIHRvIGJlIGJvdWdodCBmcm9tIGEgc3BlY2lmaWMgc2V0IG9mIGJ1eWVycy5cbiAgICovXG4gIGlzUmVzZXJ2ZWRMaXN0aW5nOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKVxufSk7XG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5cbi8qKlxuICogSGFuZGxlcyBkaXJlY3QgbGlzdGluZ3NcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgTWFya2V0cGxhY2VWM0RpcmVjdExpc3RpbmdzIHtcbiAgLy8gdXRpbGl0aWVzXG5cbiAgY29uc3RydWN0b3IoY29udHJhY3RXcmFwcGVyLCBzdG9yYWdlKSB7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiZmVhdHVyZU5hbWVcIiwgRkVBVFVSRV9ESVJFQ1RfTElTVElOR1MubmFtZSk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiY29udHJhY3RXcmFwcGVyXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RvcmFnZVwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImV2ZW50c1wiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImludGVyY2VwdG9yXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiZW5jb2RlclwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImVzdGltYXRvclwiLCB2b2lkIDApO1xuICAgIHRoaXMuY29udHJhY3RXcmFwcGVyID0gY29udHJhY3RXcmFwcGVyO1xuICAgIHRoaXMuc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgdGhpcy5ldmVudHMgPSBuZXcgQ29udHJhY3RFdmVudHModGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuZW5jb2RlciA9IG5ldyBDb250cmFjdEVuY29kZXIodGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuaW50ZXJjZXB0b3IgPSBuZXcgQ29udHJhY3RJbnRlcmNlcHRvcih0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gICAgdGhpcy5lc3RpbWF0b3IgPSBuZXcgR2FzQ29zdEVzdGltYXRvcih0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gIH1cbiAgZ2V0QWRkcmVzcygpIHtcbiAgICByZXR1cm4gdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmFkZHJlc3M7XG4gIH1cblxuICAvKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIFJFQUQgRlVOQ1RJT05TXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRvdGFsIG51bWJlciBvZiBkaXJlY3QgbGlzdGluZ3MuXG4gICAqIEByZXR1cm5zIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBkaXJlY3QgbGlzdGluZ3MgY3JlYXRlZC5cbiAgICogQHB1YmxpY1xuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IHRvdGFsTGlzdGluZ3MgPSBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy5nZXRUb3RhbENvdW50KCk7XG4gICAqIGBgYFxuICAgKi9cbiAgYXN5bmMgZ2V0VG90YWxDb3VudCgpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LnRvdGFsTGlzdGluZ3MoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGRpcmVjdCBsaXN0aW5ncy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiBjb25zdCBsaXN0aW5ncyA9IGF3YWl0IGNvbnRyYWN0LmRpcmVjdExpc3RpbmdzLmdldEFsbCgpO1xuICAgKiBjb25zdCBwcmljZU9mRmlyc3RMaXN0aW5nID0gbGlzdGluZ3NbMF0ucHJpY2U7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gZmlsdGVyIC0gb3B0aW9uYWwgZmlsdGVyIHBhcmFtZXRlcnNcbiAgICogQHJldHVybnMgdGhlIERpcmVjdCBsaXN0aW5nIG9iamVjdCBhcnJheVxuICAgKi9cbiAgYXN5bmMgZ2V0QWxsKGZpbHRlcikge1xuICAgIGNvbnN0IHRvdGFsTGlzdGluZ3MgPSBhd2FpdCB0aGlzLmdldFRvdGFsQ291bnQoKTtcbiAgICBsZXQgc3RhcnQgPSBCaWdOdW1iZXIuZnJvbShmaWx0ZXI/LnN0YXJ0IHx8IDApLnRvTnVtYmVyKCk7XG4gICAgbGV0IGVuZCA9IHRvdGFsTGlzdGluZ3MudG9OdW1iZXIoKTtcbiAgICBpZiAoZW5kID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGxpc3RpbmdzIGV4aXN0IG9uIHRoZSBjb250cmFjdC5gKTtcbiAgICB9XG4gICAgbGV0IHJhd0xpc3RpbmdzID0gW107XG4gICAgbGV0IGJhdGNoZXMgPSBhd2FpdCBnZXRBbGxJbkJhdGNoZXMoc3RhcnQsIGVuZCwgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmdldEFsbExpc3RpbmdzKTtcbiAgICByYXdMaXN0aW5ncyA9IGJhdGNoZXMuZmxhdCgpO1xuICAgIGNvbnN0IGZpbHRlcmVkTGlzdGluZ3MgPSB0aGlzLmFwcGx5RmlsdGVyKHJhd0xpc3RpbmdzLCBmaWx0ZXIpO1xuICAgIHJldHVybiBhd2FpdCBQcm9taXNlLmFsbChmaWx0ZXJlZExpc3RpbmdzLm1hcChsaXN0aW5nID0+IHRoaXMubWFwTGlzdGluZyhsaXN0aW5nKSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgdmFsaWQgZGlyZWN0IGxpc3RpbmdzLlxuICAgKlxuICAgKiBBIHZhbGlkIGxpc3RpbmcgaXMgd2hlcmUgdGhlIGxpc3RpbmcgaXMgYWN0aXZlLFxuICAgKiBhbmQgdGhlIGNyZWF0b3Igc3RpbGwgb3ducyAmIGhhcyBhcHByb3ZlZCBNYXJrZXRwbGFjZSB0byB0cmFuc2ZlciB0aGUgbGlzdGVkIE5GVHMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogY29uc3QgbGlzdGluZ3MgPSBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy5nZXRBbGxWYWxpZCgpO1xuICAgKiBjb25zdCBwcmljZU9mRmlyc3RMaXN0aW5nID0gbGlzdGluZ3NbMF0ucHJpY2U7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gZmlsdGVyIC0gb3B0aW9uYWwgZmlsdGVyIHBhcmFtZXRlcnNcbiAgICogQHJldHVybnMgdGhlIERpcmVjdCBsaXN0aW5nIG9iamVjdCBhcnJheVxuICAgKi9cbiAgYXN5bmMgZ2V0QWxsVmFsaWQoZmlsdGVyKSB7XG4gICAgY29uc3QgdG90YWxMaXN0aW5ncyA9IGF3YWl0IHRoaXMuZ2V0VG90YWxDb3VudCgpO1xuICAgIGxldCBzdGFydCA9IEJpZ051bWJlci5mcm9tKGZpbHRlcj8uc3RhcnQgfHwgMCkudG9OdW1iZXIoKTtcbiAgICBsZXQgZW5kID0gdG90YWxMaXN0aW5ncy50b051bWJlcigpO1xuICAgIGlmIChlbmQgPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gbGlzdGluZ3MgZXhpc3Qgb24gdGhlIGNvbnRyYWN0LmApO1xuICAgIH1cbiAgICBsZXQgcmF3TGlzdGluZ3MgPSBbXTtcbiAgICBsZXQgYmF0Y2hlcyA9IGF3YWl0IGdldEFsbEluQmF0Y2hlcyhzdGFydCwgZW5kLCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkQ29udHJhY3QuZ2V0QWxsVmFsaWRMaXN0aW5ncyk7XG4gICAgcmF3TGlzdGluZ3MgPSBiYXRjaGVzLmZsYXQoKTtcbiAgICBjb25zdCBmaWx0ZXJlZExpc3RpbmdzID0gdGhpcy5hcHBseUZpbHRlcihyYXdMaXN0aW5ncywgZmlsdGVyKTtcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwoZmlsdGVyZWRMaXN0aW5ncy5tYXAobGlzdGluZyA9PiB0aGlzLm1hcExpc3RpbmcobGlzdGluZykpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBkaXJlY3QgbGlzdGluZyBieSBpZC5cbiAgICpcbiAgICogQHBhcmFtIGxpc3RpbmdJZCAtIHRoZSBsaXN0aW5nIGlkXG4gICAqIEByZXR1cm5zIHRoZSBEaXJlY3QgbGlzdGluZyBvYmplY3RcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSAwO1xuICAgKiBjb25zdCBsaXN0aW5nID0gYXdhaXQgY29udHJhY3QuZGlyZWN0TGlzdGluZ3MuZ2V0TGlzdGluZyhsaXN0aW5nSWQpO1xuICAgKiBgYGBcbiAgICovXG4gIGFzeW5jIGdldExpc3RpbmcobGlzdGluZ0lkKSB7XG4gICAgY29uc3QgbGlzdGluZyA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5nZXRMaXN0aW5nKGxpc3RpbmdJZCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubWFwTGlzdGluZyhsaXN0aW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aGV0aGVyIGEgYnV5ZXIgaXMgYXBwcm92ZWQgZm9yIGEgcmVzZXJ2ZWQgbGlzdGluZy5cbiAgICpcbiAgICogQHBhcmFtIGxpc3RpbmdJZCAtIHRoZSBsaXN0aW5nIGlkXG4gICAqIEBwYXJhbSBidXllciAtIGJ1eWVyIGFkZHJlc3NcbiAgICovXG4gIGFzeW5jIGlzQnV5ZXJBcHByb3ZlZEZvckxpc3RpbmcobGlzdGluZ0lkLCBidXllcikge1xuICAgIGNvbnN0IGxpc3RpbmcgPSBhd2FpdCB0aGlzLnZhbGlkYXRlTGlzdGluZyhCaWdOdW1iZXIuZnJvbShsaXN0aW5nSWQpKTtcbiAgICBpZiAoIWxpc3RpbmcuaXNSZXNlcnZlZExpc3RpbmcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTGlzdGluZyAke2xpc3RpbmdJZH0gaXMgbm90IGEgcmVzZXJ2ZWQgbGlzdGluZy5gKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5pc0J1eWVyQXBwcm92ZWRGb3JMaXN0aW5nKGxpc3RpbmdJZCwgYnV5ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgYSBjdXJyZW5jeSBpcyBhcHByb3ZlZCBmb3IgYSBsaXN0aW5nLlxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gdGhlIGxpc3RpbmcgaWRcbiAgICogQHBhcmFtIGN1cnJlbmN5IC0gY3VycmVuY3kgYWRkcmVzc1xuICAgKi9cbiAgYXN5bmMgaXNDdXJyZW5jeUFwcHJvdmVkRm9yTGlzdGluZyhsaXN0aW5nSWQsIGN1cnJlbmN5KSB7XG4gICAgYXdhaXQgdGhpcy52YWxpZGF0ZUxpc3RpbmcoQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5pc0N1cnJlbmN5QXBwcm92ZWRGb3JMaXN0aW5nKGxpc3RpbmdJZCwgY3VycmVuY3kpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHByaWNlIHBlciB0b2tlbiBmb3IgYW4gYXBwcm92ZWQgY3VycmVuY3kuXG4gICAqXG4gICAqIEBwYXJhbSBsaXN0aW5nSWQgLSB0aGUgbGlzdGluZyBpZFxuICAgKiBAcGFyYW0gY3VycmVuY3lDb250cmFjdEFkZHJlc3MgLSBjdXJyZW5jeSBjb250cmFjdCBhZGRyZXNzXG4gICAqL1xuICBhc3luYyBjdXJyZW5jeVByaWNlRm9yTGlzdGluZyhsaXN0aW5nSWQsIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKSB7XG4gICAgY29uc3QgbGlzdGluZyA9IGF3YWl0IHRoaXMudmFsaWRhdGVMaXN0aW5nKEJpZ051bWJlci5mcm9tKGxpc3RpbmdJZCkpO1xuICAgIGlmIChjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyA9PT0gbGlzdGluZy5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcykge1xuICAgICAgcmV0dXJuIGxpc3RpbmcucHJpY2VQZXJUb2tlbjtcbiAgICB9XG4gICAgY29uc3QgaXNBcHByb3ZlZEN1cnJlbmN5ID0gYXdhaXQgdGhpcy5pc0N1cnJlbmN5QXBwcm92ZWRGb3JMaXN0aW5nKGxpc3RpbmdJZCwgY3VycmVuY3lDb250cmFjdEFkZHJlc3MpO1xuICAgIGlmICghaXNBcHByb3ZlZEN1cnJlbmN5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEN1cnJlbmN5ICR7Y3VycmVuY3lDb250cmFjdEFkZHJlc3N9IGlzIG5vdCBhcHByb3ZlZCBmb3IgTGlzdGluZyAke2xpc3RpbmdJZH0uYCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkQ29udHJhY3QuY3VycmVuY3lQcmljZUZvckxpc3RpbmcobGlzdGluZ0lkLCBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyk7XG4gIH1cblxuICAvKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIFdSSVRFIEZVTkNUSU9OU1xuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAvKipcbiAgICogQ3JlYXRlIERpcmVjdCBMaXN0aW5nXG4gICAqXG4gICAqIEByZW1hcmtzIENyZWF0ZSBhIG5ldyBsaXN0aW5nIG9uIHRoZSBtYXJrZXRwbGFjZSB3aGVyZSBwZW9wbGUgY2FuIGJ1eSBhbiBhc3NldCBkaXJlY3RseS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBEYXRhIG9mIHRoZSBsaXN0aW5nIHlvdSB3YW50IHRvIGNyZWF0ZVxuICAgKiBjb25zdCBsaXN0aW5nID0ge1xuICAgKiAgIC8vIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0IGlzIG9uXG4gICAqICAgYXNzZXRDb250cmFjdEFkZHJlc3M6IFwiMHguLi5cIixcbiAgICogICAvLyB0b2tlbiBJRCBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gbGlzdFxuICAgKiAgIHRva2VuSWQ6IFwiMFwiLFxuICAgKiAgIC8vIGhvdyBtYW55IG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0XG4gICAqICAgcXVhbnRpdHk6IDEsXG4gICAqICAgLy8gYWRkcmVzcyBvZiB0aGUgY3VycmVuY3kgY29udHJhY3QgdGhhdCB3aWxsIGJlIHVzZWQgdG8gcGF5IGZvciB0aGUgbGlzdGluZ1xuICAgKiAgIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzOiBOQVRJVkVfVE9LRU5fQUREUkVTUyxcbiAgICogICAvLyBUaGUgcHJpY2UgdG8gcGF5IHBlciB1bml0IG9mIE5GVHMgbGlzdGVkLlxuICAgKiAgIHByaWNlUGVyVG9rZW46IDEuNSxcbiAgICogICAvLyB3aGVuIHNob3VsZCB0aGUgbGlzdGluZyBvcGVuIHVwIGZvciBvZmZlcnNcbiAgICogICBzdGFydFRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSksXG4gICAqICAgLy8gaG93IGxvbmcgdGhlIGxpc3Rpbmcgd2lsbCBiZSBvcGVuIGZvclxuICAgKiAgIGVuZFRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICogICAvLyBXaGV0aGVyIHRoZSBsaXN0aW5nIGlzIHJlc2VydmVkIGZvciBhIHNwZWNpZmljIHNldCBvZiBidXllcnMuXG4gICAqICAgaXNSZXNlcnZlZExpc3Rpbmc6IGZhbHNlXG4gICAqIH1cbiAgICpcbiAgICogY29uc3QgdHggPSBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy5jcmVhdGVMaXN0aW5nKGxpc3RpbmcpO1xuICAgKiBjb25zdCByZWNlaXB0ID0gdHgucmVjZWlwdDsgLy8gdGhlIHRyYW5zYWN0aW9uIHJlY2VpcHRcbiAgICogY29uc3QgaWQgPSB0eC5pZDsgLy8gdGhlIGlkIG9mIHRoZSBuZXdseSBjcmVhdGVkIGxpc3RpbmdcbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBjcmVhdGVMaXN0aW5nKGxpc3RpbmcpIHtcbiAgICBjb25zdCBwYXJzZWRMaXN0aW5nID0gRGlyZWN0TGlzdGluZ0lucHV0UGFyYW1zU2NoZW1hLnBhcnNlKGxpc3RpbmcpO1xuICAgIGF3YWl0IGhhbmRsZVRva2VuQXBwcm92YWwodGhpcy5jb250cmFjdFdyYXBwZXIsIHRoaXMuZ2V0QWRkcmVzcygpLCBwYXJzZWRMaXN0aW5nLmFzc2V0Q29udHJhY3RBZGRyZXNzLCBwYXJzZWRMaXN0aW5nLnRva2VuSWQsIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFNpZ25lckFkZHJlc3MoKSk7XG4gICAgY29uc3Qgbm9ybWFsaXplZFByaWNlUGVyVG9rZW4gPSBhd2FpdCBub3JtYWxpemVQcmljZVZhbHVlKHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCksIHBhcnNlZExpc3RpbmcucHJpY2VQZXJUb2tlbiwgcGFyc2VkTGlzdGluZy5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyk7XG4gICAgY29uc3QgYmxvY2sgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLmdldEJsb2NrKFwibGF0ZXN0XCIpO1xuICAgIGNvbnN0IGJsb2NrVGltZSA9IGJsb2NrLnRpbWVzdGFtcDtcbiAgICBpZiAocGFyc2VkTGlzdGluZy5zdGFydFRpbWVzdGFtcC5sdChibG9ja1RpbWUpKSB7XG4gICAgICBwYXJzZWRMaXN0aW5nLnN0YXJ0VGltZXN0YW1wID0gQmlnTnVtYmVyLmZyb20oYmxvY2tUaW1lKTtcbiAgICB9XG4gICAgY29uc3QgcmVjZWlwdCA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImNyZWF0ZUxpc3RpbmdcIiwgW3tcbiAgICAgIGFzc2V0Q29udHJhY3Q6IHBhcnNlZExpc3RpbmcuYXNzZXRDb250cmFjdEFkZHJlc3MsXG4gICAgICB0b2tlbklkOiBwYXJzZWRMaXN0aW5nLnRva2VuSWQsXG4gICAgICBxdWFudGl0eTogcGFyc2VkTGlzdGluZy5xdWFudGl0eSxcbiAgICAgIGN1cnJlbmN5OiBjbGVhbkN1cnJlbmN5QWRkcmVzcyhwYXJzZWRMaXN0aW5nLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKSxcbiAgICAgIHByaWNlUGVyVG9rZW46IG5vcm1hbGl6ZWRQcmljZVBlclRva2VuLFxuICAgICAgc3RhcnRUaW1lc3RhbXA6IHBhcnNlZExpc3Rpbmcuc3RhcnRUaW1lc3RhbXAsXG4gICAgICBlbmRUaW1lc3RhbXA6IHBhcnNlZExpc3RpbmcuZW5kVGltZXN0YW1wLFxuICAgICAgcmVzZXJ2ZWQ6IHBhcnNlZExpc3RpbmcuaXNSZXNlcnZlZExpc3RpbmdcbiAgICB9XSwge1xuICAgICAgLy8gSGlnaGVyIGdhcyBsaW1pdCBmb3IgY3JlYXRlIGxpc3RpbmdcbiAgICAgIGdhc0xpbWl0OiA1MDAwMDBcbiAgICB9KTtcbiAgICBjb25zdCBldmVudCA9IHRoaXMuY29udHJhY3RXcmFwcGVyLnBhcnNlTG9ncyhcIk5ld0xpc3RpbmdcIiwgcmVjZWlwdD8ubG9ncyk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBldmVudFswXS5hcmdzLmxpc3RpbmdJZCxcbiAgICAgIHJlY2VpcHRcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhIERpcmVjdCBsaXN0aW5nIHdpdGggbmV3IG1ldGFkYXRhLlxuICAgKlxuICAgKiBOb3RlOiBjYW5ub3QgdXBkYXRlIGEgbGlzdGluZyB3aXRoIGEgbmV3IHF1YW50aXR5IG9mIDAuIFVzZSBgY2FuY2VsRGlyZWN0TGlzdGluZ2AgdG8gcmVtb3ZlIGEgbGlzdGluZyBpbnN0ZWFkLlxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZyAtIHRoZSBuZXcgbGlzdGluZyBpbmZvcm1hdGlvblxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIERhdGEgb2YgdGhlIGxpc3RpbmcgeW91IHdhbnQgdG8gdXBkYXRlXG4gICAqXG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IDA7IC8vIElEIG9mIHRoZSBsaXN0aW5nIHlvdSB3YW50IHRvIHVwZGF0ZVxuICAgKlxuICAgKiBjb25zdCBsaXN0aW5nID0ge1xuICAgKiAgIC8vIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0IGlzIG9uXG4gICAqICAgYXNzZXRDb250cmFjdEFkZHJlc3M6IFwiMHguLi5cIiwgLy8gc2hvdWxkIGJlIHNhbWUgYXMgb3JpZ2luYWwgbGlzdGluZ1xuICAgKiAgIC8vIHRva2VuIElEIG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0XG4gICAqICAgdG9rZW5JZDogXCIwXCIsIC8vIHNob3VsZCBiZSBzYW1lIGFzIG9yaWdpbmFsIGxpc3RpbmdcbiAgICogICAvLyBob3cgbWFueSBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gbGlzdFxuICAgKiAgIHF1YW50aXR5OiAxLFxuICAgKiAgIC8vIGFkZHJlc3Mgb2YgdGhlIGN1cnJlbmN5IGNvbnRyYWN0IHRoYXQgd2lsbCBiZSB1c2VkIHRvIHBheSBmb3IgdGhlIGxpc3RpbmdcbiAgICogICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzczogTkFUSVZFX1RPS0VOX0FERFJFU1MsXG4gICAqICAgLy8gVGhlIHByaWNlIHRvIHBheSBwZXIgdW5pdCBvZiBORlRzIGxpc3RlZC5cbiAgICogICBwcmljZVBlclRva2VuOiAxLjUsXG4gICAqICAgLy8gd2hlbiBzaG91bGQgdGhlIGxpc3Rpbmcgb3BlbiB1cCBmb3Igb2ZmZXJzXG4gICAqICAgc3RhcnRUaW1lc3RhbXA6IG5ldyBEYXRlKERhdGUubm93KCkpLCAvLyBjYW4ndCBjaGFuZ2UgdGhpcyBpZiBsaXN0aW5nIGFscmVhZHkgYWN0aXZlXG4gICAqICAgLy8gaG93IGxvbmcgdGhlIGxpc3Rpbmcgd2lsbCBiZSBvcGVuIGZvclxuICAgKiAgIGVuZFRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICogICAvLyBXaGV0aGVyIHRoZSBsaXN0aW5nIGlzIHJlc2VydmVkIGZvciBhIHNwZWNpZmljIHNldCBvZiBidXllcnMuXG4gICAqICAgaXNSZXNlcnZlZExpc3Rpbmc6IGZhbHNlXG4gICAqIH1cbiAgICpcbiAgICogY29uc3QgdHggPSBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy51cGRhdGVMaXN0aW5nKGxpc3RpbmdJZCwgbGlzdGluZyk7XG4gICAqIGNvbnN0IHJlY2VpcHQgPSB0eC5yZWNlaXB0OyAvLyB0aGUgdHJhbnNhY3Rpb24gcmVjZWlwdFxuICAgKiBjb25zdCBpZCA9IHR4LmlkOyAvLyB0aGUgaWQgb2YgdGhlIG5ld2x5IGNyZWF0ZWQgbGlzdGluZ1xuICAgKiBgYGBcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUxpc3RpbmcobGlzdGluZ0lkLCBsaXN0aW5nKSB7XG4gICAgY29uc3QgcGFyc2VkTGlzdGluZyA9IERpcmVjdExpc3RpbmdJbnB1dFBhcmFtc1NjaGVtYS5wYXJzZShsaXN0aW5nKTtcbiAgICBhd2FpdCBoYW5kbGVUb2tlbkFwcHJvdmFsKHRoaXMuY29udHJhY3RXcmFwcGVyLCB0aGlzLmdldEFkZHJlc3MoKSwgcGFyc2VkTGlzdGluZy5hc3NldENvbnRyYWN0QWRkcmVzcywgcGFyc2VkTGlzdGluZy50b2tlbklkLCBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRTaWduZXJBZGRyZXNzKCkpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRQcmljZVBlclRva2VuID0gYXdhaXQgbm9ybWFsaXplUHJpY2VWYWx1ZSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBwYXJzZWRMaXN0aW5nLnByaWNlUGVyVG9rZW4sIHBhcnNlZExpc3RpbmcuY3VycmVuY3lDb250cmFjdEFkZHJlc3MpO1xuICAgIGNvbnN0IHJlY2VpcHQgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5zZW5kVHJhbnNhY3Rpb24oXCJ1cGRhdGVMaXN0aW5nXCIsIFtsaXN0aW5nSWQsIHtcbiAgICAgIGFzc2V0Q29udHJhY3Q6IHBhcnNlZExpc3RpbmcuYXNzZXRDb250cmFjdEFkZHJlc3MsXG4gICAgICB0b2tlbklkOiBwYXJzZWRMaXN0aW5nLnRva2VuSWQsXG4gICAgICBxdWFudGl0eTogcGFyc2VkTGlzdGluZy5xdWFudGl0eSxcbiAgICAgIGN1cnJlbmN5OiBjbGVhbkN1cnJlbmN5QWRkcmVzcyhwYXJzZWRMaXN0aW5nLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKSxcbiAgICAgIHByaWNlUGVyVG9rZW46IG5vcm1hbGl6ZWRQcmljZVBlclRva2VuLFxuICAgICAgc3RhcnRUaW1lc3RhbXA6IHBhcnNlZExpc3Rpbmcuc3RhcnRUaW1lc3RhbXAsXG4gICAgICBlbmRUaW1lc3RhbXA6IHBhcnNlZExpc3RpbmcuZW5kVGltZXN0YW1wLFxuICAgICAgcmVzZXJ2ZWQ6IHBhcnNlZExpc3RpbmcuaXNSZXNlcnZlZExpc3RpbmdcbiAgICB9XSwge1xuICAgICAgLy8gSGlnaGVyIGdhcyBsaW1pdCBmb3IgY3JlYXRlIGxpc3RpbmdcbiAgICAgIGdhc0xpbWl0OiA1MDAwMDBcbiAgICB9KTtcbiAgICBjb25zdCBldmVudCA9IHRoaXMuY29udHJhY3RXcmFwcGVyLnBhcnNlTG9ncyhcIlVwZGF0ZWRMaXN0aW5nXCIsIHJlY2VpcHQ/LmxvZ3MpO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogZXZlbnRbMF0uYXJncy5saXN0aW5nSWQsXG4gICAgICByZWNlaXB0XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYW5jZWwgRGlyZWN0IExpc3RpbmdcbiAgICpcbiAgICogQHJlbWFya3MgQ2FuY2VsIGEgZGlyZWN0IGxpc3Rpbmcgb24gdGhlIG1hcmtldHBsYWNlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGxpc3RpbmcgSUQgb2YgdGhlIGRpcmVjdCBsaXN0aW5nIHlvdSB3YW50IHRvIGNhbmNlbFxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSAwO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy5jYW5jZWxMaXN0aW5nKGxpc3RpbmdJZCk7XG4gICAqIGBgYFxuICAgKi9cbiAgYXN5bmMgY2FuY2VsTGlzdGluZyhsaXN0aW5nSWQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVjZWlwdDogYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuc2VuZFRyYW5zYWN0aW9uKFwiY2FuY2VsTGlzdGluZ1wiLCBbbGlzdGluZ0lkXSlcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1eSBmcm9tIGEgTGlzdGluZ1xuICAgKlxuICAgKiBAcmVtYXJrcyBCdXkgZnJvbSBhIHNwZWNpZmljIGRpcmVjdCBsaXN0aW5nIGZyb20gdGhlIG1hcmtldHBsYWNlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIFRoZSBJRCBvZiB0aGUgbGlzdGluZyB5b3Ugd2FudCB0byBidXkgZnJvbVxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSAwO1xuICAgKiAvLyBRdWFudGl0eSBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gYnV5XG4gICAqIGNvbnN0IHF1YW50aXR5RGVzaXJlZCA9IDE7XG4gICAqXG4gICAqIGF3YWl0IGNvbnRyYWN0LmRpcmVjdExpc3RpbmdzLmJ1eUZyb21MaXN0aW5nKGxpc3RpbmdJZCwgcXVhbnRpdHlEZXNpcmVkKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSBsaXN0aW5nSWQgLSBUaGUgbGlzdGluZyBpZCB0byBidXlcbiAgICogQHBhcmFtIHF1YW50aXR5RGVzaXJlZCAtIHRoZSBxdWFudGl0eSB0byBidXlcbiAgICogQHBhcmFtIHJlY2VpdmVyIC0gb3B0aW9uYWwgcmVjZWl2ZXIgb2YgdGhlIGJvdWdodCBsaXN0aW5nIGlmIGRpZmZlcmVudCBmcm9tIHRoZSBjb25uZWN0ZWQgd2FsbGV0XG4gICAqL1xuICBhc3luYyBidXlGcm9tTGlzdGluZyhsaXN0aW5nSWQsIHF1YW50aXR5RGVzaXJlZCwgcmVjZWl2ZXIpIHtcbiAgICBjb25zdCBsaXN0aW5nID0gYXdhaXQgdGhpcy52YWxpZGF0ZUxpc3RpbmcoQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSk7XG4gICAgY29uc3Qge1xuICAgICAgdmFsaWQsXG4gICAgICBlcnJvclxuICAgIH0gPSBhd2FpdCB0aGlzLmlzU3RpbGxWYWxpZExpc3RpbmcobGlzdGluZywgcXVhbnRpdHlEZXNpcmVkKTtcbiAgICBpZiAoIXZhbGlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYExpc3RpbmcgJHtsaXN0aW5nSWR9IGlzIG5vIGxvbmdlciB2YWxpZC4gJHtlcnJvcn1gKTtcbiAgICB9XG4gICAgY29uc3QgYnV5Rm9yID0gcmVjZWl2ZXIgPyByZWNlaXZlciA6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFNpZ25lckFkZHJlc3MoKTtcbiAgICBjb25zdCBxdWFudGl0eSA9IEJpZ051bWJlci5mcm9tKHF1YW50aXR5RGVzaXJlZCk7XG4gICAgY29uc3QgdmFsdWUgPSBCaWdOdW1iZXIuZnJvbShsaXN0aW5nLnByaWNlUGVyVG9rZW4pLm11bChxdWFudGl0eSk7XG4gICAgY29uc3Qgb3ZlcnJpZGVzID0gKGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldENhbGxPdmVycmlkZXMoKSkgfHwge307XG4gICAgYXdhaXQgc2V0RXJjMjBBbGxvd2FuY2UodGhpcy5jb250cmFjdFdyYXBwZXIsIHZhbHVlLCBsaXN0aW5nLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzLCBvdmVycmlkZXMpO1xuICAgIHJldHVybiB7XG4gICAgICByZWNlaXB0OiBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5zZW5kVHJhbnNhY3Rpb24oXCJidXlGcm9tTGlzdGluZ1wiLCBbbGlzdGluZ0lkLCBidXlGb3IsIHF1YW50aXR5LCBsaXN0aW5nLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzLCB2YWx1ZV0sIG92ZXJyaWRlcylcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcHJvdmUgYnV5ZXIgZm9yIHJlc2VydmVkIGxpc3RpbmcuXG4gICAqXG4gICAqIEByZW1hcmtzIEFwcHJvdmUgYSBidXllciB0byBidXkgZnJvbSBhIHJlc2VydmVkIGxpc3RpbmcuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGxpc3RpbmcgSUQgb2YgdGhlIGRpcmVjdCBsaXN0aW5nIHlvdSB3YW50IGFwcHJvdmUgYnV5ZXIgZm9yXG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IFwiMFwiO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy5hcHByb3ZlQnV5ZXJGb3JSZXNlcnZlZExpc3RpbmcobGlzdGluZ0lkLCBidXllcik7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gVGhlIGxpc3RpbmcgaWQgdG8gYnV5XG4gICAqIEBwYXJhbSBidXllciAtIEFkZHJlc3Mgb2YgYnV5ZXIgYmVpbmcgYXBwcm92ZWRcbiAgICovXG4gIGFzeW5jIGFwcHJvdmVCdXllckZvclJlc2VydmVkTGlzdGluZyhsaXN0aW5nSWQsIGJ1eWVyKSB7XG4gICAgY29uc3QgaXNBcHByb3ZlZCA9IGF3YWl0IHRoaXMuaXNCdXllckFwcHJvdmVkRm9yTGlzdGluZyhsaXN0aW5nSWQsIGJ1eWVyKTtcbiAgICBpZiAoIWlzQXBwcm92ZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlY2VpcHQ6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImFwcHJvdmVCdXllckZvckxpc3RpbmdcIiwgW2xpc3RpbmdJZCwgYnV5ZXIsIHRydWVdKVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBCdXllciAke2J1eWVyfSBhbHJlYWR5IGFwcHJvdmVkIGZvciBsaXN0aW5nICR7bGlzdGluZ0lkfS5gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV2b2tlIGFwcHJvdmFsIG9mIGEgYnV5ZXIgZm9yIHJlc2VydmVkIGxpc3RpbmcuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGxpc3RpbmcgSUQgb2YgdGhlIGRpcmVjdCBsaXN0aW5nIHlvdSB3YW50IGFwcHJvdmUgYnV5ZXIgZm9yXG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IFwiMFwiO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy5yZXZva2VCdXllckFwcHJvdmFsRm9yUmVzZXJ2ZWRMaXN0aW5nKGxpc3RpbmdJZCwgYnV5ZXIpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIGxpc3RpbmdJZCAtIFRoZSBsaXN0aW5nIGlkIHRvIGJ1eVxuICAgKiBAcGFyYW0gYnV5ZXIgLSBBZGRyZXNzIG9mIGJ1eWVyIGJlaW5nIGFwcHJvdmVkXG4gICAqL1xuICBhc3luYyByZXZva2VCdXllckFwcHJvdmFsRm9yUmVzZXJ2ZWRMaXN0aW5nKGxpc3RpbmdJZCwgYnV5ZXIpIHtcbiAgICBjb25zdCBpc0FwcHJvdmVkID0gYXdhaXQgdGhpcy5pc0J1eWVyQXBwcm92ZWRGb3JMaXN0aW5nKGxpc3RpbmdJZCwgYnV5ZXIpO1xuICAgIGlmIChpc0FwcHJvdmVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZWNlaXB0OiBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5zZW5kVHJhbnNhY3Rpb24oXCJhcHByb3ZlQnV5ZXJGb3JMaXN0aW5nXCIsIFtsaXN0aW5nSWQsIGJ1eWVyLCBmYWxzZV0pXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEJ1eWVyICR7YnV5ZXJ9IG5vdCBhcHByb3ZlZCBmb3IgbGlzdGluZyAke2xpc3RpbmdJZH0uYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFwcHJvdmUgYSBjdXJyZW5jeSBmb3IgYSBsaXN0aW5nLlxuICAgKlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIFRoZSBsaXN0aW5nIElEIG9mIHRoZSBkaXJlY3QgbGlzdGluZyB5b3Ugd2FudCBhcHByb3ZlIGN1cnJlbmN5IGZvclxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSBcIjBcIjtcbiAgICpcbiAgICogYXdhaXQgY29udHJhY3QuZGlyZWN0TGlzdGluZ3MuYXBwcm92ZUN1cnJlbmN5Rm9yTGlzdGluZyhsaXN0aW5nSWQsIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzLCBwcmljZVBlclRva2VuSW5DdXJyZW5jeSk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gVGhlIGxpc3RpbmcgaWQgdG8gYnV5XG4gICAqIEBwYXJhbSBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyAtIEFkZHJlc3Mgb2YgY3VycmVuY3kgYmVpbmcgYXBwcm92ZWRcbiAgICogQHBhcmFtIHByaWNlUGVyVG9rZW5JbkN1cnJlbmN5IC0gUHJpY2UgcGVyIHRva2VuIGluIHRoZSBjdXJyZW5jeVxuICAgKi9cbiAgYXN5bmMgYXBwcm92ZUN1cnJlbmN5Rm9yTGlzdGluZyhsaXN0aW5nSWQsIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzLCBwcmljZVBlclRva2VuSW5DdXJyZW5jeSkge1xuICAgIGNvbnN0IGxpc3RpbmcgPSBhd2FpdCB0aGlzLnZhbGlkYXRlTGlzdGluZyhCaWdOdW1iZXIuZnJvbShsaXN0aW5nSWQpKTtcbiAgICBpZiAoY3VycmVuY3lDb250cmFjdEFkZHJlc3MgPT09IGxpc3RpbmcuY3VycmVuY3lDb250cmFjdEFkZHJlc3MpIHtcbiAgICAgIGludmFyaWFudChwcmljZVBlclRva2VuSW5DdXJyZW5jeSA9PT0gbGlzdGluZy5wcmljZVBlclRva2VuLCBcIkFwcHJvdmluZyBsaXN0aW5nIGN1cnJlbmN5IHdpdGggYSBkaWZmZXJlbnQgcHJpY2UuXCIpO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW5jeVByaWNlID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmN1cnJlbmN5UHJpY2VGb3JMaXN0aW5nKGxpc3RpbmdJZCwgY3VycmVuY3lDb250cmFjdEFkZHJlc3MpO1xuICAgIGludmFyaWFudChwcmljZVBlclRva2VuSW5DdXJyZW5jeSA9PT0gY3VycmVuY3lQcmljZSwgXCJDdXJyZW5jeSBhbHJlYWR5IGFwcHJvdmVkIHdpdGggdGhpcyBwcmljZS5cIik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY2VpcHQ6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImFwcHJvdmVDdXJyZW5jeUZvckxpc3RpbmdcIiwgW2xpc3RpbmdJZCwgY3VycmVuY3lDb250cmFjdEFkZHJlc3MsIHByaWNlUGVyVG9rZW5JbkN1cnJlbmN5XSlcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldm9rZSBhcHByb3ZhbCBvZiBhIGN1cnJlbmN5IGZyb20gYSBsaXN0aW5nLlxuICAgKlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIFRoZSBsaXN0aW5nIElEIG9mIHRoZSBkaXJlY3QgbGlzdGluZyB5b3Ugd2FudCB0byByZXZva2UgY3VycmVuY3kgZm9yXG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IFwiMFwiO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy5yZXZva2VDdXJyZW5jeUFwcHJvdmFsRm9yTGlzdGluZyhsaXN0aW5nSWQsIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSBsaXN0aW5nSWQgLSBUaGUgbGlzdGluZyBpZCB0byBidXlcbiAgICogQHBhcmFtIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzIC0gQWRkcmVzcyBvZiBjdXJyZW5jeVxuICAgKi9cbiAgYXN5bmMgcmV2b2tlQ3VycmVuY3lBcHByb3ZhbEZvckxpc3RpbmcobGlzdGluZ0lkLCBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcykge1xuICAgIGNvbnN0IGxpc3RpbmcgPSBhd2FpdCB0aGlzLnZhbGlkYXRlTGlzdGluZyhCaWdOdW1iZXIuZnJvbShsaXN0aW5nSWQpKTtcbiAgICBpZiAoY3VycmVuY3lDb250cmFjdEFkZHJlc3MgPT09IGxpc3RpbmcuY3VycmVuY3lDb250cmFjdEFkZHJlc3MpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgcmV2b2tlIGFwcHJvdmFsIGZvciBtYWluIGxpc3RpbmcgY3VycmVuY3kuYCk7XG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbmN5UHJpY2UgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkQ29udHJhY3QuY3VycmVuY3lQcmljZUZvckxpc3RpbmcobGlzdGluZ0lkLCBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyk7XG4gICAgaW52YXJpYW50KCFjdXJyZW5jeVByaWNlLmlzWmVybygpLCBcIkN1cnJlbmN5IG5vdCBhcHByb3ZlZC5cIik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY2VpcHQ6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImFwcHJvdmVDdXJyZW5jeUZvckxpc3RpbmdcIiwgW2xpc3RpbmdJZCwgY3VycmVuY3lDb250cmFjdEFkZHJlc3MsIEJpZ051bWJlci5mcm9tKDApXSlcbiAgICB9O1xuICB9XG5cbiAgLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBQUklWQVRFIEZVTkNUSU9OU1xuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAvKipcbiAgICogVGhyb3dzIGVycm9yIGlmIGxpc3RpbmcgY291bGQgbm90IGJlIGZvdW5kXG4gICAqXG4gICAqIEBwYXJhbSBsaXN0aW5nSWQgLSBMaXN0aW5nIHRvIGNoZWNrIGZvclxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVMaXN0aW5nKGxpc3RpbmdJZCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRMaXN0aW5nKGxpc3RpbmdJZCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBnZXR0aW5nIHRoZSBsaXN0aW5nIHdpdGggaWQgJHtsaXN0aW5nSWR9YCk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2QgbWFwcyB0aGUgYXVjdGlvbiBsaXN0aW5nIHRvIHRoZSBkaXJlY3QgbGlzdGluZyBpbnRlcmZhY2UuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKiBAcGFyYW0gbGlzdGluZyAtIFRoZSBsaXN0aW5nIHRvIG1hcCwgYXMgcmV0dXJuZWQgZnJvbSB0aGUgY29udHJhY3QuXG4gICAqIEByZXR1cm5zIC0gVGhlIG1hcHBlZCBpbnRlcmZhY2UuXG4gICAqL1xuICBhc3luYyBtYXBMaXN0aW5nKGxpc3RpbmcpIHtcbiAgICBsZXQgc3RhdHVzID0gU3RhdHVzLlVOU0VUO1xuICAgIGNvbnN0IGJsb2NrID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKS5nZXRCbG9jayhcImxhdGVzdFwiKTtcbiAgICBjb25zdCBibG9ja1RpbWUgPSBibG9jay50aW1lc3RhbXA7XG4gICAgc3dpdGNoIChsaXN0aW5nLnN0YXR1cykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzdGF0dXMgPSBCaWdOdW1iZXIuZnJvbShsaXN0aW5nLnN0YXJ0VGltZXN0YW1wKS5ndChibG9ja1RpbWUpID8gU3RhdHVzLkNyZWF0ZWQgOiBCaWdOdW1iZXIuZnJvbShsaXN0aW5nLmVuZFRpbWVzdGFtcCkubHQoYmxvY2tUaW1lKSA/IFN0YXR1cy5FeHBpcmVkIDogU3RhdHVzLkFjdGl2ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHN0YXR1cyA9IFN0YXR1cy5Db21wbGV0ZWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBzdGF0dXMgPSBTdGF0dXMuQ2FuY2VsbGVkO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGFzc2V0Q29udHJhY3RBZGRyZXNzOiBsaXN0aW5nLmFzc2V0Q29udHJhY3QsXG4gICAgICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzczogbGlzdGluZy5jdXJyZW5jeSxcbiAgICAgIHByaWNlUGVyVG9rZW46IGxpc3RpbmcucHJpY2VQZXJUb2tlbi50b1N0cmluZygpLFxuICAgICAgY3VycmVuY3lWYWx1ZVBlclRva2VuOiBhd2FpdCBmZXRjaEN1cnJlbmN5VmFsdWUodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgbGlzdGluZy5jdXJyZW5jeSwgbGlzdGluZy5wcmljZVBlclRva2VuKSxcbiAgICAgIGlkOiBsaXN0aW5nLmxpc3RpbmdJZC50b1N0cmluZygpLFxuICAgICAgdG9rZW5JZDogbGlzdGluZy50b2tlbklkLnRvU3RyaW5nKCksXG4gICAgICBxdWFudGl0eTogbGlzdGluZy5xdWFudGl0eS50b1N0cmluZygpLFxuICAgICAgc3RhcnRUaW1lSW5TZWNvbmRzOiBCaWdOdW1iZXIuZnJvbShsaXN0aW5nLnN0YXJ0VGltZXN0YW1wKS50b051bWJlcigpLFxuICAgICAgYXNzZXQ6IGF3YWl0IGZldGNoVG9rZW5NZXRhZGF0YUZvckNvbnRyYWN0KGxpc3RpbmcuYXNzZXRDb250cmFjdCwgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgbGlzdGluZy50b2tlbklkLCB0aGlzLnN0b3JhZ2UpLFxuICAgICAgZW5kVGltZUluU2Vjb25kczogQmlnTnVtYmVyLmZyb20obGlzdGluZy5lbmRUaW1lc3RhbXApLnRvTnVtYmVyKCksXG4gICAgICBjcmVhdG9yQWRkcmVzczogbGlzdGluZy5saXN0aW5nQ3JlYXRvcixcbiAgICAgIGlzUmVzZXJ2ZWRMaXN0aW5nOiBsaXN0aW5nLnJlc2VydmVkLFxuICAgICAgc3RhdHVzOiBzdGF0dXNcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZSB0aGlzIG1ldGhvZCB0byBjaGVjayBpZiBhIGRpcmVjdCBsaXN0aW5nIGlzIHN0aWxsIHZhbGlkLlxuICAgKlxuICAgKiBXYXlzIGEgZGlyZWN0IGxpc3RpbmcgY2FuIGJlY29tZSBpbnZhbGlkOlxuICAgKiAxLiBUaGUgYXNzZXQgaG9sZGVyIHRyYW5zZmVycmVkIHRoZSBhc3NldCB0byBhbm90aGVyIHdhbGxldFxuICAgKiAyLiBUaGUgYXNzZXQgaG9sZGVyIGJ1cm5lZCB0aGUgYXNzZXRcbiAgICogMy4gVGhlIGFzc2V0IGhvbGRlciByZW1vdmVkIHRoZSBhcHByb3ZhbCBvbiB0aGUgbWFya2V0cGxhY2VcbiAgICpcbiAgICogQGludGVybmFsXG4gICAqIEBwYXJhbSBsaXN0aW5nIC0gVGhlIGxpc3RpbmcgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIC0gVHJ1ZSBpZiB0aGUgbGlzdGluZyBpcyB2YWxpZCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgYXN5bmMgaXNTdGlsbFZhbGlkTGlzdGluZyhsaXN0aW5nLCBxdWFudGl0eSkge1xuICAgIGNvbnN0IGFwcHJvdmVkID0gYXdhaXQgaXNUb2tlbkFwcHJvdmVkRm9yVHJhbnNmZXIodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgdGhpcy5nZXRBZGRyZXNzKCksIGxpc3RpbmcuYXNzZXRDb250cmFjdEFkZHJlc3MsIGxpc3RpbmcudG9rZW5JZCwgbGlzdGluZy5jcmVhdG9yQWRkcmVzcyk7XG4gICAgaWYgKCFhcHByb3ZlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjogYFRva2VuICcke2xpc3RpbmcudG9rZW5JZH0nIGZyb20gY29udHJhY3QgJyR7bGlzdGluZy5hc3NldENvbnRyYWN0QWRkcmVzc30nIGlzIG5vdCBhcHByb3ZlZCBmb3IgdHJhbnNmZXJgXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCk7XG4gICAgY29uc3QgZXJjMTY1ID0gbmV3IENvbnRyYWN0KGxpc3RpbmcuYXNzZXRDb250cmFjdEFkZHJlc3MsIEVSQzE2NUFiaSwgcHJvdmlkZXIpO1xuICAgIGNvbnN0IGlzRVJDNzIxID0gYXdhaXQgZXJjMTY1LnN1cHBvcnRzSW50ZXJmYWNlKEludGVyZmFjZUlkX0lFUkM3MjEpO1xuICAgIGNvbnN0IGlzRVJDMTE1NSA9IGF3YWl0IGVyYzE2NS5zdXBwb3J0c0ludGVyZmFjZShJbnRlcmZhY2VJZF9JRVJDMTE1NSk7XG4gICAgaWYgKGlzRVJDNzIxKSB7XG4gICAgICBjb25zdCBhc3NldCA9IG5ldyBDb250cmFjdChsaXN0aW5nLmFzc2V0Q29udHJhY3RBZGRyZXNzLCBFcmM3MjFBYmksIHByb3ZpZGVyKTtcbiAgICAgIGNvbnN0IHZhbGlkID0gKGF3YWl0IGFzc2V0Lm93bmVyT2YobGlzdGluZy50b2tlbklkKSkudG9Mb3dlckNhc2UoKSA9PT0gbGlzdGluZy5jcmVhdG9yQWRkcmVzcy50b0xvd2VyQ2FzZSgpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQsXG4gICAgICAgIGVycm9yOiB2YWxpZCA/IHVuZGVmaW5lZCA6IGBTZWxsZXIgaXMgbm90IHRoZSBvd25lciBvZiBUb2tlbiAnJHtsaXN0aW5nLnRva2VuSWR9JyBmcm9tIGNvbnRyYWN0ICcke2xpc3RpbmcuYXNzZXRDb250cmFjdEFkZHJlc3N9IGFueW1vcmUnYFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGlzRVJDMTE1NSkge1xuICAgICAgY29uc3QgYXNzZXQgPSBuZXcgQ29udHJhY3QobGlzdGluZy5hc3NldENvbnRyYWN0QWRkcmVzcywgRXJjMTE1NUFiaSwgcHJvdmlkZXIpO1xuICAgICAgY29uc3QgYmFsYW5jZSA9IGF3YWl0IGFzc2V0LmJhbGFuY2VPZihsaXN0aW5nLmNyZWF0b3JBZGRyZXNzLCBsaXN0aW5nLnRva2VuSWQpO1xuICAgICAgY29uc3QgdmFsaWQgPSBiYWxhbmNlLmd0ZShxdWFudGl0eSB8fCBsaXN0aW5nLnF1YW50aXR5KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkLFxuICAgICAgICBlcnJvcjogdmFsaWQgPyB1bmRlZmluZWQgOiBgU2VsbGVyIGRvZXMgbm90IGhhdmUgZW5vdWdoIGJhbGFuY2Ugb2YgVG9rZW4gJyR7bGlzdGluZy50b2tlbklkfScgZnJvbSBjb250cmFjdCAnJHtsaXN0aW5nLmFzc2V0Q29udHJhY3RBZGRyZXNzfSB0byBmdWxmaWxsIHRoZSBsaXN0aW5nYFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjogXCJDb250cmFjdCBkb2VzIG5vdCBpbXBsZW1lbnQgRVJDIDExNTUgb3IgRVJDIDcyMS5cIlxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgYXBwbHlGaWx0ZXIobGlzdGluZ3MsIGZpbHRlcikge1xuICAgIGxldCByYXdMaXN0aW5ncyA9IFsuLi5saXN0aW5nc107XG4gICAgaWYgKGZpbHRlcikge1xuICAgICAgaWYgKGZpbHRlci5zZWxsZXIpIHtcbiAgICAgICAgcmF3TGlzdGluZ3MgPSByYXdMaXN0aW5ncy5maWx0ZXIoc2VsbGVyID0+IHNlbGxlci5saXN0aW5nQ3JlYXRvci50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT09IGZpbHRlcj8uc2VsbGVyPy50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfVxuICAgICAgaWYgKGZpbHRlci50b2tlbkNvbnRyYWN0KSB7XG4gICAgICAgIHJhd0xpc3RpbmdzID0gcmF3TGlzdGluZ3MuZmlsdGVyKHRva2VuQ29udHJhY3QgPT4gdG9rZW5Db250cmFjdC5hc3NldENvbnRyYWN0LnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PT0gZmlsdGVyPy50b2tlbkNvbnRyYWN0Py50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfVxuICAgICAgaWYgKGZpbHRlci50b2tlbklkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmF3TGlzdGluZ3MgPSByYXdMaXN0aW5ncy5maWx0ZXIodG9rZW5Db250cmFjdCA9PiB0b2tlbkNvbnRyYWN0LnRva2VuSWQudG9TdHJpbmcoKSA9PT0gZmlsdGVyPy50b2tlbklkPy50b1N0cmluZygpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZpbHRlcj8uY291bnQgJiYgZmlsdGVyLmNvdW50IDwgcmF3TGlzdGluZ3MubGVuZ3RoID8gcmF3TGlzdGluZ3Muc2xpY2UoMCwgZmlsdGVyLmNvdW50KSA6IHJhd0xpc3RpbmdzO1xuICB9XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmNvbnN0IEVuZ2xpc2hBdWN0aW9uSW5wdXRQYXJhbXNTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIC8qKlxuICAgKiBUaGUgYWRkcmVzcyBvZiB0aGUgYXNzZXQgYmVpbmcgYXVjdGlvbmVkLlxuICAgKi9cbiAgYXNzZXRDb250cmFjdEFkZHJlc3M6IEFkZHJlc3NTY2hlbWEsXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIGF1Y3Rpb24uXG4gICAqL1xuICB0b2tlbklkOiBCaWdOdW1iZXJpc2hTY2hlbWEsXG4gIC8qKlxuICAgKiBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGluY2x1ZGUgaW4gdGhlIGxpc3RpbmcuXG4gICAqXG4gICAqIEZvciBFUkM3MjFzLCB0aGlzIHZhbHVlIHNob3VsZCBhbHdheXMgYmUgMSAoYW5kIHdpbGwgYmUgZm9yY2VkIGludGVybmFsbHkgcmVnYXJkbGVzcyBvZiB3aGF0IGlzIHBhc3NlZCBoZXJlKS5cbiAgICovXG4gIHF1YW50aXR5OiBCaWdOdW1iZXJpc2hTY2hlbWEuZGVmYXVsdCgxKSxcbiAgLyoqXG4gICAqIFRoZSBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSB0byBhY2NlcHQgZm9yIHRoZSBsaXN0aW5nLlxuICAgKi9cbiAgY3VycmVuY3lDb250cmFjdEFkZHJlc3M6IEFkZHJlc3NTY2hlbWEuZGVmYXVsdChOQVRJVkVfVE9LRU5fQUREUkVTUyksXG4gIC8qKlxuICAgKiBUaGUgbWluaW11bSBwcmljZSB0aGF0IGEgYmlkIG11c3QgYmUgaW4gb3JkZXIgdG8gYmUgYWNjZXB0ZWQuXG4gICAqL1xuICBtaW5pbXVtQmlkQW1vdW50OiBBbW91bnRTY2hlbWEsXG4gIC8qKlxuICAgKiBUaGUgYnV5b3V0IHByaWNlIG9mIHRoZSBhdWN0aW9uLlxuICAgKi9cbiAgYnV5b3V0QmlkQW1vdW50OiBBbW91bnRTY2hlbWEsXG4gIC8qKlxuICAgKiBUaGlzIGlzIGEgYnVmZmVyIGUuZy4geCBzZWNvbmRzLlxuICAgKlxuICAgKiBJZiBhIG5ldyB3aW5uaW5nIGJpZCBpcyBtYWRlIGxlc3MgdGhhbiB4IHNlY29uZHMgYmVmb3JlIGV4cGlyYXRpb25UaW1lc3RhbXAsIHRoZVxuICAgKiBleHBpcmF0aW9uVGltZXN0YW1wIGlzIGluY3JlYXNlZCBieSB4IHNlY29uZHMuXG4gICAqL1xuICB0aW1lQnVmZmVySW5TZWNvbmRzOiBCaWdOdW1iZXJpc2hTY2hlbWEuZGVmYXVsdCg5MDApLFxuICAvLyAxNSBtaW51dGVzIGJ5IGRlZmF1bHRcblxuICAvKipcbiAgICogVGhpcyBpcyBhIGJ1ZmZlciBpbiBiYXNpcyBwb2ludHMgZS5nLiB4JS5cbiAgICpcbiAgICogVG8gYmUgY29uc2lkZXJlZCBhcyBhIG5ldyB3aW5uaW5nIGJpZCwgYSBiaWQgbXVzdCBiZSBhdCBsZWFzdCB4JSBncmVhdGVyIHRoYW5cbiAgICogdGhlIGN1cnJlbnQgd2lubmluZyBiaWQuXG4gICAqL1xuICBiaWRCdWZmZXJCcHM6IEJpZ051bWJlcmlzaFNjaGVtYS5kZWZhdWx0KDUwMCksXG4gIC8vIDUlIGJ5IGRlZmF1bHRcblxuICAvKipcbiAgICogVGhlIHN0YXJ0IHRpbWUgb2YgdGhlIGF1Y3Rpb24uXG4gICAqL1xuICBzdGFydFRpbWVzdGFtcDogUmF3RGF0ZVNjaGVtYS5kZWZhdWx0KG5ldyBEYXRlKCkpLFxuICAvKipcbiAgICogVGhlIGVuZCB0aW1lIG9mIHRoZSBhdWN0aW9uLlxuICAgKi9cbiAgZW5kVGltZXN0YW1wOiBFbmREYXRlU2NoZW1hXG59KTtcblxuLyoqXG4gKiBAcHVibGljXG4gKi9cblxuLyoqXG4gKiBIYW5kbGVzIGF1Y3Rpb25zXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIE1hcmtldHBsYWNlVjNFbmdsaXNoQXVjdGlvbnMge1xuICAvLyB1dGlsaXRpZXNcblxuICBjb25zdHJ1Y3Rvcihjb250cmFjdFdyYXBwZXIsIHN0b3JhZ2UpIHtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJmZWF0dXJlTmFtZVwiLCBGRUFUVVJFX0VOR0xJU0hfQVVDVElPTlMubmFtZSk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiY29udHJhY3RXcmFwcGVyXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RvcmFnZVwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImV2ZW50c1wiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImludGVyY2VwdG9yXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiZW5jb2RlclwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImVzdGltYXRvclwiLCB2b2lkIDApO1xuICAgIHRoaXMuY29udHJhY3RXcmFwcGVyID0gY29udHJhY3RXcmFwcGVyO1xuICAgIHRoaXMuc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgdGhpcy5ldmVudHMgPSBuZXcgQ29udHJhY3RFdmVudHModGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuZW5jb2RlciA9IG5ldyBDb250cmFjdEVuY29kZXIodGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuaW50ZXJjZXB0b3IgPSBuZXcgQ29udHJhY3RJbnRlcmNlcHRvcih0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gICAgdGhpcy5lc3RpbWF0b3IgPSBuZXcgR2FzQ29zdEVzdGltYXRvcih0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gIH1cbiAgZ2V0QWRkcmVzcygpIHtcbiAgICByZXR1cm4gdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmFkZHJlc3M7XG4gIH1cblxuICAvKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIFJFQUQgRlVOQ1RJT05TXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRvdGFsIG51bWJlciBvZiBlbmdsaXNoIGF1Y3Rpb25zLlxuICAgKiBAcmV0dXJucyBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgYXVjdGlvbnMgY3JlYXRlZC5cbiAgICogQHB1YmxpY1xuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IHRvdGFsQXVjdGlvbnMgPSBhd2FpdCBjb250cmFjdC5lbmdsaXNoQXVjdGlvbnMuZ2V0VG90YWxDb3VudCgpO1xuICAgKiBgYGBcbiAgICovXG4gIGFzeW5jIGdldFRvdGFsQ291bnQoKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC50b3RhbEF1Y3Rpb25zKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBhdWN0aW9ucy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiBjb25zdCBhdWN0aW9ucyA9IGF3YWl0IGNvbnRyYWN0LmVuZ2xpc2hBdWN0aW9ucy5nZXRBbGwoKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSBmaWx0ZXIgLSBvcHRpb25hbCBmaWx0ZXIgcGFyYW1ldGVyc1xuICAgKiBAcmV0dXJucyB0aGUgQXVjdGlvbiBvYmplY3QgYXJyYXlcbiAgICovXG4gIGFzeW5jIGdldEFsbChmaWx0ZXIpIHtcbiAgICBjb25zdCB0b3RhbEF1Y3Rpb25zID0gYXdhaXQgdGhpcy5nZXRUb3RhbENvdW50KCk7XG4gICAgbGV0IHN0YXJ0ID0gQmlnTnVtYmVyLmZyb20oZmlsdGVyPy5zdGFydCB8fCAwKS50b051bWJlcigpO1xuICAgIGxldCBlbmQgPSB0b3RhbEF1Y3Rpb25zLnRvTnVtYmVyKCk7XG4gICAgaWYgKGVuZCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBhdWN0aW9ucyBleGlzdCBvbiB0aGUgY29udHJhY3QuYCk7XG4gICAgfVxuICAgIGxldCByYXdBdWN0aW9ucyA9IFtdO1xuICAgIGxldCBiYXRjaGVzID0gYXdhaXQgZ2V0QWxsSW5CYXRjaGVzKHN0YXJ0LCBlbmQsIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5nZXRBbGxBdWN0aW9ucyk7XG4gICAgcmF3QXVjdGlvbnMgPSBiYXRjaGVzLmZsYXQoKTtcbiAgICBjb25zdCBmaWx0ZXJlZEF1Y3Rpb25zID0gdGhpcy5hcHBseUZpbHRlcihyYXdBdWN0aW9ucywgZmlsdGVyKTtcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwoZmlsdGVyZWRBdWN0aW9ucy5tYXAoYXVjdGlvbiA9PiB0aGlzLm1hcEF1Y3Rpb24oYXVjdGlvbikpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIHZhbGlkIGF1Y3Rpb25zLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IGF1Y3Rpb25zID0gYXdhaXQgY29udHJhY3QuZW5nbGlzaEF1Y3Rpb25zLmdldEFsbFZhbGlkKCk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gZmlsdGVyIC0gb3B0aW9uYWwgZmlsdGVyIHBhcmFtZXRlcnNcbiAgICogQHJldHVybnMgdGhlIEF1Y3Rpb24gb2JqZWN0IGFycmF5XG4gICAqL1xuICBhc3luYyBnZXRBbGxWYWxpZChmaWx0ZXIpIHtcbiAgICBjb25zdCB0b3RhbEF1Y3Rpb25zID0gYXdhaXQgdGhpcy5nZXRUb3RhbENvdW50KCk7XG4gICAgbGV0IHN0YXJ0ID0gQmlnTnVtYmVyLmZyb20oZmlsdGVyPy5zdGFydCB8fCAwKS50b051bWJlcigpO1xuICAgIGxldCBlbmQgPSB0b3RhbEF1Y3Rpb25zLnRvTnVtYmVyKCk7XG4gICAgaWYgKGVuZCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBhdWN0aW9ucyBleGlzdCBvbiB0aGUgY29udHJhY3QuYCk7XG4gICAgfVxuICAgIGxldCByYXdBdWN0aW9ucyA9IFtdO1xuICAgIGxldCBiYXRjaGVzID0gYXdhaXQgZ2V0QWxsSW5CYXRjaGVzKHN0YXJ0LCBlbmQsIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5nZXRBbGxWYWxpZEF1Y3Rpb25zKTtcbiAgICByYXdBdWN0aW9ucyA9IGJhdGNoZXMuZmxhdCgpO1xuICAgIGNvbnN0IGZpbHRlcmVkQXVjdGlvbnMgPSB0aGlzLmFwcGx5RmlsdGVyKHJhd0F1Y3Rpb25zLCBmaWx0ZXIpO1xuICAgIHJldHVybiBhd2FpdCBQcm9taXNlLmFsbChmaWx0ZXJlZEF1Y3Rpb25zLm1hcChhdWN0aW9uID0+IHRoaXMubWFwQXVjdGlvbihhdWN0aW9uKSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbiBBdWN0aW9uIGJ5IGlkLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IGF1Y3Rpb25JZCA9IDA7XG4gICAqIGNvbnN0IGF1Y3Rpb24gPSBhd2FpdCBjb250cmFjdC5lbmdsaXNoQXVjdGlvbnMuZ2V0QXVjdGlvbihhdWN0aW9uSWQpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIGF1Y3Rpb25JZCAtIHRoZSBhdWN0aW9uIElkXG4gICAqIEByZXR1cm5zIHRoZSBBdWN0aW9uIG9iamVjdFxuICAgKi9cbiAgYXN5bmMgZ2V0QXVjdGlvbihhdWN0aW9uSWQpIHtcbiAgICBjb25zdCBhdWN0aW9uID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmdldEF1Y3Rpb24oYXVjdGlvbklkKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5tYXBBdWN0aW9uKGF1Y3Rpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBIaWdoZXN0IEJpZFxuICAgKlxuICAgKiBAcmVtYXJrcyBHZXQgdGhlIGN1cnJlbnQgaGlnaGVzdCBiaWQgb2YgYW4gYWN0aXZlIGF1Y3Rpb24uXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIElEIG9mIHRoZSBhdWN0aW9uXG4gICAqIGNvbnN0IGF1Y3Rpb25JZCA9IDA7XG4gICAqXG4gICAqIGNvbnRyYWN0LmVuZ2xpc2hBdWN0aW9ucy5cbiAgICogICAuZ2V0V2lubmluZ0JpZChhdWN0aW9uSWQpXG4gICAqICAgLnRoZW4oKGJpZCkgPT4gY29uc29sZS5sb2coYmlkKSlcbiAgICogICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBnZXRXaW5uaW5nQmlkKGF1Y3Rpb25JZCkge1xuICAgIGF3YWl0IHRoaXMudmFsaWRhdGVBdWN0aW9uKEJpZ051bWJlci5mcm9tKGF1Y3Rpb25JZCkpO1xuICAgIGNvbnN0IGJpZCA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5nZXRXaW5uaW5nQmlkKGF1Y3Rpb25JZCk7XG4gICAgaWYgKGJpZC5fYmlkZGVyID09PSBjb25zdGFudHMuQWRkcmVzc1plcm8pIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLm1hcEJpZChhdWN0aW9uSWQudG9TdHJpbmcoKSwgYmlkLl9iaWRkZXIsIGJpZC5fY3VycmVuY3ksIGJpZC5fYmlkQW1vdW50LnRvU3RyaW5nKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGEgYmlkLWFtb3VudCBpcy93aWxsIGJlIGEgd2lubmluZyBiaWQuXG4gICAqXG4gICAqIEBwYXJhbSBhdWN0aW9uSWQgLSBBdWN0aW9uIElkXG4gICAqIEBwYXJhbSBiaWRBbW91bnQgLSBBbW91bnQgdG8gYmlkXG4gICAqIEByZXR1cm5zIHRoZSBBdWN0aW9uIG9iamVjdFxuICAgKi9cbiAgYXN5bmMgaXNXaW5uaW5nQmlkKGF1Y3Rpb25JZCwgYmlkQW1vdW50KSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5pc05ld1dpbm5pbmdCaWQoYXVjdGlvbklkLCBiaWRBbW91bnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBBdWN0aW9uIFdpbm5lclxuICAgKlxuICAgKiBAcmVtYXJrcyBHZXQgdGhlIHdpbm5lciBvZiB0aGUgYXVjdGlvbiBhZnRlciBhbiBhdWN0aW9uIGVuZHMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGF1Y3Rpb24gSUQgb2YgdGhlIGF1Y3Rpb24gdGhhdCBjbG9zZWRcbiAgICogY29uc3QgYXVjdGlvbklkID0gMDtcbiAgICpcbiAgICogY29udHJhY3QuZW5nbGlzaEF1Y3Rpb25zLlxuICAgKiAgIC5nZXRXaW5uZXIoYXVjdGlvbklkKVxuICAgKiAgIC50aGVuKChhdWN0aW9uV2lubmVyKSA9PiBjb25zb2xlLmxvZyhhdWN0aW9uV2lubmVyKSlcbiAgICogICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBnZXRXaW5uZXIoYXVjdGlvbklkKSB7XG4gICAgY29uc3QgYXVjdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVBdWN0aW9uKEJpZ051bWJlci5mcm9tKGF1Y3Rpb25JZCkpO1xuICAgIGNvbnN0IGJpZCA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5nZXRXaW5uaW5nQmlkKGF1Y3Rpb25JZCk7XG4gICAgY29uc3Qgbm93ID0gQmlnTnVtYmVyLmZyb20oTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkpO1xuICAgIGNvbnN0IGVuZFRpbWUgPSBCaWdOdW1iZXIuZnJvbShhdWN0aW9uLmVuZFRpbWVJblNlY29uZHMpO1xuXG4gICAgLy8gaWYgd2UgaGF2ZSBhIHdpbm5lciBpbiB0aGUgbWFwIGFuZCB0aGUgY3VycmVudCB0aW1lIGlzIHBhc3QgdGhlIGVuZHRpbWUgb2YgdGhlIGF1Y3Rpb24gcmV0dXJuIHRoZSBhZGRyZXNzIG9mIHRoZSB3aW5uZXJcbiAgICBpZiAobm93Lmd0KGVuZFRpbWUpICYmIGJpZC5fYmlkZGVyICE9PSBjb25zdGFudHMuQWRkcmVzc1plcm8pIHtcbiAgICAgIHJldHVybiBiaWQuX2JpZGRlcjtcbiAgICB9XG4gICAgLy8gb3RoZXJ3aXNlIGZhbGwgYmFjayB0byBxdWVyeSBmaWx0ZXIgdGhpbmdzXG5cbiAgICAvLyBUT0RPIHRoaXMgc2hvdWxkIGJlIHZpYSBpbmRleGVyIG9yIGRpcmVjdCBjb250cmFjdCBjYWxsXG4gICAgY29uc3QgY2xvc2VkQXVjdGlvbnMgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkQ29udHJhY3QucXVlcnlGaWx0ZXIodGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmZpbHRlcnMuQXVjdGlvbkNsb3NlZCgpKTtcbiAgICBjb25zdCBjbG9zZWQgPSBjbG9zZWRBdWN0aW9ucy5maW5kKGEgPT4gYS5hcmdzLmF1Y3Rpb25JZC5lcShCaWdOdW1iZXIuZnJvbShhdWN0aW9uSWQpKSk7XG4gICAgaWYgKCFjbG9zZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgYXVjdGlvbiB3aXRoIElEICR7YXVjdGlvbklkfSBpbiBjbG9zZWQgYXVjdGlvbnNgKTtcbiAgICB9XG4gICAgcmV0dXJuIGNsb3NlZC5hcmdzLndpbm5pbmdCaWRkZXI7XG4gIH1cblxuICAvKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIFdSSVRFIEZVTkNUSU9OU1xuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAvKipcbiAgICogQ3JlYXRlIEF1Y3Rpb25cbiAgICpcbiAgICogQHJlbWFya3MgQ3JlYXRlIGEgbmV3IGF1Y3Rpb24gd2hlcmUgcGVvcGxlIGNhbiBiaWQgb24gYW4gYXNzZXQuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gRGF0YSBvZiB0aGUgYXVjdGlvbiB5b3Ugd2FudCB0byBjcmVhdGVcbiAgICogY29uc3QgYXVjdGlvbiA9IHtcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gYXVjdGlvblxuICAgKiAgIGFzc2V0Q29udHJhY3RBZGRyZXNzOiBcIjB4Li4uXCIsXG4gICAqICAgLy8gdG9rZW4gSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGF1Y3Rpb25cbiAgICogICB0b2tlbklkOiBcIjBcIixcbiAgICogICAvLyBob3cgbWFueSBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gYXVjdGlvblxuICAgKiAgIHF1YW50aXR5OiAxLFxuICAgKiAgIC8vIGFkZHJlc3Mgb2YgdGhlIGN1cnJlbmN5IGNvbnRyYWN0IHRoYXQgd2lsbCBiZSB1c2VkIHRvIHBheSBmb3IgdGhlIGF1Y3Rpb25lZCB0b2tlbnNcbiAgICogICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzczogTkFUSVZFX1RPS0VOX0FERFJFU1MsXG4gICAqICAgLy8gdGhlIG1pbmltdW0gYmlkIHRoYXQgd2lsbCBiZSBhY2NlcHRlZCBmb3IgdGhlIHRva2VuXG4gICAqICAgbWluaW11bUJpZEFtb3VudDogXCIxLjVcIixcbiAgICogICAvLyBob3cgbXVjaCBwZW9wbGUgd291bGQgaGF2ZSB0byBiaWQgdG8gaW5zdGFudGx5IGJ1eSB0aGUgYXNzZXRcbiAgICogICBidXlvdXRCaWRBbW91bnQ6IFwiMTBcIixcbiAgICogICAvLyBJZiBhIGJpZCBpcyBtYWRlIGxlc3MgdGhhbiB0aGVzZSBtYW55IHNlY29uZHMgYmVmb3JlIGV4cGlyYXRpb24sIHRoZSBleHBpcmF0aW9uIHRpbWUgaXMgaW5jcmVhc2VkIGJ5IHRoaXMuXG4gICAqICAgdGltZUJ1ZmZlckluU2Vjb25kczogXCI5MDBcIiwgLy8gMTUgbWludXRlcyBieSBkZWZhdWx0XG4gICAqICAgLy8gQSBiaWQgbXVzdCBiZSBhdCBsZWFzdCB0aGlzIG11Y2ggYnBzIGdyZWF0ZXIgdGhhbiB0aGUgY3VycmVudCB3aW5uaW5nIGJpZFxuICAgKiAgIGJpZEJ1ZmZlckJwczogXCI1MDBcIiwgLy8gNSUgYnkgZGVmYXVsdFxuICAgKiAgIC8vIHdoZW4gc2hvdWxkIHRoZSBhdWN0aW9uIG9wZW4gdXAgZm9yIGJpZGRpbmdcbiAgICogICBzdGFydFRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSksXG4gICAqICAgLy8gZW5kIHRpbWUgb2YgYXVjdGlvblxuICAgKiAgIGVuZFRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LmVuZ2xpc2hBdWN0aW9ucy5jcmVhdGVBdWN0aW9uKGF1Y3Rpb24pO1xuICAgKiBjb25zdCByZWNlaXB0ID0gdHgucmVjZWlwdDsgLy8gdGhlIHRyYW5zYWN0aW9uIHJlY2VpcHRcbiAgICogY29uc3QgaWQgPSB0eC5pZDsgLy8gdGhlIGlkIG9mIHRoZSBuZXdseSBjcmVhdGVkIGF1Y3Rpb25cbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBjcmVhdGVBdWN0aW9uKGF1Y3Rpb24pIHtcbiAgICBjb25zdCBwYXJzZWRBdWN0aW9uID0gRW5nbGlzaEF1Y3Rpb25JbnB1dFBhcmFtc1NjaGVtYS5wYXJzZShhdWN0aW9uKTtcbiAgICBhd2FpdCBoYW5kbGVUb2tlbkFwcHJvdmFsKHRoaXMuY29udHJhY3RXcmFwcGVyLCB0aGlzLmdldEFkZHJlc3MoKSwgcGFyc2VkQXVjdGlvbi5hc3NldENvbnRyYWN0QWRkcmVzcywgcGFyc2VkQXVjdGlvbi50b2tlbklkLCBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRTaWduZXJBZGRyZXNzKCkpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRCdXlvdXRBbW91bnQgPSBhd2FpdCBub3JtYWxpemVQcmljZVZhbHVlKHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCksIHBhcnNlZEF1Y3Rpb24uYnV5b3V0QmlkQW1vdW50LCBwYXJzZWRBdWN0aW9uLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKTtcbiAgICBjb25zdCBub3JtYWxpemVkTWluQmlkQW1vdW50ID0gYXdhaXQgbm9ybWFsaXplUHJpY2VWYWx1ZSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBwYXJzZWRBdWN0aW9uLm1pbmltdW1CaWRBbW91bnQsIHBhcnNlZEF1Y3Rpb24uY3VycmVuY3lDb250cmFjdEFkZHJlc3MpO1xuICAgIGNvbnN0IGJsb2NrID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKS5nZXRCbG9jayhcImxhdGVzdFwiKTtcbiAgICBjb25zdCBibG9ja1RpbWUgPSBibG9jay50aW1lc3RhbXA7XG4gICAgaWYgKHBhcnNlZEF1Y3Rpb24uc3RhcnRUaW1lc3RhbXAubHQoYmxvY2tUaW1lKSkge1xuICAgICAgcGFyc2VkQXVjdGlvbi5zdGFydFRpbWVzdGFtcCA9IEJpZ051bWJlci5mcm9tKGJsb2NrVGltZSk7XG4gICAgfVxuICAgIGNvbnN0IHJlY2VpcHQgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5zZW5kVHJhbnNhY3Rpb24oXCJjcmVhdGVBdWN0aW9uXCIsIFt7XG4gICAgICBhc3NldENvbnRyYWN0OiBwYXJzZWRBdWN0aW9uLmFzc2V0Q29udHJhY3RBZGRyZXNzLFxuICAgICAgdG9rZW5JZDogcGFyc2VkQXVjdGlvbi50b2tlbklkLFxuICAgICAgcXVhbnRpdHk6IHBhcnNlZEF1Y3Rpb24ucXVhbnRpdHksXG4gICAgICBjdXJyZW5jeTogY2xlYW5DdXJyZW5jeUFkZHJlc3MocGFyc2VkQXVjdGlvbi5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyksXG4gICAgICBtaW5pbXVtQmlkQW1vdW50OiBub3JtYWxpemVkTWluQmlkQW1vdW50LFxuICAgICAgYnV5b3V0QmlkQW1vdW50OiBub3JtYWxpemVkQnV5b3V0QW1vdW50LFxuICAgICAgdGltZUJ1ZmZlckluU2Vjb25kczogcGFyc2VkQXVjdGlvbi50aW1lQnVmZmVySW5TZWNvbmRzLFxuICAgICAgYmlkQnVmZmVyQnBzOiBwYXJzZWRBdWN0aW9uLmJpZEJ1ZmZlckJwcyxcbiAgICAgIHN0YXJ0VGltZXN0YW1wOiBwYXJzZWRBdWN0aW9uLnN0YXJ0VGltZXN0YW1wLFxuICAgICAgZW5kVGltZXN0YW1wOiBwYXJzZWRBdWN0aW9uLmVuZFRpbWVzdGFtcFxuICAgIH1dLCB7XG4gICAgICAvLyBIaWdoZXIgZ2FzIGxpbWl0IGZvciBjcmVhdGUgYXVjdGlvblxuICAgICAgZ2FzTGltaXQ6IDUwMDAwMFxuICAgIH0pO1xuICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5jb250cmFjdFdyYXBwZXIucGFyc2VMb2dzKFwiTmV3QXVjdGlvblwiLCByZWNlaXB0Py5sb2dzKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGV2ZW50WzBdLmFyZ3MuYXVjdGlvbklkLFxuICAgICAgcmVjZWlwdFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQnV5b3V0IEF1Y3Rpb25cbiAgICpcbiAgICogQHJlbWFya3MgQnV5IGEgc3BlY2lmaWMgYXVjdGlvbiBmcm9tIHRoZSBtYXJrZXRwbGFjZS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgYXVjdGlvbiBJRCBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gYnV5XG4gICAqIGNvbnN0IGF1Y3Rpb25JZCA9IDA7XG4gICAqXG4gICAqIGF3YWl0IGNvbnRyYWN0LmVuZ2xpc2hBdWN0aW9ucy5idXlvdXRBdWN0aW9uKGF1Y3Rpb25JZCk7XG4gICAqIGBgYFxuICAgKi9cbiAgYXN5bmMgYnV5b3V0QXVjdGlvbihhdWN0aW9uSWQpIHtcbiAgICBjb25zdCBhdWN0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUF1Y3Rpb24oQmlnTnVtYmVyLmZyb20oYXVjdGlvbklkKSk7XG4gICAgY29uc3QgY3VycmVuY3lNZXRhZGF0YSA9IGF3YWl0IGZldGNoQ3VycmVuY3lNZXRhZGF0YSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBhdWN0aW9uLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKTtcbiAgICByZXR1cm4gdGhpcy5tYWtlQmlkKGF1Y3Rpb25JZCwgZXRoZXJzLnV0aWxzLmZvcm1hdFVuaXRzKGF1Y3Rpb24uYnV5b3V0QmlkQW1vdW50LCBjdXJyZW5jeU1ldGFkYXRhLmRlY2ltYWxzKSk7XG4gIH1cblxuICAvKipcbiAgICogQmlkIE9uIEF1Y3Rpb25cbiAgICpcbiAgICogQHJlbWFya3MgTWFrZSBhIGJpZCBvbiBhbiBhdWN0aW9uXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGF1Y3Rpb24gSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGJpZCBvblxuICAgKiBjb25zdCBhdWN0aW9uSWQgPSAwO1xuICAgKiAvLyBUaGUgdG90YWwgYW1vdW50IHlvdSBhcmUgd2lsbGluZyB0byBiaWQgZm9yIGF1Y3Rpb25lZCB0b2tlbnNcbiAgICogY29uc3QgYmlkQW1vdW50ID0gMTtcbiAgICpcbiAgICogYXdhaXQgY29udHJhY3QuZW5nbGlzaEF1Y3Rpb25zLm1ha2VCaWQoYXVjdGlvbklkLCBiaWRBbW91bnQpO1xuICAgKiBgYGBcbiAgICovXG4gIGFzeW5jIG1ha2VCaWQoYXVjdGlvbklkLCBiaWRBbW91bnQpIHtcbiAgICBjb25zdCBhdWN0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUF1Y3Rpb24oQmlnTnVtYmVyLmZyb20oYXVjdGlvbklkKSk7XG4gICAgY29uc3Qgbm9ybWFsaXplZEJpZEFtb3VudCA9IGF3YWl0IG5vcm1hbGl6ZVByaWNlVmFsdWUodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgYmlkQW1vdW50LCBhdWN0aW9uLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKTtcbiAgICBpZiAobm9ybWFsaXplZEJpZEFtb3VudC5lcShCaWdOdW1iZXIuZnJvbSgwKSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBtYWtlIGEgYmlkIHdpdGggMCB2YWx1ZVwiKTtcbiAgICB9XG4gICAgaWYgKEJpZ051bWJlci5mcm9tKGF1Y3Rpb24uYnV5b3V0QmlkQW1vdW50KS5ndCgwKSAmJiBub3JtYWxpemVkQmlkQW1vdW50Lmd0KGF1Y3Rpb24uYnV5b3V0QmlkQW1vdW50KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQmlkIGFtb3VudCBtdXN0IGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byBidXlvdXRCaWRBbW91bnRcIik7XG4gICAgfVxuICAgIGNvbnN0IHdpbm5pbmdCaWQgPSBhd2FpdCB0aGlzLmdldFdpbm5pbmdCaWQoYXVjdGlvbklkKTtcbiAgICBpZiAod2lubmluZ0JpZCkge1xuICAgICAgY29uc3QgaXNXaW5ubmVyID0gYXdhaXQgdGhpcy5pc1dpbm5pbmdCaWQoYXVjdGlvbklkLCBub3JtYWxpemVkQmlkQW1vdW50KTtcbiAgICAgIGludmFyaWFudChpc1dpbm5uZXIsIFwiQmlkIHByaWNlIGlzIHRvbyBsb3cgYmFzZWQgb24gdGhlIGN1cnJlbnQgd2lubmluZyBiaWQgYW5kIHRoZSBiaWQgYnVmZmVyXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB0b2tlblByaWNlID0gbm9ybWFsaXplZEJpZEFtb3VudDtcbiAgICAgIGNvbnN0IG1pbmltdW1CaWRBbW91bnQgPSBCaWdOdW1iZXIuZnJvbShhdWN0aW9uLm1pbmltdW1CaWRBbW91bnQpO1xuICAgICAgaW52YXJpYW50KHRva2VuUHJpY2UuZ3RlKG1pbmltdW1CaWRBbW91bnQpLCBcIkJpZCBwcmljZSBpcyB0b28gbG93IGJhc2VkIG9uIG1pbmltdW0gYmlkIGFtb3VudFwiKTtcbiAgICB9XG4gICAgY29uc3Qgb3ZlcnJpZGVzID0gKGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldENhbGxPdmVycmlkZXMoKSkgfHwge307XG4gICAgYXdhaXQgc2V0RXJjMjBBbGxvd2FuY2UodGhpcy5jb250cmFjdFdyYXBwZXIsIG5vcm1hbGl6ZWRCaWRBbW91bnQsIGF1Y3Rpb24uY3VycmVuY3lDb250cmFjdEFkZHJlc3MsIG92ZXJyaWRlcyk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY2VpcHQ6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImJpZEluQXVjdGlvblwiLCBbYXVjdGlvbklkLCBub3JtYWxpemVkQmlkQW1vdW50XSwgb3ZlcnJpZGVzKVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ2FuY2VsIEF1Y3Rpb25cbiAgICpcbiAgICogQHJlbWFya3MgQ2FuY2VsIGFuIGF1Y3Rpb24gb24gdGhlIG1hcmtldHBsYWNlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIElEIG9mIHRoZSBhdWN0aW9uIHlvdSB3YW50IHRvIGNhbmNlbFxuICAgKiBjb25zdCBhdWN0aW9uSWQgPSBcIjBcIjtcbiAgICpcbiAgICogYXdhaXQgY29udHJhY3QuZW5nbGlzaEF1Y3Rpb25zLmNhbmNlbEF1Y3Rpb24oYXVjdGlvbklkKTtcbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBjYW5jZWxBdWN0aW9uKGF1Y3Rpb25JZCkge1xuICAgIGNvbnN0IHdpbm5pbmdCaWQgPSBhd2FpdCB0aGlzLmdldFdpbm5pbmdCaWQoYXVjdGlvbklkKTtcbiAgICBpZiAod2lubmluZ0JpZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBCaWRzIGFscmVhZHkgbWFkZS5gKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY2VpcHQ6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImNhbmNlbEF1Y3Rpb25cIiwgW2F1Y3Rpb25JZF0pXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZSB0aGUgQXVjdGlvbiBmb3IgdGhlIGJ1eWVyXG4gICAqXG4gICAqIEByZW1hcmtzIENsb3NlcyB0aGUgQXVjdGlvbiBhbmQgZXhlY3V0ZXMgdGhlIHNhbGUgZm9yIHRoZSBidXllci5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgSUQgb2YgdGhlIGF1Y3Rpb24geW91IHdhbnQgdG8gY2xvc2VcbiAgICogY29uc3QgYXVjdGlvbiA9IFwiMFwiO1xuICAgKiBhd2FpdCBjb250cmFjdC5lbmdsaXNoQXVjdGlvbnMuY2xvc2VBdWN0aW9uRm9yQmlkZGVyKGF1Y3Rpb25JZCk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gYXVjdGlvbklkIC0gdGhlIGF1Y3Rpb24gaWQgdG8gY2xvc2VcbiAgICogQHBhcmFtIGNsb3NlRm9yIC0gb3B0aW9uYWxseSBwYXNzIHRoZSB3aW5uaW5nIGJpZCBvZmZlcm9yIGFkZHJlc3MgdG8gY2xvc2UgdGhlIGF1Y3Rpb24gb24gdGhlaXIgYmVoYWxmXG4gICAqL1xuICBhc3luYyBjbG9zZUF1Y3Rpb25Gb3JCaWRkZXIoYXVjdGlvbklkLCBjbG9zZUZvcikge1xuICAgIGlmICghY2xvc2VGb3IpIHtcbiAgICAgIGNsb3NlRm9yID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0U2lnbmVyQWRkcmVzcygpO1xuICAgIH1cbiAgICBjb25zdCBhdWN0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUF1Y3Rpb24oQmlnTnVtYmVyLmZyb20oYXVjdGlvbklkKSk7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlY2VpcHQ6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImNvbGxlY3RBdWN0aW9uVG9rZW5zXCIsIFtCaWdOdW1iZXIuZnJvbShhdWN0aW9uSWQpXSlcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoZXJyLm1lc3NhZ2UuaW5jbHVkZXMoXCJNYXJrZXRwbGFjZTogYXVjdGlvbiBzdGlsbCBhY3RpdmUuXCIpKSB7XG4gICAgICAgIHRocm93IG5ldyBBdWN0aW9uSGFzTm90RW5kZWRFcnJvcihhdWN0aW9uSWQudG9TdHJpbmcoKSwgYXVjdGlvbi5lbmRUaW1lSW5TZWNvbmRzLnRvU3RyaW5nKCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZSB0aGUgQXVjdGlvbiBmb3IgdGhlIHNlbGxlciwgaS5lLiB0aGUgYXVjdGlvbiBjcmVhdG9yXG4gICAqXG4gICAqIEByZW1hcmtzIENsb3NlcyB0aGUgQXVjdGlvbiBhbmQgZXhlY3V0ZXMgdGhlIHNhbGUgZm9yIHRoZSBzZWxsZXIuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIElEIG9mIHRoZSBhdWN0aW9uIHlvdSB3YW50IHRvIGNsb3NlXG4gICAqIGNvbnN0IGF1Y3Rpb25JZCA9IFwiMFwiO1xuICAgKiBhd2FpdCBjb250cmFjdC5lbmdsaXNoQXVjdGlvbnMuY2xvc2VBdWN0aW9uRm9yU2VsbGVyKGF1Y3Rpb25JZCk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gYXVjdGlvbklkIC0gdGhlIGF1Y3Rpb24gaWQgdG8gY2xvc2VcbiAgICovXG4gIGFzeW5jIGNsb3NlQXVjdGlvbkZvclNlbGxlcihhdWN0aW9uSWQpIHtcbiAgICBjb25zdCBhdWN0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUF1Y3Rpb24oQmlnTnVtYmVyLmZyb20oYXVjdGlvbklkKSk7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlY2VpcHQ6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImNvbGxlY3RBdWN0aW9uUGF5b3V0XCIsIFtCaWdOdW1iZXIuZnJvbShhdWN0aW9uSWQpXSlcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoZXJyLm1lc3NhZ2UuaW5jbHVkZXMoXCJNYXJrZXRwbGFjZTogYXVjdGlvbiBzdGlsbCBhY3RpdmUuXCIpKSB7XG4gICAgICAgIHRocm93IG5ldyBBdWN0aW9uSGFzTm90RW5kZWRFcnJvcihhdWN0aW9uSWQudG9TdHJpbmcoKSwgYXVjdGlvbi5lbmRUaW1lSW5TZWNvbmRzLnRvU3RyaW5nKCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHRoZSBBdWN0aW9uIFNhbGVcbiAgICpcbiAgICogQHJlbWFya3MgQ2xvc2VzIHRoZSBBdWN0aW9uIGFuZCBleGVjdXRlcyB0aGUgc2FsZSBmb3IgYm90aCBwYXJ0aWVzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIFRoZSBJRCBvZiB0aGUgYXVjdGlvbiB5b3Ugd2FudCB0byBjbG9zZVxuICAgKiBjb25zdCBhdWN0aW9uID0gXCIwXCI7XG4gICAqIGF3YWl0IGNvbnRyYWN0LmVuZ2xpc2hBdWN0aW9ucy5leGVjdXRlU2FsZShhdWN0aW9uSWQpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIGF1Y3Rpb25JZCAtIHRoZSBhdWN0aW9uIHRvIGNsb3NlXG4gICAqL1xuICBhc3luYyBleGVjdXRlU2FsZShhdWN0aW9uSWQpIHtcbiAgICBjb25zdCBhdWN0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUF1Y3Rpb24oQmlnTnVtYmVyLmZyb20oYXVjdGlvbklkKSk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHdpbm5pbmdCaWQgPSBhd2FpdCB0aGlzLmdldFdpbm5pbmdCaWQoYXVjdGlvbklkKTtcbiAgICAgIGludmFyaWFudCh3aW5uaW5nQmlkLCBcIk5vIHdpbm5pbmcgYmlkIGZvdW5kXCIpO1xuICAgICAgY29uc3QgY2xvc2VGb3JTZWxsZXIgPSB0aGlzLmVuY29kZXIuZW5jb2RlKFwiY29sbGVjdEF1Y3Rpb25QYXlvdXRcIiwgW2F1Y3Rpb25JZF0pO1xuICAgICAgY29uc3QgY2xvc2VGb3JCdXllciA9IHRoaXMuZW5jb2Rlci5lbmNvZGUoXCJjb2xsZWN0QXVjdGlvblRva2Vuc1wiLCBbYXVjdGlvbklkXSk7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIubXVsdGlDYWxsKFtjbG9zZUZvclNlbGxlciwgY2xvc2VGb3JCdXllcl0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyci5tZXNzYWdlLmluY2x1ZGVzKFwiTWFya2V0cGxhY2U6IGF1Y3Rpb24gc3RpbGwgYWN0aXZlLlwiKSkge1xuICAgICAgICB0aHJvdyBuZXcgQXVjdGlvbkhhc05vdEVuZGVkRXJyb3IoYXVjdGlvbklkLnRvU3RyaW5nKCksIGF1Y3Rpb24uZW5kVGltZUluU2Vjb25kcy50b1N0cmluZygpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBidWZmZXIgaW4gYmFzaXMgcG9pbnRzIGJldHdlZW4gYmlkcyBmb3IgYW4gYXVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGF1Y3Rpb25JZCAtIGlkIG9mIHRoZSBhdWN0aW9uXG4gICAqL1xuICBhc3luYyBnZXRCaWRCdWZmZXJCcHMoYXVjdGlvbklkKSB7XG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLmdldEF1Y3Rpb24oYXVjdGlvbklkKSkuYmlkQnVmZmVyQnBzO1xuICB9XG5cbiAgLyoqXG4gICAqIHJldHVybnMgdGhlIG1pbmltdW0gYmlkIGEgdXNlciBjYW4gcGxhY2UgdG8gb3V0YmlkIHRoZSBwcmV2aW91cyBoaWdoZXN0IGJpZFxuICAgKiBAcGFyYW0gYXVjdGlvbklkIC0gaWQgb2YgdGhlIGF1Y3Rpb25cbiAgICovXG4gIGFzeW5jIGdldE1pbmltdW1OZXh0QmlkKGF1Y3Rpb25JZCkge1xuICAgIC8vIHdlIGNhbiBmZXRjaCBhbGwgb2YgdGhlc2UgYXQgdGhlIHNhbWUgdGltZSB1c2luZyBwcm9taXNlLmFsbFxuICAgIGNvbnN0IFtjdXJyZW50QmlkQnVmZmVyQnBzLCB3aW5uaW5nQmlkLCBhdWN0aW9uXSA9IGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLmdldEJpZEJ1ZmZlckJwcyhhdWN0aW9uSWQpLCB0aGlzLmdldFdpbm5pbmdCaWQoYXVjdGlvbklkKSwgYXdhaXQgdGhpcy52YWxpZGF0ZUF1Y3Rpb24oQmlnTnVtYmVyLmZyb20oYXVjdGlvbklkKSldKTtcbiAgICBjb25zdCBjdXJyZW50QmlkT3JSZXNlcnZlUHJpY2UgPSB3aW5uaW5nQmlkID9cbiAgICAvLyBpZiB0aGVyZSBpcyBhIHdpbm5pbmcgYmlkIHVzZSB0aGUgdmFsdWUgb2YgaXRcbiAgICBCaWdOdW1iZXIuZnJvbSh3aW5uaW5nQmlkLmJpZEFtb3VudCkgOlxuICAgIC8vIGlmIHRoZXJlIGlzIG5vIHdpbm5pbmcgYmlkIHVzZSB0aGUgcmVzZXJ2ZSBwcmljZVxuICAgIEJpZ051bWJlci5mcm9tKGF1Y3Rpb24ubWluaW11bUJpZEFtb3VudCk7XG4gICAgY29uc3QgbWluaW11bU5leHRCaWQgPSBjdXJyZW50QmlkT3JSZXNlcnZlUHJpY2UuYWRkKFxuICAgIC8vIHRoZSBhZGRpdGlvbiBvZiB0aGUgY3VycmVudCBiaWQgYW5kIHRoZSBidWZmZXJcbiAgICAvLyAoaGF2ZSB0byBkaXZpZGUgYnkgMTAwMDAgdG8gZ2V0IHRoZSBmcmFjdGlvbiBvZiB0aGUgYnVmZmVyIChzaW5jZSBpdCdzIGluIGJhc2lzIHBvaW50cykpXG4gICAgY3VycmVudEJpZE9yUmVzZXJ2ZVByaWNlLm11bChjdXJyZW50QmlkQnVmZmVyQnBzKS5kaXYoMTAwMDApKTtcblxuICAgIC8vIGl0J3MgbW9yZSB1c2VmdWwgdG8gcmV0dXJuIGEgY3VycmVuY3kgdmFsdWUgaGVyZVxuICAgIHJldHVybiBmZXRjaEN1cnJlbmN5VmFsdWUodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgYXVjdGlvbi5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcywgbWluaW11bU5leHRCaWQpO1xuICB9XG5cbiAgLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBQUklWQVRFIEZVTkNUSU9OU1xuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAvKipcbiAgICogVGhyb3dzIGVycm9yIGlmIGF1Y3Rpb24gY291bGQgbm90IGJlIGZvdW5kXG4gICAqXG4gICAqIEBwYXJhbSBhdWN0aW9uSWQgLSBBdWN0aW9uIHRvIGNoZWNrIGZvclxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVBdWN0aW9uKGF1Y3Rpb25JZCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRBdWN0aW9uKGF1Y3Rpb25JZCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBnZXR0aW5nIHRoZSBhdWN0aW9uIHdpdGggaWQgJHthdWN0aW9uSWR9YCk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2QgbWFwcyB0aGUgYXVjdGlvbiB0byB0aGUgYXVjdGlvbiBpbnRlcmZhY2UuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKiBAcGFyYW0gYXVjdGlvbiAtIFRoZSBhdWN0aW9uIHRvIG1hcCwgYXMgcmV0dXJuZWQgZnJvbSB0aGUgY29udHJhY3QuXG4gICAqIEByZXR1cm5zIC0gVGhlIG1hcHBlZCBpbnRlcmZhY2UuXG4gICAqL1xuICBhc3luYyBtYXBBdWN0aW9uKGF1Y3Rpb24pIHtcbiAgICBsZXQgc3RhdHVzID0gU3RhdHVzLlVOU0VUO1xuICAgIGNvbnN0IGJsb2NrID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKS5nZXRCbG9jayhcImxhdGVzdFwiKTtcbiAgICBjb25zdCBibG9ja1RpbWUgPSBibG9jay50aW1lc3RhbXA7XG4gICAgc3dpdGNoIChhdWN0aW9uLnN0YXR1cykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzdGF0dXMgPSBCaWdOdW1iZXIuZnJvbShhdWN0aW9uLnN0YXJ0VGltZXN0YW1wKS5ndChibG9ja1RpbWUpID8gU3RhdHVzLkNyZWF0ZWQgOiBCaWdOdW1iZXIuZnJvbShhdWN0aW9uLmVuZFRpbWVzdGFtcCkubHQoYmxvY2tUaW1lKSA/IFN0YXR1cy5FeHBpcmVkIDogU3RhdHVzLkFjdGl2ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHN0YXR1cyA9IFN0YXR1cy5Db21wbGV0ZWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBzdGF0dXMgPSBTdGF0dXMuQ2FuY2VsbGVkO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBhdWN0aW9uLmF1Y3Rpb25JZC50b1N0cmluZygpLFxuICAgICAgY3JlYXRvckFkZHJlc3M6IGF1Y3Rpb24uYXVjdGlvbkNyZWF0b3IsXG4gICAgICBhc3NldENvbnRyYWN0QWRkcmVzczogYXVjdGlvbi5hc3NldENvbnRyYWN0LFxuICAgICAgdG9rZW5JZDogYXVjdGlvbi50b2tlbklkLnRvU3RyaW5nKCksXG4gICAgICBxdWFudGl0eTogYXVjdGlvbi5xdWFudGl0eS50b1N0cmluZygpLFxuICAgICAgY3VycmVuY3lDb250cmFjdEFkZHJlc3M6IGF1Y3Rpb24uY3VycmVuY3ksXG4gICAgICBtaW5pbXVtQmlkQW1vdW50OiBhdWN0aW9uLm1pbmltdW1CaWRBbW91bnQudG9TdHJpbmcoKSxcbiAgICAgIG1pbmltdW1CaWRDdXJyZW5jeVZhbHVlOiBhd2FpdCBmZXRjaEN1cnJlbmN5VmFsdWUodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgYXVjdGlvbi5jdXJyZW5jeSwgYXVjdGlvbi5taW5pbXVtQmlkQW1vdW50KSxcbiAgICAgIGJ1eW91dEJpZEFtb3VudDogYXVjdGlvbi5idXlvdXRCaWRBbW91bnQudG9TdHJpbmcoKSxcbiAgICAgIGJ1eW91dEN1cnJlbmN5VmFsdWU6IGF3YWl0IGZldGNoQ3VycmVuY3lWYWx1ZSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBhdWN0aW9uLmN1cnJlbmN5LCBhdWN0aW9uLmJ1eW91dEJpZEFtb3VudCksXG4gICAgICB0aW1lQnVmZmVySW5TZWNvbmRzOiBCaWdOdW1iZXIuZnJvbShhdWN0aW9uLnRpbWVCdWZmZXJJblNlY29uZHMpLnRvTnVtYmVyKCksXG4gICAgICBiaWRCdWZmZXJCcHM6IEJpZ051bWJlci5mcm9tKGF1Y3Rpb24uYmlkQnVmZmVyQnBzKS50b051bWJlcigpLFxuICAgICAgc3RhcnRUaW1lSW5TZWNvbmRzOiBCaWdOdW1iZXIuZnJvbShhdWN0aW9uLnN0YXJ0VGltZXN0YW1wKS50b051bWJlcigpLFxuICAgICAgZW5kVGltZUluU2Vjb25kczogQmlnTnVtYmVyLmZyb20oYXVjdGlvbi5lbmRUaW1lc3RhbXApLnRvTnVtYmVyKCksXG4gICAgICBhc3NldDogYXdhaXQgZmV0Y2hUb2tlbk1ldGFkYXRhRm9yQ29udHJhY3QoYXVjdGlvbi5hc3NldENvbnRyYWN0LCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBhdWN0aW9uLnRva2VuSWQsIHRoaXMuc3RvcmFnZSksXG4gICAgICBzdGF0dXM6IHN0YXR1c1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogTWFwcyBhbiBhdWN0aW9uLWJpZCB0byB0aGUgc3RyaWN0IGludGVyZmFjZVxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICogQHBhcmFtIGJpZFxuICAgKiBAcmV0dXJucyAtIEEgYEJpZGAgb2JqZWN0XG4gICAqL1xuICBhc3luYyBtYXBCaWQoYXVjdGlvbklkLCBiaWRkZXJBZGRyZXNzLCBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcywgYmlkQW1vdW50KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGF1Y3Rpb25JZCxcbiAgICAgIGJpZGRlckFkZHJlc3MsXG4gICAgICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyxcbiAgICAgIGJpZEFtb3VudCxcbiAgICAgIGJpZEFtb3VudEN1cnJlbmN5VmFsdWU6IGF3YWl0IGZldGNoQ3VycmVuY3lWYWx1ZSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcywgYmlkQW1vdW50KVxuICAgIH07XG4gIH1cbiAgYXBwbHlGaWx0ZXIoYXVjdGlvbnMsIGZpbHRlcikge1xuICAgIGxldCByYXdBdWN0aW9ucyA9IFsuLi5hdWN0aW9uc107XG4gICAgaWYgKGZpbHRlcikge1xuICAgICAgaWYgKGZpbHRlci5zZWxsZXIpIHtcbiAgICAgICAgcmF3QXVjdGlvbnMgPSByYXdBdWN0aW9ucy5maWx0ZXIoc2VsbGVyID0+IHNlbGxlci5hdWN0aW9uQ3JlYXRvci50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT09IGZpbHRlcj8uc2VsbGVyPy50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfVxuICAgICAgaWYgKGZpbHRlci50b2tlbkNvbnRyYWN0KSB7XG4gICAgICAgIHJhd0F1Y3Rpb25zID0gcmF3QXVjdGlvbnMuZmlsdGVyKHRva2VuQ29udHJhY3QgPT4gdG9rZW5Db250cmFjdC5hc3NldENvbnRyYWN0LnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PT0gZmlsdGVyPy50b2tlbkNvbnRyYWN0Py50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfVxuICAgICAgaWYgKGZpbHRlci50b2tlbklkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmF3QXVjdGlvbnMgPSByYXdBdWN0aW9ucy5maWx0ZXIodG9rZW5Db250cmFjdCA9PiB0b2tlbkNvbnRyYWN0LnRva2VuSWQudG9TdHJpbmcoKSA9PT0gZmlsdGVyPy50b2tlbklkPy50b1N0cmluZygpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZpbHRlcj8uY291bnQgJiYgZmlsdGVyLmNvdW50IDwgcmF3QXVjdGlvbnMubGVuZ3RoID8gcmF3QXVjdGlvbnMuc2xpY2UoMCwgZmlsdGVyLmNvdW50KSA6IHJhd0F1Y3Rpb25zO1xuICB9XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmNvbnN0IE9mZmVySW5wdXRQYXJhbXNTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIC8qKlxuICAgKiBUaGUgYWRkcmVzcyBvZiB0aGUgYXNzZXQgYmVpbmcgc291Z2h0LlxuICAgKi9cbiAgYXNzZXRDb250cmFjdEFkZHJlc3M6IEFkZHJlc3NTY2hlbWEsXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIHRva2VuLlxuICAgKi9cbiAgdG9rZW5JZDogQmlnTnVtYmVyaXNoU2NoZW1hLFxuICAvKipcbiAgICogVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXkuXG4gICAqXG4gICAqIEZvciBFUkM3MjFzLCB0aGlzIHZhbHVlIHNob3VsZCBhbHdheXMgYmUgMSAoYW5kIHdpbGwgYmUgZm9yY2VkIGludGVybmFsbHkgcmVnYXJkbGVzcyBvZiB3aGF0IGlzIHBhc3NlZCBoZXJlKS5cbiAgICovXG4gIHF1YW50aXR5OiBCaWdOdW1iZXJpc2hTY2hlbWEuZGVmYXVsdCgxKSxcbiAgLyoqXG4gICAqIFRoZSBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSBvZmZlcmVkIGZvciB0aGUgTkZUcy5cbiAgICovXG4gIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzOiBBZGRyZXNzU2NoZW1hLmRlZmF1bHQoTkFUSVZFX1RPS0VOX0FERFJFU1MpLFxuICAvKipcbiAgICogVGhlIHRvdGFsIG9mZmVyIGFtb3VudCBmb3IgdGhlIE5GVHMuXG4gICAqL1xuICB0b3RhbFByaWNlOiBBbW91bnRTY2hlbWEsXG4gIC8qKlxuICAgKiBUaGUgZW5kIHRpbWUgb2YgdGhlIG9mZmVyLlxuICAgKi9cbiAgZW5kVGltZXN0YW1wOiBFbmREYXRlU2NoZW1hXG59KTtcblxuLyoqXG4gKiBAcHVibGljXG4gKi9cblxuLyoqXG4gKiBIYW5kbGVzIG1hcmtldHBsYWNlIG9mZmVyc1xuICogQHB1YmxpY1xuICovXG5jbGFzcyBNYXJrZXRwbGFjZVYzT2ZmZXJzIHtcbiAgLy8gdXRpbGl0aWVzXG5cbiAgY29uc3RydWN0b3IoY29udHJhY3RXcmFwcGVyLCBzdG9yYWdlKSB7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiZmVhdHVyZU5hbWVcIiwgRkVBVFVSRV9PRkZFUlMubmFtZSk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiY29udHJhY3RXcmFwcGVyXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RvcmFnZVwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImV2ZW50c1wiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImludGVyY2VwdG9yXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiZW5jb2RlclwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImVzdGltYXRvclwiLCB2b2lkIDApO1xuICAgIHRoaXMuY29udHJhY3RXcmFwcGVyID0gY29udHJhY3RXcmFwcGVyO1xuICAgIHRoaXMuc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgdGhpcy5ldmVudHMgPSBuZXcgQ29udHJhY3RFdmVudHModGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuZW5jb2RlciA9IG5ldyBDb250cmFjdEVuY29kZXIodGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuaW50ZXJjZXB0b3IgPSBuZXcgQ29udHJhY3RJbnRlcmNlcHRvcih0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gICAgdGhpcy5lc3RpbWF0b3IgPSBuZXcgR2FzQ29zdEVzdGltYXRvcih0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gIH1cbiAgZ2V0QWRkcmVzcygpIHtcbiAgICByZXR1cm4gdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmFkZHJlc3M7XG4gIH1cblxuICAvKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIFJFQUQgRlVOQ1RJT05TXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRvdGFsIG51bWJlciBvZiBvZmZlcnNcbiAgICogQHJldHVybnMgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIG9mZmVycyBjcmVhdGVkLlxuICAgKiBAcHVibGljXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogY29uc3QgdG90YWxPZmZlcnMgPSBhd2FpdCBjb250cmFjdC5vZmZlcnMuZ2V0VG90YWxDb3VudCgpO1xuICAgKiBgYGBcbiAgICovXG4gIGFzeW5jIGdldFRvdGFsQ291bnQoKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC50b3RhbE9mZmVycygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgb2ZmZXJzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IG9mZmVycyA9IGF3YWl0IGNvbnRyYWN0Lm9mZmVycy5nZXRBbGwoKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSBmaWx0ZXIgLSBvcHRpb25hbCBmaWx0ZXIgcGFyYW1ldGVyc1xuICAgKiBAcmV0dXJucyB0aGUgT2ZmZXIgb2JqZWN0IGFycmF5XG4gICAqL1xuICBhc3luYyBnZXRBbGwoZmlsdGVyKSB7XG4gICAgY29uc3QgdG90YWxPZmZlcnMgPSBhd2FpdCB0aGlzLmdldFRvdGFsQ291bnQoKTtcbiAgICBsZXQgc3RhcnQgPSBCaWdOdW1iZXIuZnJvbShmaWx0ZXI/LnN0YXJ0IHx8IDApLnRvTnVtYmVyKCk7XG4gICAgbGV0IGVuZCA9IHRvdGFsT2ZmZXJzLnRvTnVtYmVyKCk7XG4gICAgaWYgKGVuZCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBvZmZlcnMgZXhpc3Qgb24gdGhlIGNvbnRyYWN0LmApO1xuICAgIH1cbiAgICBsZXQgcmF3T2ZmZXJzID0gW107XG4gICAgbGV0IGJhdGNoZXMgPSBhd2FpdCBnZXRBbGxJbkJhdGNoZXMoc3RhcnQsIGVuZCwgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmdldEFsbE9mZmVycyk7XG4gICAgcmF3T2ZmZXJzID0gYmF0Y2hlcy5mbGF0KCk7XG4gICAgY29uc3QgZmlsdGVyZWRPZmZlcnMgPSB0aGlzLmFwcGx5RmlsdGVyKHJhd09mZmVycywgZmlsdGVyKTtcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwoZmlsdGVyZWRPZmZlcnMubWFwKG9mZmVyID0+IHRoaXMubWFwT2ZmZXIob2ZmZXIpKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCB2YWxpZCBvZmZlcnMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogY29uc3Qgb2ZmZXJzID0gYXdhaXQgY29udHJhY3Qub2ZmZXJzLmdldEFsbFZhbGlkKCk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gZmlsdGVyIC0gb3B0aW9uYWwgZmlsdGVyIHBhcmFtZXRlcnNcbiAgICogQHJldHVybnMgdGhlIE9mZmVyIG9iamVjdCBhcnJheVxuICAgKi9cbiAgYXN5bmMgZ2V0QWxsVmFsaWQoZmlsdGVyKSB7XG4gICAgY29uc3QgdG90YWxPZmZlcnMgPSBhd2FpdCB0aGlzLmdldFRvdGFsQ291bnQoKTtcbiAgICBsZXQgc3RhcnQgPSBCaWdOdW1iZXIuZnJvbShmaWx0ZXI/LnN0YXJ0IHx8IDApLnRvTnVtYmVyKCk7XG4gICAgbGV0IGVuZCA9IHRvdGFsT2ZmZXJzLnRvTnVtYmVyKCk7XG4gICAgaWYgKGVuZCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBvZmZlcnMgZXhpc3Qgb24gdGhlIGNvbnRyYWN0LmApO1xuICAgIH1cbiAgICBsZXQgcmF3T2ZmZXJzID0gW107XG4gICAgbGV0IGJhdGNoZXMgPSBhd2FpdCBnZXRBbGxJbkJhdGNoZXMoc3RhcnQsIGVuZCwgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmdldEFsbFZhbGlkT2ZmZXJzKTtcbiAgICByYXdPZmZlcnMgPSBiYXRjaGVzLmZsYXQoKTtcbiAgICBjb25zdCBmaWx0ZXJlZE9mZmVycyA9IHRoaXMuYXBwbHlGaWx0ZXIocmF3T2ZmZXJzLCBmaWx0ZXIpO1xuICAgIHJldHVybiBhd2FpdCBQcm9taXNlLmFsbChmaWx0ZXJlZE9mZmVycy5tYXAob2ZmZXIgPT4gdGhpcy5tYXBPZmZlcihvZmZlcikpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBvZmZlciBieSBpZFxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IG9mZmVySWQgPSAwO1xuICAgKiBjb25zdCBvZmZlciA9IGF3YWl0IGNvbnRyYWN0Lm9mZmVycy5nZXRPZmZlcihvZmZlcklkKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSBvZmZlcklkIC0gdGhlIGxpc3RpbmcgaWRcbiAgICogQHJldHVybnMgdGhlIERpcmVjdCBsaXN0aW5nIG9iamVjdFxuICAgKi9cbiAgYXN5bmMgZ2V0T2ZmZXIob2ZmZXJJZCkge1xuICAgIGNvbnN0IG9mZmVyID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LmdldE9mZmVyKG9mZmVySWQpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLm1hcE9mZmVyKG9mZmVyKTtcbiAgfVxuXG4gIC8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICogV1JJVEUgRlVOQ1RJT05TXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBNYWtlIE9mZmVyXG4gICAqXG4gICAqIEByZW1hcmtzIE1ha2UgYW4gb2ZmZXIgb24gdGhlIG1hcmtldHBsYWNlIGZvciBhbiBhc3NldC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBEYXRhIG9mIHRoZSBvZmZlciB5b3Ugd2FudCB0byBtYWtlXG4gICAqIGNvbnN0IG9mZmVyID0ge1xuICAgKiAgIC8vIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHRoZSBhc3NldCB5b3Ugd2FudCB0byBtYWtlIGFuIG9mZmVyIGZvclxuICAgKiAgIGFzc2V0Q29udHJhY3RBZGRyZXNzOiBcIjB4Li4uXCIsXG4gICAqICAgLy8gdG9rZW4gSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGJ1eVxuICAgKiAgIHRva2VuSWQ6IFwiMFwiLFxuICAgKiAgIC8vIGhvdyBtYW55IG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBidXlcbiAgICogICBxdWFudGl0eTogMSxcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSBjb250cmFjdCB0aGF0IHlvdSBvZmZlciB0byBwYXkgaW5cbiAgICogICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzczogTkFUSVZFX1RPS0VOX0FERFJFU1MsXG4gICAqICAgLy8gVG90YWwgcHJpY2UgeW91IG9mZmVyIHRvIHBheSBmb3IgdGhlIG1lbnRpb25lZCB0b2tlbihzKVxuICAgKiAgIHRvdGFsUHJpY2U6IFwiMS41XCIsXG4gICAqICAgLy8gT2ZmZXIgdmFsaWQgdW50aWxcbiAgICogICBlbmRUaW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAqIH1cbiAgICpcbiAgICogY29uc3QgdHggPSBhd2FpdCBjb250cmFjdC5vZmZlcnMubWFrZU9mZmVyKG9mZmVyKTtcbiAgICogY29uc3QgcmVjZWlwdCA9IHR4LnJlY2VpcHQ7IC8vIHRoZSB0cmFuc2FjdGlvbiByZWNlaXB0XG4gICAqIGNvbnN0IGlkID0gdHguaWQ7IC8vIHRoZSBpZCBvZiB0aGUgbmV3bHkgY3JlYXRlZCBvZmZlclxuICAgKiBgYGBcbiAgICovXG4gIGFzeW5jIG1ha2VPZmZlcihvZmZlcikge1xuICAgIGNvbnN0IHBhcnNlZE9mZmVyID0gT2ZmZXJJbnB1dFBhcmFtc1NjaGVtYS5wYXJzZShvZmZlcik7XG4gICAgY29uc3QgY2hhaW5JZCA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldENoYWluSUQoKTtcbiAgICBjb25zdCBjdXJyZW5jeSA9IGlzTmF0aXZlVG9rZW4ocGFyc2VkT2ZmZXIuY3VycmVuY3lDb250cmFjdEFkZHJlc3MpID8gTkFUSVZFX1RPS0VOU1tjaGFpbklkXS53cmFwcGVkLmFkZHJlc3MgOiBwYXJzZWRPZmZlci5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcztcbiAgICBjb25zdCBub3JtYWxpemVkVG90YWxQcmljZSA9IGF3YWl0IG5vcm1hbGl6ZVByaWNlVmFsdWUodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgcGFyc2VkT2ZmZXIudG90YWxQcmljZSwgY3VycmVuY3kpO1xuICAgIGNvbnN0IG92ZXJyaWRlcyA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldENhbGxPdmVycmlkZXMoKTtcbiAgICBhd2FpdCBzZXRFcmMyMEFsbG93YW5jZSh0aGlzLmNvbnRyYWN0V3JhcHBlciwgbm9ybWFsaXplZFRvdGFsUHJpY2UsIGN1cnJlbmN5LCBvdmVycmlkZXMpO1xuICAgIGNvbnN0IHJlY2VpcHQgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5zZW5kVHJhbnNhY3Rpb24oXCJtYWtlT2ZmZXJcIiwgW3tcbiAgICAgIGFzc2V0Q29udHJhY3Q6IHBhcnNlZE9mZmVyLmFzc2V0Q29udHJhY3RBZGRyZXNzLFxuICAgICAgdG9rZW5JZDogcGFyc2VkT2ZmZXIudG9rZW5JZCxcbiAgICAgIHF1YW50aXR5OiBwYXJzZWRPZmZlci5xdWFudGl0eSxcbiAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSxcbiAgICAgIHRvdGFsUHJpY2U6IG5vcm1hbGl6ZWRUb3RhbFByaWNlLFxuICAgICAgZXhwaXJhdGlvblRpbWVzdGFtcDogcGFyc2VkT2ZmZXIuZW5kVGltZXN0YW1wXG4gICAgfV0sIHtcbiAgICAgIC8vIEhpZ2hlciBnYXMgbGltaXQgZm9yIGNyZWF0ZSBsaXN0aW5nXG4gICAgICBnYXNMaW1pdDogNTAwMDAwXG4gICAgfSk7XG4gICAgY29uc3QgZXZlbnQgPSB0aGlzLmNvbnRyYWN0V3JhcHBlci5wYXJzZUxvZ3MoXCJOZXdPZmZlclwiLCByZWNlaXB0Py5sb2dzKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGV2ZW50WzBdLmFyZ3Mub2ZmZXJJZCxcbiAgICAgIHJlY2VpcHRcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbCBPZmZlclxuICAgKlxuICAgKiBAcmVtYXJrcyBDYW5jZWwgYW4gb2ZmZXIgb24gdGhlIG1hcmtldHBsYWNlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIElEIG9mIHRoZSBvZmZlciB5b3Ugd2FudCB0byBjYW5jZWxcbiAgICogY29uc3Qgb2ZmZXJJZCA9IFwiMFwiO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5vZmZlcnMuY2FuY2VsT2ZmZXIob2ZmZXJJZCk7XG4gICAqIGBgYFxuICAgKi9cbiAgYXN5bmMgY2FuY2VsT2ZmZXIob2ZmZXJJZCkge1xuICAgIHJldHVybiB7XG4gICAgICByZWNlaXB0OiBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5zZW5kVHJhbnNhY3Rpb24oXCJjYW5jZWxPZmZlclwiLCBbb2ZmZXJJZF0pXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY2NlcHQgYW4gb2ZmZXJcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgSUQgb2YgdGhlIG9mZmVyIHlvdSB3YW50IHRvIGFjY2VwdFxuICAgKiBjb25zdCBvZmZlcklkID0gMDtcbiAgICpcbiAgICogYXdhaXQgY29udHJhY3Qub2ZmZXJzLmFjY2VwdE9mZmVyKG9mZmVySWQpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIG9mZmVySWQgLSBUaGUgb2ZmZXIgaWRcbiAgICovXG4gIGFzeW5jIGFjY2VwdE9mZmVyKG9mZmVySWQpIHtcbiAgICBjb25zdCBvZmZlciA9IGF3YWl0IHRoaXMudmFsaWRhdGVPZmZlcihCaWdOdW1iZXIuZnJvbShvZmZlcklkKSk7XG4gICAgY29uc3Qge1xuICAgICAgdmFsaWQsXG4gICAgICBlcnJvclxuICAgIH0gPSBhd2FpdCB0aGlzLmlzU3RpbGxWYWxpZE9mZmVyKG9mZmVyKTtcbiAgICBpZiAoIXZhbGlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE9mZmVyICR7b2ZmZXJJZH0gaXMgbm8gbG9uZ2VyIHZhbGlkLiAke2Vycm9yfWApO1xuICAgIH1cbiAgICBjb25zdCBvdmVycmlkZXMgPSAoYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0Q2FsbE92ZXJyaWRlcygpKSB8fCB7fTtcbiAgICBhd2FpdCBoYW5kbGVUb2tlbkFwcHJvdmFsKHRoaXMuY29udHJhY3RXcmFwcGVyLCB0aGlzLmdldEFkZHJlc3MoKSwgb2ZmZXIuYXNzZXRDb250cmFjdEFkZHJlc3MsIG9mZmVyLnRva2VuSWQsIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFNpZ25lckFkZHJlc3MoKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY2VpcHQ6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnNlbmRUcmFuc2FjdGlvbihcImFjY2VwdE9mZmVyXCIsIFtvZmZlcklkXSwgb3ZlcnJpZGVzKVxuICAgIH07XG4gIH1cblxuICAvKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIFBSSVZBVEUgRlVOQ1RJT05TXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBUaHJvd3MgZXJyb3IgaWYgb2ZmZXIgY291bGQgbm90IGJlIGZvdW5kXG4gICAqXG4gICAqIEBwYXJhbSBvZmZlcklkIC0gb2ZmZXIgdG8gY2hlY2sgZm9yXG4gICAqL1xuICBhc3luYyB2YWxpZGF0ZU9mZmVyKG9mZmVySWQpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0T2ZmZXIob2ZmZXJJZCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBnZXR0aW5nIHRoZSBvZmZlciB3aXRoIGlkICR7b2ZmZXJJZH1gKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZCBtYXBzIHRoZSBvZmZlciB0byB0aGUgb2ZmZXIgaW50ZXJmYWNlLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICogQHBhcmFtIG9mZmVyIC0gVGhlIG9mZmVyIHRvIG1hcCwgYXMgcmV0dXJuZWQgZnJvbSB0aGUgY29udHJhY3QuXG4gICAqIEByZXR1cm5zIC0gVGhlIG1hcHBlZCBpbnRlcmZhY2UuXG4gICAqL1xuICBhc3luYyBtYXBPZmZlcihvZmZlcikge1xuICAgIGxldCBzdGF0dXMgPSBTdGF0dXMuVU5TRVQ7XG4gICAgY29uc3QgYmxvY2sgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLmdldEJsb2NrKFwibGF0ZXN0XCIpO1xuICAgIGNvbnN0IGJsb2NrVGltZSA9IGJsb2NrLnRpbWVzdGFtcDtcbiAgICBzd2l0Y2ggKG9mZmVyLnN0YXR1cykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzdGF0dXMgPSBCaWdOdW1iZXIuZnJvbShvZmZlci5leHBpcmF0aW9uVGltZXN0YW1wKS5sdChibG9ja1RpbWUpID8gU3RhdHVzLkV4cGlyZWQgOiBTdGF0dXMuQWN0aXZlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgc3RhdHVzID0gU3RhdHVzLkNvbXBsZXRlZDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHN0YXR1cyA9IFN0YXR1cy5DYW5jZWxsZWQ7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IG9mZmVyLm9mZmVySWQudG9TdHJpbmcoKSxcbiAgICAgIG9mZmVyb3JBZGRyZXNzOiBvZmZlci5vZmZlcm9yLFxuICAgICAgYXNzZXRDb250cmFjdEFkZHJlc3M6IG9mZmVyLmFzc2V0Q29udHJhY3QsXG4gICAgICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzczogb2ZmZXIuY3VycmVuY3ksXG4gICAgICB0b2tlbklkOiBvZmZlci50b2tlbklkLnRvU3RyaW5nKCksXG4gICAgICBxdWFudGl0eTogb2ZmZXIucXVhbnRpdHkudG9TdHJpbmcoKSxcbiAgICAgIHRvdGFsUHJpY2U6IG9mZmVyLnRvdGFsUHJpY2UudG9TdHJpbmcoKSxcbiAgICAgIGN1cnJlbmN5VmFsdWU6IGF3YWl0IGZldGNoQ3VycmVuY3lWYWx1ZSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBvZmZlci5jdXJyZW5jeSwgb2ZmZXIudG90YWxQcmljZSksXG4gICAgICBhc3NldDogYXdhaXQgZmV0Y2hUb2tlbk1ldGFkYXRhRm9yQ29udHJhY3Qob2ZmZXIuYXNzZXRDb250cmFjdCwgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgb2ZmZXIudG9rZW5JZCwgdGhpcy5zdG9yYWdlKSxcbiAgICAgIGVuZFRpbWVJblNlY29uZHM6IEJpZ051bWJlci5mcm9tKG9mZmVyLmV4cGlyYXRpb25UaW1lc3RhbXApLnRvTnVtYmVyKCksXG4gICAgICBzdGF0dXM6IHN0YXR1c1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVXNlIHRoaXMgbWV0aG9kIHRvIGNoZWNrIGlmIGFuIG9mZmVyIGlzIHN0aWxsIHZhbGlkLlxuICAgKlxuICAgKiBXYXlzIGFuIG9mZmVyIGNhbiBiZWNvbWUgaW52YWxpZDpcbiAgICogMS4gVGhlIG9mZmVyIGhhcyBleHBpcmVkXG4gICAqIDIuIFRoZSBvZmZlcm9yIGRvZXNuJ3QgaGF2ZSBlbm91Z2ggYmFsYW5jZSBvZiBjdXJyZW5jeSB0b2tlbnNcbiAgICogMy4gVGhlIG9mZmVyb3IgcmVtb3ZlZCB0aGUgYXBwcm92YWwgb2YgY3VycmVuY3kgdG9rZW5zIG9uIHRoZSBtYXJrZXRwbGFjZVxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICogQHBhcmFtIG9mZmVyIC0gVGhlIG9mZmVyIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyAtIFRydWUgaWYgdGhlIG9mZmVyIGlzIHZhbGlkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBhc3luYyBpc1N0aWxsVmFsaWRPZmZlcihvZmZlcikge1xuICAgIGNvbnN0IG5vdyA9IEJpZ051bWJlci5mcm9tKE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApKTtcbiAgICBpZiAobm93Lmd0KG9mZmVyLmVuZFRpbWVJblNlY29uZHMpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiBgT2ZmZXIgd2l0aCBJRCAke29mZmVyLmlkfSBoYXMgZXhwaXJlZGBcbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IGNoYWluSWQgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRDaGFpbklEKCk7XG4gICAgY29uc3QgY3VycmVuY3kgPSBpc05hdGl2ZVRva2VuKG9mZmVyLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKSA/IE5BVElWRV9UT0tFTlNbY2hhaW5JZF0ud3JhcHBlZC5hZGRyZXNzIDogb2ZmZXIuY3VycmVuY3lDb250cmFjdEFkZHJlc3M7XG4gICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpO1xuICAgIGNvbnN0IGVyYzIwID0gbmV3IENvbnRyYWN0V3JhcHBlcihwcm92aWRlciwgY3VycmVuY3ksIEVSQzIwQWJpLCB7fSk7XG4gICAgY29uc3Qgb2ZmZXJvckJhbGFuY2UgPSBhd2FpdCBlcmMyMC5yZWFkQ29udHJhY3QuYmFsYW5jZU9mKG9mZmVyLm9mZmVyb3JBZGRyZXNzKTtcbiAgICBpZiAob2ZmZXJvckJhbGFuY2UubHQob2ZmZXIudG90YWxQcmljZSkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGBPZmZlcm9yICR7b2ZmZXIub2ZmZXJvckFkZHJlc3N9IGRvZXNuJ3QgaGF2ZSBlbm91Z2ggYmFsYW5jZSBvZiB0b2tlbiAke2N1cnJlbmN5fWBcbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IG9mZmVyb3JBbGxvd2FuY2UgPSBhd2FpdCBlcmMyMC5yZWFkQ29udHJhY3QuYWxsb3dhbmNlKG9mZmVyLm9mZmVyb3JBZGRyZXNzLCB0aGlzLmdldEFkZHJlc3MoKSk7XG4gICAgaWYgKG9mZmVyb3JBbGxvd2FuY2UubHQob2ZmZXIudG90YWxQcmljZSkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGBPZmZlcm9yICR7b2ZmZXIub2ZmZXJvckFkZHJlc3N9IGhhc24ndCBhcHByb3ZlZCBlbm91Z2ggYW1vdW50IG9mIHRva2VuICR7Y3VycmVuY3l9YFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgZXJyb3I6IFwiXCJcbiAgICB9O1xuICB9XG4gIGFwcGx5RmlsdGVyKG9mZmVycywgZmlsdGVyKSB7XG4gICAgbGV0IHJhd09mZmVycyA9IFsuLi5vZmZlcnNdO1xuICAgIGlmIChmaWx0ZXIpIHtcbiAgICAgIGlmIChmaWx0ZXIub2ZmZXJvcikge1xuICAgICAgICByYXdPZmZlcnMgPSByYXdPZmZlcnMuZmlsdGVyKG9mZmVyb3IgPT4gb2ZmZXJvci5vZmZlcm9yLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PT0gZmlsdGVyPy5vZmZlcm9yPy50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfVxuICAgICAgaWYgKGZpbHRlci50b2tlbkNvbnRyYWN0KSB7XG4gICAgICAgIHJhd09mZmVycyA9IHJhd09mZmVycy5maWx0ZXIodG9rZW5Db250cmFjdCA9PiB0b2tlbkNvbnRyYWN0LmFzc2V0Q29udHJhY3QudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID09PSBmaWx0ZXI/LnRva2VuQ29udHJhY3Q/LnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSk7XG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVyLnRva2VuSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByYXdPZmZlcnMgPSByYXdPZmZlcnMuZmlsdGVyKHRva2VuQ29udHJhY3QgPT4gdG9rZW5Db250cmFjdC50b2tlbklkLnRvU3RyaW5nKCkgPT09IGZpbHRlcj8udG9rZW5JZD8udG9TdHJpbmcoKSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmaWx0ZXI/LmNvdW50ICYmIGZpbHRlci5jb3VudCA8IHJhd09mZmVycy5sZW5ndGggPyByYXdPZmZlcnMuc2xpY2UoMCwgZmlsdGVyLmNvdW50KSA6IHJhd09mZmVycztcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSB5b3VyIG93biB3aGl0ZWxhYmVsIG1hcmtldHBsYWNlIHRoYXQgZW5hYmxlcyB1c2VycyB0byBidXkgYW5kIHNlbGwgYW55IGRpZ2l0YWwgYXNzZXRzLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogYGBgamF2YXNjcmlwdFxuICogaW1wb3J0IHsgVGhpcmR3ZWJTREsgfSBmcm9tIFwiQHRoaXJkd2ViLWRldi9zZGtcIjtcbiAqXG4gKiBjb25zdCBzZGsgPSBuZXcgVGhpcmR3ZWJTREsoXCJ7e2NoYWluTmFtZX19XCIpO1xuICogY29uc3QgY29udHJhY3QgPSBhd2FpdCBzZGsuZ2V0Q29udHJhY3QoXCJ7e2NvbnRyYWN0X2FkZHJlc3N9fVwiLCBcIm1hcmtldHBsYWNlXCIpO1xuICogYGBgXG4gKlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBNYXJrZXRwbGFjZVYzIHtcbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cblxuICAvKipcbiAgICogRGlyZWN0IGxpc3RpbmdzXG4gICAqIEByZW1hcmtzIENyZWF0ZSBhbmQgbWFuYWdlIGRpcmVjdCBsaXN0aW5ncyBpbiB5b3VyIG1hcmtldHBsYWNlLlxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIERhdGEgb2YgdGhlIGxpc3RpbmcgeW91IHdhbnQgdG8gY3JlYXRlXG4gICAqIGNvbnN0IGxpc3RpbmcgPSB7XG4gICAqICAgLy8gYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGxpc3QgaXMgb25cbiAgICogICBhc3NldENvbnRyYWN0QWRkcmVzczogXCIweC4uLlwiLFxuICAgKiAgIC8vIHRva2VuIElEIG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0XG4gICAqICAgdG9rZW5JZDogXCIwXCIsXG4gICAqICAgLy8gaG93IG1hbnkgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGxpc3RcbiAgICogICBxdWFudGl0eTogMSxcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSBjb250cmFjdCB0aGF0IHdpbGwgYmUgdXNlZCB0byBwYXkgZm9yIHRoZSBsaXN0aW5nXG4gICAqICAgY3VycmVuY3lDb250cmFjdEFkZHJlc3M6IE5BVElWRV9UT0tFTl9BRERSRVNTLFxuICAgKiAgIC8vIFRoZSBwcmljZSB0byBwYXkgcGVyIHVuaXQgb2YgTkZUcyBsaXN0ZWQuXG4gICAqICAgcHJpY2VQZXJUb2tlbjogMS41LFxuICAgKiAgIC8vIHdoZW4gc2hvdWxkIHRoZSBsaXN0aW5nIG9wZW4gdXAgZm9yIG9mZmVyc1xuICAgKiAgIHN0YXJ0VGltZXN0YW1wOiBuZXcgRGF0ZShEYXRlLm5vdygpKSxcbiAgICogICAvLyBob3cgbG9uZyB0aGUgbGlzdGluZyB3aWxsIGJlIG9wZW4gZm9yXG4gICAqICAgZW5kVGltZXN0YW1wOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgNSAqIDI0ICogNjAgKiA2MCAqIDEwMDApLFxuICAgKiAgIC8vIFdoZXRoZXIgdGhlIGxpc3RpbmcgaXMgcmVzZXJ2ZWQgZm9yIGEgc3BlY2lmaWMgc2V0IG9mIGJ1eWVycy5cbiAgICogICBpc1Jlc2VydmVkTGlzdGluZzogZmFsc2VcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LmRpcmVjdExpc3RpbmdzLmNyZWF0ZUxpc3RpbmcobGlzdGluZyk7XG4gICAqIGNvbnN0IHJlY2VpcHQgPSB0eC5yZWNlaXB0OyAvLyB0aGUgdHJhbnNhY3Rpb24gcmVjZWlwdFxuICAgKiBjb25zdCBpZCA9IHR4LmlkOyAvLyB0aGUgaWQgb2YgdGhlIG5ld2x5IGNyZWF0ZWQgbGlzdGluZ1xuICAgKlxuICAgKiAvLyBBbmQgb24gdGhlIGJ1eWVycyBzaWRlOlxuICAgKiAvLyBUaGUgSUQgb2YgdGhlIGxpc3RpbmcgeW91IHdhbnQgdG8gYnV5IGZyb21cbiAgICogY29uc3QgbGlzdGluZ0lkID0gMDtcbiAgICogLy8gUXVhbnRpdHkgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGJ1eVxuICAgKiBjb25zdCBxdWFudGl0eURlc2lyZWQgPSAxO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5kaXJlY3RMaXN0aW5ncy5idXlGcm9tTGlzdGluZyhsaXN0aW5nSWQsIHF1YW50aXR5RGVzaXJlZCk7XG4gICAqIGBgYFxuICAgKi9cbiAgZ2V0IGRpcmVjdExpc3RpbmdzKCkge1xuICAgIHJldHVybiBhc3NlcnRFbmFibGVkKHRoaXMuZGV0ZWN0RGlyZWN0TGlzdGluZ3MoKSwgRkVBVFVSRV9ESVJFQ1RfTElTVElOR1MpO1xuICB9XG4gIC8qKlxuICAgKiBBdWN0aW9uc1xuICAgKiBAcmVtYXJrcyBDcmVhdGUgYW5kIG1hbmFnZSBhdWN0aW9ucyBpbiB5b3VyIG1hcmtldHBsYWNlLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIERhdGEgb2YgdGhlIGF1Y3Rpb24geW91IHdhbnQgdG8gY3JlYXRlXG4gICAqIGNvbnN0IGF1Y3Rpb24gPSB7XG4gICAqICAgLy8gYWRkcmVzcyBvZiB0aGUgY29udHJhY3Qgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGF1Y3Rpb25cbiAgICogICBhc3NldENvbnRyYWN0QWRkcmVzczogXCIweC4uLlwiLFxuICAgKiAgIC8vIHRva2VuIElEIG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBhdWN0aW9uXG4gICAqICAgdG9rZW5JZDogXCIwXCIsXG4gICAqICAgLy8gaG93IG1hbnkgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGF1Y3Rpb25cbiAgICogICBxdWFudGl0eTogMSxcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSBjb250cmFjdCB0aGF0IHdpbGwgYmUgdXNlZCB0byBwYXkgZm9yIHRoZSBhdWN0aW9uZWQgdG9rZW5zXG4gICAqICAgY3VycmVuY3lDb250cmFjdEFkZHJlc3M6IE5BVElWRV9UT0tFTl9BRERSRVNTLFxuICAgKiAgIC8vIHRoZSBtaW5pbXVtIGJpZCB0aGF0IHdpbGwgYmUgYWNjZXB0ZWQgZm9yIHRoZSB0b2tlblxuICAgKiAgIG1pbmltdW1CaWRBbW91bnQ6IFwiMS41XCIsXG4gICAqICAgLy8gaG93IG11Y2ggcGVvcGxlIHdvdWxkIGhhdmUgdG8gYmlkIHRvIGluc3RhbnRseSBidXkgdGhlIGFzc2V0XG4gICAqICAgYnV5b3V0QmlkQW1vdW50OiBcIjEwXCIsXG4gICAqICAgLy8gSWYgYSBiaWQgaXMgbWFkZSBsZXNzIHRoYW4gdGhlc2UgbWFueSBzZWNvbmRzIGJlZm9yZSBleHBpcmF0aW9uLCB0aGUgZXhwaXJhdGlvbiB0aW1lIGlzIGluY3JlYXNlZCBieSB0aGlzLlxuICAgKiAgIHRpbWVCdWZmZXJJblNlY29uZHM6IFwiMTAwMFwiLFxuICAgKiAgIC8vIEEgYmlkIG11c3QgYmUgYXQgbGVhc3QgdGhpcyBtdWNoIGJwcyBncmVhdGVyIHRoYW4gdGhlIGN1cnJlbnQgd2lubmluZyBiaWRcbiAgICogICBiaWRCdWZmZXJCcHM6IFwiMTAwXCIsIC8vIDEwMCBicHMgc3RhbmRzIGZvciAxJVxuICAgKiAgIC8vIHdoZW4gc2hvdWxkIHRoZSBhdWN0aW9uIG9wZW4gdXAgZm9yIGJpZGRpbmdcbiAgICogICBzdGFydFRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSksXG4gICAqICAgLy8gZW5kIHRpbWUgb2YgYXVjdGlvblxuICAgKiAgIGVuZFRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LmVuZ2xpc2hBdWN0aW9ucy5jcmVhdGVBdWN0aW9uKGF1Y3Rpb24pO1xuICAgKiBjb25zdCByZWNlaXB0ID0gdHgucmVjZWlwdDsgLy8gdGhlIHRyYW5zYWN0aW9uIHJlY2VpcHRcbiAgICogY29uc3QgaWQgPSB0eC5pZDsgLy8gdGhlIGlkIG9mIHRoZSBuZXdseSBjcmVhdGVkIGF1Y3Rpb25cbiAgICpcbiAgICogLy8gQW5kIG9uIHRoZSBidXllcnMgc2lkZTpcbiAgICogLy8gVGhlIGF1Y3Rpb24gSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGJpZCBvblxuICAgKiBjb25zdCBhdWN0aW9uSWQgPSAwO1xuICAgKiAvLyBUaGUgdG90YWwgYW1vdW50IHlvdSBhcmUgd2lsbGluZyB0byBiaWQgZm9yIGF1Y3Rpb25lZCB0b2tlbnNcbiAgICogY29uc3QgYmlkQW1vdW50ID0gMTtcbiAgICpcbiAgICogYXdhaXQgY29udHJhY3QuZW5nbGlzaEF1Y3Rpb25zLm1ha2VCaWQoYXVjdGlvbklkLCBiaWRBbW91bnQpO1xuICAgKiBgYGBcbiAgICovXG4gIGdldCBlbmdsaXNoQXVjdGlvbnMoKSB7XG4gICAgcmV0dXJuIGFzc2VydEVuYWJsZWQodGhpcy5kZXRlY3RFbmdsaXNoQXVjdGlvbnMoKSwgRkVBVFVSRV9FTkdMSVNIX0FVQ1RJT05TKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPZmZlcnNcbiAgICogQHJlbWFya3MgTWFrZSBhbmQgbWFuYWdlIG9mZmVycy5cbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBEYXRhIG9mIHRoZSBvZmZlciB5b3Ugd2FudCB0byBtYWtlXG4gICAqIGNvbnN0IG9mZmVyID0ge1xuICAgKiAgIC8vIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHRoZSBhc3NldCB5b3Ugd2FudCB0byBtYWtlIGFuIG9mZmVyIGZvclxuICAgKiAgIGFzc2V0Q29udHJhY3RBZGRyZXNzOiBcIjB4Li4uXCIsXG4gICAqICAgLy8gdG9rZW4gSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGJ1eVxuICAgKiAgIHRva2VuSWQ6IFwiMFwiLFxuICAgKiAgIC8vIGhvdyBtYW55IG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBidXlcbiAgICogICBxdWFudGl0eTogMSxcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSBjb250cmFjdCB0aGF0IHlvdSBvZmZlciB0byBwYXkgaW5cbiAgICogICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzczogTkFUSVZFX1RPS0VOX0FERFJFU1MsXG4gICAqICAgLy8gVG90YWwgcHJpY2UgeW91IG9mZmVyIHRvIHBheSBmb3IgdGhlIG1lbnRpb25lZCB0b2tlbihzKVxuICAgKiAgIHRvdGFsUHJpY2U6IFwiMS41XCIsXG4gICAqICAgLy8gT2ZmZXIgdmFsaWQgdW50aWxcbiAgICogICBlbmRUaW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAqIH1cbiAgICpcbiAgICogY29uc3QgdHggPSBhd2FpdCBjb250cmFjdC5vZmZlcnMubWFrZU9mZmVyKG9mZmVyKTtcbiAgICogY29uc3QgcmVjZWlwdCA9IHR4LnJlY2VpcHQ7IC8vIHRoZSB0cmFuc2FjdGlvbiByZWNlaXB0XG4gICAqIGNvbnN0IGlkID0gdHguaWQ7IC8vIHRoZSBpZCBvZiB0aGUgbmV3bHkgY3JlYXRlZCBvZmZlclxuICAgKlxuICAgKiAvLyBBbmQgb24gdGhlIHNlbGxlcidzIHNpZGU6XG4gICAqIC8vIFRoZSBJRCBvZiB0aGUgb2ZmZXIgeW91IHdhbnQgdG8gYWNjZXB0XG4gICAqIGNvbnN0IG9mZmVySWQgPSAwO1xuICAgKiBhd2FpdCBjb250cmFjdC5vZmZlcnMuYWNjZXB0T2ZmZXIob2ZmZXJJZCk7XG4gICAqIGBgYFxuICAgKi9cbiAgZ2V0IG9mZmVycygpIHtcbiAgICByZXR1cm4gYXNzZXJ0RW5hYmxlZCh0aGlzLmRldGVjdE9mZmVycygpLCBGRUFUVVJFX09GRkVSUyk7XG4gIH1cbiAgZ2V0IGNoYWluSWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NoYWluSWQ7XG4gIH1cbiAgY29uc3RydWN0b3IobmV0d29yaywgYWRkcmVzcywgc3RvcmFnZSkge1xuICAgIGxldCBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiB7fTtcbiAgICBsZXQgYWJpID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB1bmRlZmluZWQ7XG4gICAgbGV0IGNoYWluSWQgPSBhcmd1bWVudHMubGVuZ3RoID4gNSA/IGFyZ3VtZW50c1s1XSA6IHVuZGVmaW5lZDtcbiAgICBsZXQgY29udHJhY3RXcmFwcGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDYgJiYgYXJndW1lbnRzWzZdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNl0gOiBuZXcgQ29udHJhY3RXcmFwcGVyKG5ldHdvcmssIGFkZHJlc3MsIGFiaSwgb3B0aW9ucyk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiYWJpXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiY29udHJhY3RXcmFwcGVyXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RvcmFnZVwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImVuY29kZXJcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJldmVudHNcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJlc3RpbWF0b3JcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJwbGF0Zm9ybUZlZXNcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJtZXRhZGF0YVwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJvbGVzXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiaW50ZXJjZXB0b3JcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJfY2hhaW5JZFwiLCB2b2lkIDApO1xuICAgIHRoaXMuX2NoYWluSWQgPSBjaGFpbklkO1xuICAgIHRoaXMuYWJpID0gYWJpO1xuICAgIHRoaXMuY29udHJhY3RXcmFwcGVyID0gY29udHJhY3RXcmFwcGVyO1xuICAgIHRoaXMuc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgdGhpcy5tZXRhZGF0YSA9IG5ldyBDb250cmFjdE1ldGFkYXRhKHRoaXMuY29udHJhY3RXcmFwcGVyLCBNYXJrZXRwbGFjZUNvbnRyYWN0U2NoZW1hLCB0aGlzLnN0b3JhZ2UpO1xuICAgIHRoaXMucm9sZXMgPSBuZXcgQ29udHJhY3RSb2xlcyh0aGlzLmNvbnRyYWN0V3JhcHBlciwgTWFya2V0cGxhY2VWMy5jb250cmFjdFJvbGVzKTtcbiAgICB0aGlzLmVuY29kZXIgPSBuZXcgQ29udHJhY3RFbmNvZGVyKHRoaXMuY29udHJhY3RXcmFwcGVyKTtcbiAgICB0aGlzLmVzdGltYXRvciA9IG5ldyBHYXNDb3N0RXN0aW1hdG9yKHRoaXMuY29udHJhY3RXcmFwcGVyKTtcbiAgICB0aGlzLmV2ZW50cyA9IG5ldyBDb250cmFjdEV2ZW50cyh0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gICAgdGhpcy5wbGF0Zm9ybUZlZXMgPSBuZXcgQ29udHJhY3RQbGF0Zm9ybUZlZSh0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gICAgdGhpcy5pbnRlcmNlcHRvciA9IG5ldyBDb250cmFjdEludGVyY2VwdG9yKHRoaXMuY29udHJhY3RXcmFwcGVyKTtcbiAgfVxuICBvbk5ldHdvcmtVcGRhdGVkKG5ldHdvcmspIHtcbiAgICB0aGlzLmNvbnRyYWN0V3JhcHBlci51cGRhdGVTaWduZXJPclByb3ZpZGVyKG5ldHdvcmspO1xuICB9XG4gIGdldEFkZHJlc3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5hZGRyZXNzO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYXN5bmMgY2FsbChmdW5jdGlvbk5hbWUpIHtcbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29udHJhY3RXcmFwcGVyLmNhbGwoZnVuY3Rpb25OYW1lLCAuLi5hcmdzKTtcbiAgfVxuXG4gIC8qKiAqKioqKioqKioqKioqKioqKioqKlxuICAgKiBGRUFUVVJFIERFVEVDVElPTlxuICAgKiAqKioqKioqKioqKioqKioqKioqKi9cblxuICBkZXRlY3REaXJlY3RMaXN0aW5ncygpIHtcbiAgICBpZiAoZGV0ZWN0Q29udHJhY3RGZWF0dXJlKHRoaXMuY29udHJhY3RXcmFwcGVyLCBcIkRpcmVjdExpc3RpbmdzXCIpKSB7XG4gICAgICByZXR1cm4gbmV3IE1hcmtldHBsYWNlVjNEaXJlY3RMaXN0aW5ncyh0aGlzLmNvbnRyYWN0V3JhcHBlciwgdGhpcy5zdG9yYWdlKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBkZXRlY3RFbmdsaXNoQXVjdGlvbnMoKSB7XG4gICAgaWYgKGRldGVjdENvbnRyYWN0RmVhdHVyZSh0aGlzLmNvbnRyYWN0V3JhcHBlciwgXCJFbmdsaXNoQXVjdGlvbnNcIikpIHtcbiAgICAgIHJldHVybiBuZXcgTWFya2V0cGxhY2VWM0VuZ2xpc2hBdWN0aW9ucyh0aGlzLmNvbnRyYWN0V3JhcHBlciwgdGhpcy5zdG9yYWdlKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBkZXRlY3RPZmZlcnMoKSB7XG4gICAgaWYgKGRldGVjdENvbnRyYWN0RmVhdHVyZSh0aGlzLmNvbnRyYWN0V3JhcHBlciwgXCJPZmZlcnNcIikpIHtcbiAgICAgIHJldHVybiBuZXcgTWFya2V0cGxhY2VWM09mZmVycyh0aGlzLmNvbnRyYWN0V3JhcHBlciwgdGhpcy5zdG9yYWdlKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufVxuX2RlZmluZVByb3BlcnR5KE1hcmtldHBsYWNlVjMsIFwiY29udHJhY3RSb2xlc1wiLCBbXCJhZG1pblwiLCBcImxpc3RlclwiLCBcImFzc2V0XCJdKTtcblxuZXhwb3J0IHsgTWFya2V0cGxhY2VWMyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9